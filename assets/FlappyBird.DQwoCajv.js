import{a3 as e}from"./mermaid-core.B8ycMFPP.js";import{r as t,R as o}from"./react-vendor.BcUHAtgm.js";import{P as n}from"./index.BJ2gvff6.js";import"./icons.r1cMsEGh.js";const a=({onClose:n})=>{const a=t.useRef(null),r=t.useRef(null),i=t.useRef(null),[l,s]=t.useState(!1),[c,d]=t.useState(!0),[p,g]=t.useState(0),[u,h]=t.useState(null);console.log("FlappyBird: Component Render"),t.useEffect(()=>{const t=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&t.intersectionRatio>.1&&"undefined"!=typeof window&&"requestIdleCallback"in window&&window.requestIdleCallback(()=>{e(()=>import("./kaplay-game.lBB0w7iG.js"),[]).catch(()=>{})})})},{threshold:.1,rootMargin:"100px"});return i.current&&t.observe(i.current),()=>t.disconnect()},[]);const y=t.useCallback(async()=>{const t=a.current;if(console.log("FlappyBird: useEffect setup - container ref:",t),t&&!l)try{d(!0),h(null),g(10),console.log("FlappyBird: Loading kaplay...");const o=await(async()=>{try{return(await e(()=>import("./kaplay-game.lBB0w7iG.js"),[])).default}catch(u){throw console.error("Failed to load Kaplay:",u),u}})();g(40),console.log("FlappyBird: Initializing kaplay...");const n=o({canvas:document.createElement("canvas"),width:t.clientWidth||800,height:t.clientHeight||600});if(g(70),r.current=n,s(!0),console.log("FlappyBird: kaplay initialized, instance:",n),0===t.children.length||t.children[0]!==n.canvas){for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(n.canvas),console.log("FlappyBird: Appended kaplay canvas to container")}g(90);const a=()=>{if(!n.canvas||0===n.canvas.offsetWidth||0===n.canvas.offsetHeight)return void console.log("FlappyBird: Kaplay canvas not ready for resize, skipping.",n.canvas);const{clientWidth:e,clientHeight:o}=t;console.log(`FlappyBird: Resizing kaplay to ${e}x${o}`),n.resize(e,o)};let i=requestAnimationFrame(a);const l=new ResizeObserver(()=>{i=requestAnimationFrame(a)});return l.observe(t),g(100),d(!1),()=>{console.log("FlappyBird: kaplay setup cleanup"),l.disconnect(),cancelAnimationFrame(i),r.current&&"function"==typeof r.current.destroy&&(console.log("FlappyBird: Calling destroy() on kaplay instance"),r.current.destroy(),r.current=null)}}catch(o){console.error("Failed to initialize kaplay:",o),h(o),d(!1),g(0)}else console.log("FlappyBird: Container not available or kaplay already initialized, returning.")},[l]);return t.useEffect(()=>{let e;return y().then(t=>{e=t}),()=>{e&&e()}},[y]),t.useEffect(()=>{console.log("FlappyBird: useEffect for game logic running");const e=r.current;if(e&&l){try{const t=320,o=100,n=120,a=80;e.scene("game",()=>{console.log("FlappyBird: Setting up game scene"),e.add([e.rect(e.width,e.height),e.color(.5,.7,1)]);const r=e.add([e.text(0),{value:0,z:100}]),i=e.add([e.rect(30,30),e.color(1,1,0),e.pos(a,40),e.area(),e.body()]);i.onUpdate(()=>{i.isFalling()&&i.pos.y>=e.height&&e.go("lose",r.value)}),i.onCollide("pipe",()=>{e.go("lose",r.value)}),i.onCollide("ground",()=>{e.go("lose",r.value)}),e.onClick(()=>{i.jump(t)}),e.loop(1.5,()=>{!function(){const t=e.rand(0,e.height-n);e.add([e.rect(50,t+n/2+80),e.color(0,1,0),e.pos(e.width,0),e.area(),e.move(e.LEFT,o),"pipe",{passed:!1}]),e.add([e.rect(50,e.height-(t+n/2+80)-n),e.color(0,1,0),e.pos(e.width,t+n),e.area(),e.move(e.LEFT,o),"pipe"])}()}),e.onUpdate("pipe",e=>{e.pos.x+e.width<i.pos.x&&!e.passed&&(r.value++,r.text=r.value,e.passed=!0)}),e.add([e.rect(e.width,50),e.color(.6,.4,.2),e.pos(0,e.height-50),e.area(),"ground"])}),e.scene("lose",t=>{console.log("FlappyBird: Setting up lose scene"),e.add([e.text("Game Over!"),e.pos(e.width/2,e.height/2-50),e.origin("center")]),e.add([e.text(`Score: ${t}`),e.pos(e.width/2,e.height/2),e.origin("center")]),e.add([e.text("Click to Play Again"),e.pos(e.width/2,e.height/2+50),e.origin("center")]),e.onClick(()=>e.go("game"))}),e.go("game")}catch(t){console.error("Error setting up game logic:",t),h(t)}return()=>{console.log("FlappyBird: game logic useEffect cleanup")}}console.error("FlappyBird: kaplay instance not available for game logic")},[l]),u?o.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",padding:"20px",color:"var(--text-error)"}},o.createElement("h3",null,"Failed to load game"),o.createElement("p",null,u.message),o.createElement("button",{onClick:()=>{h(null),d(!1)},style:{padding:"10px 20px",marginTop:"10px",background:"var(--text-accent)",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"}},"Retry")):c?o.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",gap:"20px"}},o.createElement("div",{style:{width:"60px",height:"60px",border:"6px solid var(--bg-secondary)",borderTop:"6px solid var(--text-accent)",borderRadius:"50%",animation:"spin 1s linear infinite"}}),o.createElement("div",{style:{width:"200px",height:"8px",background:"var(--bg-secondary)",borderRadius:"4px",overflow:"hidden"}},o.createElement("div",{style:{width:`${p}%`,height:"100%",background:"linear-gradient(90deg, var(--text-accent), var(--mint-800))",borderRadius:"4px",transition:"width 0.3s ease"}})),o.createElement("p",{style:{color:"var(--text-secondary)",fontSize:"14px"}},"Loading game... ",p,"%")):o.createElement("div",{ref:e=>{a.current=e,i.current=e},style:{width:"100%",height:"100%"}})};a.displayName="FlappyBird",a.propTypes={onClose:n.func.isRequired};export{a as FlappyBird};
