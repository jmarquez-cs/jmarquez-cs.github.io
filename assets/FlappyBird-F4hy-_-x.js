import{r as a,R as i,_ as k,P as _}from"./index-Bb_P4A5L.js";const C=()=>{typeof window<"u"&&"requestIdleCallback"in window&&window.requestIdleCallback(()=>{k(()=>import("./kaplay-BGkVrW0H.js"),[]).catch(()=>{})})},R=async()=>{try{return(await k(()=>import("./kaplay-BGkVrW0H.js"),[])).default}catch(d){throw console.error("Failed to load Kaplay:",d),d}},w=({onClose:d})=>{const E=a.useRef(null),s=a.useRef(null),h=a.useRef(null),[p,b]=a.useState(!1),[I,u]=a.useState(!0),[v,c]=a.useState(0),[P,g]=a.useState(null);console.log("FlappyBird: Component Render"),a.useEffect(()=>{const e=new IntersectionObserver(n=>{n.forEach(t=>{t.isIntersecting&&t.intersectionRatio>.1&&C()})},{threshold:.1,rootMargin:"100px"});return h.current&&e.observe(h.current),()=>e.disconnect()},[]);const x=a.useCallback(async()=>{const e=E.current;if(console.log("FlappyBird: useEffect setup - container ref:",e),!e||p){console.log("FlappyBird: Container not available or kaplay already initialized, returning.");return}try{u(!0),g(null),c(10),console.log("FlappyBird: Loading kaplay...");const n=await R();c(40),console.log("FlappyBird: Initializing kaplay...");const t=n({canvas:document.createElement("canvas"),width:e.clientWidth||800,height:e.clientHeight||600});if(c(70),s.current=t,b(!0),console.log("FlappyBird: kaplay initialized, instance:",t),e.children.length===0||e.children[0]!==t.canvas){for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(t.canvas),console.log("FlappyBird: Appended kaplay canvas to container")}c(90);const f=()=>{if(!t.canvas||t.canvas.offsetWidth===0||t.canvas.offsetHeight===0){console.log("FlappyBird: Kaplay canvas not ready for resize, skipping.",t.canvas);return}const{clientWidth:r,clientHeight:y}=e;console.log(`FlappyBird: Resizing kaplay to ${r}x${y}`),t.resize(r,y)};let m=requestAnimationFrame(f);const o=new ResizeObserver(()=>{m=requestAnimationFrame(f)});return o.observe(e),c(100),u(!1),()=>{console.log("FlappyBird: kaplay setup cleanup"),o.disconnect(),cancelAnimationFrame(m),s.current&&typeof s.current.destroy=="function"&&(console.log("FlappyBird: Calling destroy() on kaplay instance"),s.current.destroy(),s.current=null)}}catch(n){console.error("Failed to initialize kaplay:",n),g(n),u(!1),c(0)}},[p]);return a.useEffect(()=>{let e;return x().then(n=>{e=n}),()=>{e&&e()}},[x]),a.useEffect(()=>{console.log("FlappyBird: useEffect for game logic running");const e=s.current;if(!e||!p){console.error("FlappyBird: kaplay instance not available for game logic");return}try{e.scene("game",()=>{console.log("FlappyBird: Setting up game scene"),e.add([e.rect(e.width,e.height),e.color(.5,.7,1)]);const o=e.add([e.text(0),{value:0,z:100}]),r=e.add([e.rect(30,30),e.color(1,1,0),e.pos(80,40),e.area(),e.body()]);r.onUpdate(()=>{r.isFalling()&&r.pos.y>=e.height&&e.go("lose",o.value)}),r.onCollide("pipe",()=>{e.go("lose",o.value)}),r.onCollide("ground",()=>{e.go("lose",o.value)}),e.onClick(()=>{r.jump(320)});function y(){const l=e.rand(0,e.height-120),F=50;e.add([e.rect(F,l+120/2+80),e.color(0,1,0),e.pos(e.width,0),e.area(),e.move(e.LEFT,100),"pipe",{passed:!1}]),e.add([e.rect(F,e.height-(l+120/2+80)-120),e.color(0,1,0),e.pos(e.width,l+120),e.area(),e.move(e.LEFT,100),"pipe"])}e.loop(1.5,()=>{y()}),e.onUpdate("pipe",l=>{l.pos.x+l.width<r.pos.x&&!l.passed&&(o.value++,o.text=o.value,l.passed=!0)}),e.add([e.rect(e.width,50),e.color(.6,.4,.2),e.pos(0,e.height-50),e.area(),"ground"])}),e.scene("lose",o=>{console.log("FlappyBird: Setting up lose scene"),e.add([e.text("Game Over!"),e.pos(e.width/2,e.height/2-50),e.origin("center")]),e.add([e.text(`Score: ${o}`),e.pos(e.width/2,e.height/2),e.origin("center")]),e.add([e.text("Click to Play Again"),e.pos(e.width/2,e.height/2+50),e.origin("center")]),e.onClick(()=>e.go("game"))}),e.go("game")}catch(n){console.error("Error setting up game logic:",n),g(n)}return()=>{console.log("FlappyBird: game logic useEffect cleanup")}},[p]),P?i.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",padding:"20px",color:"var(--text-error)"}},i.createElement("h3",null,"Failed to load game"),i.createElement("p",null,P.message),i.createElement("button",{onClick:()=>{g(null),u(!1)},style:{padding:"10px 20px",marginTop:"10px",background:"var(--text-accent)",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"}},"Retry")):I?i.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",gap:"20px"}},i.createElement("div",{style:{width:"60px",height:"60px",border:"6px solid var(--bg-secondary)",borderTop:"6px solid var(--text-accent)",borderRadius:"50%",animation:"spin 1s linear infinite"}}),i.createElement("div",{style:{width:"200px",height:"8px",background:"var(--bg-secondary)",borderRadius:"4px",overflow:"hidden"}},i.createElement("div",{style:{width:`${v}%`,height:"100%",background:"linear-gradient(90deg, var(--text-accent), var(--mint-800))",borderRadius:"4px",transition:"width 0.3s ease"}})),i.createElement("p",{style:{color:"var(--text-secondary)",fontSize:"14px"}},"Loading game... ",v,"%")):i.createElement("div",{ref:e=>{E.current=e,h.current=e},style:{width:"100%",height:"100%"}})};w.displayName="FlappyBird";w.propTypes={onClose:_.func.isRequired};export{w as FlappyBird};
