var e,t,s=Object.defineProperty,n=(e,t,n)=>((e,t,n)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n),i=(()=>{for(var e=new Uint8Array(128),t=0;t<64;t++)e[t<26?t+65:t<52?t+71:t<62?t-4:4*t-205]=t;return t=>{for(var s=t.length,n=new Uint8Array(3*(s-("="==t[s-1])-("="==t[s-2]))/4|0),i=0,r=0;i<s;){var a=e[t.charCodeAt(i++)],o=e[t.charCodeAt(i++)],l=e[t.charCodeAt(i++)],h=e[t.charCodeAt(i++)];n[r++]=a<<2|o>>4,n[r++]=o<<4|l>>2,n[r++]=l<<6|h}return n}})();function r(e,t,s){return t>s?r(e,s,t):Math.min(Math.max(e,t),s)}var a=(e=class{constructor(e,t,s){n(this,"r",255),n(this,"g",255),n(this,"b",255),this.r=r(e,0,255),this.g=r(t,0,255),this.b=r(s,0,255)}static fromArray(t){return new e(t[0],t[1],t[2])}static fromHex(t){if("number"==typeof t)return new e(t>>16&255,t>>8&255,255&t);if("string"==typeof t){let s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(!s)throw new Error("Invalid hex color format");return new e(parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16))}throw new Error("Invalid hex color format")}static fromHSL(t,s,n){if(0==s)return new e(255*n,255*n,255*n);let i=(e,t,s)=>(s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e),r=n<.5?n*(1+s):n+s-n*s,a=2*n-r,o=i(a,r,t+1/3),l=i(a,r,t),h=i(a,r,t-1/3);return new e(Math.round(255*o),Math.round(255*l),Math.round(255*h))}clone(){return new e(this.r,this.g,this.b)}lighten(t){return new e(this.r+t,this.g+t,this.b+t)}darken(e){return this.lighten(-e)}invert(){return new e(255-this.r,255-this.g,255-this.b)}mult(t){return new e(this.r*t.r/255,this.g*t.g/255,this.b*t.b/255)}lerp(t,s){return new e(d(this.r,t.r,s),d(this.g,t.g,s),d(this.b,t.b,s))}toHSL(){let e=this.r/255,t=this.g/255,s=this.b/255,n=Math.max(e,t,s),i=Math.min(e,t,s),r=(n+i)/2,a=r,o=r;if(n==i)r=a=0;else{let l=n-i;switch(a=o>.5?l/(2-n-i):l/(n+i),n){case e:r=(t-s)/l+(t<s?6:0);break;case t:r=(s-e)/l+2;break;case s:r=(e-t)/l+4}r/=6}return[r,a,o]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}toArray(){return[this.r,this.g,this.b]}},n(e,"RED",new e(255,0,0)),n(e,"GREEN",new e(0,255,0)),n(e,"BLUE",new e(0,0,255)),n(e,"YELLOW",new e(255,255,0)),n(e,"MAGENTA",new e(255,0,255)),n(e,"CYAN",new e(0,255,255)),n(e,"WHITE",new e(255,255,255)),n(e,"BLACK",new e(0,0,0)),e);function o(...e){if(0===e.length)return new a(255,255,255);if(1===e.length){if(e[0]instanceof a)return e[0].clone();if("string"==typeof e[0])return a.fromHex(e[0]);if(Array.isArray(e[0])&&3===e[0].length)return a.fromArray(e[0])}else if(2===e.length){if(e[0]instanceof a)return e[0].clone()}else if(3===e.length||4===e.length)return new a(e[0],e[1],e[2]);throw new Error("Invalid color arguments")}var l=(e,t,s)=>a.fromHSL(e,t,s);function h(e){return e*Math.PI/180}function u(e){return 180*e/Math.PI}function d(e,t,s){if("number"==typeof e&&"number"==typeof t)return e+(t-e)*s;if(e instanceof p&&t instanceof p)return e.lerp(t,s);if(e instanceof a&&t instanceof a)return e.lerp(t,s);throw new Error(`Bad value for lerp(): ${e}, ${t}. Only number, Vec2 and Color is supported.`)}function c(e,t,s,n,i){return n+(e-t)/(s-t)*(i-n)}function f(e,t,s,n,i){return r(c(e,t,s,n,i),n,i)}var p=(t=class{constructor(e=0,t=e){n(this,"x",0),n(this,"y",0),this.x=e,this.y=t}static fromAngle(e){let s=h(e);return new t(Math.cos(s),Math.sin(s))}static fromArray(e){return new t(e[0],e[1])}clone(){return new t(this.x,this.y)}add(...e){let s=g(...e);return new t(this.x+s.x,this.y+s.y)}sub(...e){let s=g(...e);return new t(this.x-s.x,this.y-s.y)}scale(...e){let s=g(...e);return new t(this.x*s.x,this.y*s.y)}dist(...e){let t=g(...e);return this.sub(t).len()}sdist(...e){let t=g(...e);return this.sub(t).slen()}static sdist(e,t){let s=e.x-t.x,n=e.y-t.y;return s*s+n*n}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let e=this.len();return 0===e?new t(0):this.scale(1/e)}normal(){return new t(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}static dot(e,t){return e.x*t.x+e.y*t.y}cross(e){return this.x*e.y-this.y*e.x}static cross(e,t){return e.x*t.y-e.y*t.x}angle(...e){let t=g(...e);return u(Math.atan2(this.y-t.y,this.x-t.x))}angleBetween(...e){let t=g(...e);return u(Math.atan2(this.cross(t),this.dot(t)))}lerp(e,s){return new t(d(this.x,e.x,s),d(this.y,e.y,s))}slerp(e,t){let s=this.dot(e),n=this.cross(e),i=Math.atan2(n,s);return this.scale(Math.sin((1-t)*i)).add(e.scale(Math.sin(t*i))).scale(1/n)}isZero(){return 0===this.x&&0===this.y}toFixed(e){return new t(Number(this.x.toFixed(e)),Number(this.y.toFixed(e)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new te(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}toArray(){return[this.x,this.y]}},n(t,"ZERO",new t(0,0)),n(t,"ONE",new t(1,1)),n(t,"LEFT",new t(-1,0)),n(t,"RIGHT",new t(1,0)),n(t,"UP",new t(0,-1)),n(t,"DOWN",new t(0,1)),t);function g(...e){if(1===e.length){if(e[0]instanceof p)return new p(e[0].x,e[0].y);if(Array.isArray(e[0])&&2===e[0].length)return new p(...e[0])}return new p(...e)}var m=class e{constructor(e,t,s,i){n(this,"x",0),n(this,"y",0),n(this,"w",1),n(this,"h",1),this.x=e,this.y=t,this.w=s,this.h=i}scale(t){return new e(this.x+this.w*t.x,this.y+this.h*t.y,this.w*t.w,this.h*t.h)}pos(){return new p(this.x,this.y)}clone(){return new e(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};function w(e,t,s,n){return new m(e,t,s,n)}var y=class e{constructor(e,t,s,i){n(this,"a"),n(this,"b"),n(this,"c"),n(this,"d"),this.a=e,this.b=t,this.c=s,this.d=i}mul(t){return new e(this.a*t.a+this.b*t.c,this.a*t.b+this.b*t.d,this.c*t.a+this.d*t.c,this.c*t.b+this.d*t.d)}transform(e){return g(this.a*e.x+this.b*e.y,this.c*e.x+this.d*e.y)}get inverse(){let t=this.det;return new e(this.d/t,-this.b/t,-this.c/t,this.a/t)}get transpose(){return new e(this.a,this.c,this.b,this.d)}get eigenvalues(){let e=this.trace/2,t=this.det;return[e+Math.sqrt(e*e-t),e-Math.sqrt(e*e-t)]}eigenvectors(e,t){return 0!=this.c?[[e-this.d,this.c],[t-this.d,this.c]]:0!=this.b?[[this.b,e-this.a],[this.b,t-this.a]]:Math.abs(this.transform(g(1,0)).x-e)<Number.EPSILON?[[1,0],[0,1]]:[[0,1],[1,0]]}get det(){return this.a*this.d-this.b*this.c}get trace(){return this.a+this.d}static rotation(t){let s=Math.cos(t),n=Math.sin(t);return new e(s,n,-n,s)}static scale(t,s){return new e(t,0,0,s)}},A=class e{constructor(e,t,s,i,r,a,o,l,h){n(this,"m11"),n(this,"m12"),n(this,"m13"),n(this,"m21"),n(this,"m22"),n(this,"m23"),n(this,"m31"),n(this,"m32"),n(this,"m33"),this.m11=e,this.m12=t,this.m13=s,this.m21=i,this.m22=r,this.m23=a,this.m31=o,this.m32=l,this.m33=h}static fromMat2(t){return new e(t.a,t.b,0,t.c,t.d,0,0,0,1)}toMat2(){return new y(this.m11,this.m12,this.m21,this.m22)}mul(t){return new e(this.m11*t.m11+this.m12*t.m21+this.m13*t.m31,this.m11*t.m12+this.m12*t.m22+this.m13*t.m32,this.m11*t.m13+this.m12*t.m23+this.m13*t.m33,this.m21*t.m11+this.m22*t.m21+this.m23*t.m31,this.m21*t.m12+this.m22*t.m22+this.m23*t.m32,this.m21*t.m13+this.m22*t.m23+this.m23*t.m33,this.m31*t.m11+this.m32*t.m21+this.m33*t.m31,this.m31*t.m12+this.m32*t.m22+this.m33*t.m32,this.m31*t.m13+this.m32*t.m23+this.m33*t.m33)}get det(){return this.m11*this.m22*this.m33+this.m12*this.m23*this.m31+this.m13*this.m21*this.m32-this.m13*this.m22*this.m31-this.m12*this.m21*this.m33-this.m11*this.m23*this.m32}rotate(e){let t=Math.cos(e),s=Math.sin(e),n=this.m11,i=this.m12;return this.m11=t*this.m11+s*this.m21,this.m12=t*this.m12+s*this.m22,this.m21=t*this.m21-s*n,this.m22=t*this.m22-s*i,this}scale(e,t){return this.m11*=e,this.m12*=e,this.m21*=t,this.m22*=t,this}get inverse(){let t=this.det;return new e((this.m22*this.m33-this.m23*this.m32)/t,(this.m13*this.m32-this.m12*this.m33)/t,(this.m12*this.m23-this.m13*this.m22)/t,(this.m23*this.m31-this.m21*this.m33)/t,(this.m11*this.m33-this.m13*this.m31)/t,(this.m13*this.m21-this.m11*this.m23)/t,(this.m21*this.m32-this.m22*this.m31)/t,(this.m12*this.m31-this.m11*this.m32)/t,(this.m11*this.m22-this.m12*this.m21)/t)}get transpose(){return new e(this.m11,this.m21,this.m31,this.m12,this.m22,this.m32,this.m13,this.m23,this.m33)}},v=class e{constructor(e){n(this,"m",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),e&&(this.m=e)}static translate(t){return new e([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,0,1])}static scale(t){return new e([t.x,0,0,0,0,t.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(t){t=h(-t);let s=Math.cos(t),n=Math.sin(t);return new e([1,0,0,0,0,s,-n,0,0,n,s,0,0,0,0,1])}static rotateY(t){t=h(-t);let s=Math.cos(t),n=Math.sin(t);return new e([s,0,n,0,0,1,0,0,-n,0,s,0,0,0,0,1])}static rotateZ(t){t=h(-t);let s=Math.cos(t),n=Math.sin(t);return new e([s,-n,0,0,n,s,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=h(-e);let t=Math.cos(e),s=Math.sin(e),n=this.m[0],i=this.m[1],r=this.m[4],a=this.m[5];return this.m[0]=n*t+i*s,this.m[1]=-n*s+i*t,this.m[4]=r*t+a*s,this.m[5]=-r*s+a*t,this}mult(t){let s=[];for(let e=0;e<4;e++)for(let n=0;n<4;n++)s[4*e+n]=this.m[0+n]*t.m[4*e+0]+this.m[4+n]*t.m[4*e+1]+this.m[8+n]*t.m[4*e+2]+this.m[12+n]*t.m[4*e+3];return new e(s)}multVec2(e){return new p(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new p(this.m[12],this.m[13])}getScale(){if(0!=this.m[0]||0!=this.m[1]){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new p(t,e/t)}if(0!=this.m[4]||0!=this.m[5]){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new p(e/t,t)}return new p(0,0)}getRotation(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return u(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}if(0!=this.m[4]||0!=this.m[5]){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return u(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}return 0}getSkew(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new p(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}if(0!=this.m[4]||0!=this.m[5]){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new p(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}return new p(0,0)}invert(){let t=[],s=this.m[10]*this.m[15]-this.m[14]*this.m[11],n=this.m[9]*this.m[15]-this.m[13]*this.m[11],i=this.m[9]*this.m[14]-this.m[13]*this.m[10],r=this.m[8]*this.m[15]-this.m[12]*this.m[11],a=this.m[8]*this.m[14]-this.m[12]*this.m[10],o=this.m[8]*this.m[13]-this.m[12]*this.m[9],l=this.m[6]*this.m[15]-this.m[14]*this.m[7],h=this.m[5]*this.m[15]-this.m[13]*this.m[7],u=this.m[5]*this.m[14]-this.m[13]*this.m[6],d=this.m[4]*this.m[15]-this.m[12]*this.m[7],c=this.m[4]*this.m[14]-this.m[12]*this.m[6],f=this.m[5]*this.m[15]-this.m[13]*this.m[7],p=this.m[4]*this.m[13]-this.m[12]*this.m[5],g=this.m[6]*this.m[11]-this.m[10]*this.m[7],m=this.m[5]*this.m[11]-this.m[9]*this.m[7],w=this.m[5]*this.m[10]-this.m[9]*this.m[6],y=this.m[4]*this.m[11]-this.m[8]*this.m[7],A=this.m[4]*this.m[10]-this.m[8]*this.m[6],v=this.m[4]*this.m[9]-this.m[8]*this.m[5];t[0]=this.m[5]*s-this.m[6]*n+this.m[7]*i,t[4]=-(this.m[4]*s-this.m[6]*r+this.m[7]*a),t[8]=this.m[4]*n-this.m[5]*r+this.m[7]*o,t[12]=-(this.m[4]*i-this.m[5]*a+this.m[6]*o),t[1]=-(this.m[1]*s-this.m[2]*n+this.m[3]*i),t[5]=this.m[0]*s-this.m[2]*r+this.m[3]*a,t[9]=-(this.m[0]*n-this.m[1]*r+this.m[3]*o),t[13]=this.m[0]*i-this.m[1]*a+this.m[2]*o,t[2]=this.m[1]*l-this.m[2]*h+this.m[3]*u,t[6]=-(this.m[0]*l-this.m[2]*d+this.m[3]*c),t[10]=this.m[0]*f-this.m[1]*d+this.m[3]*p,t[14]=-(this.m[0]*u-this.m[1]*c+this.m[2]*p),t[3]=-(this.m[1]*g-this.m[2]*m+this.m[3]*w),t[7]=this.m[0]*g-this.m[2]*y+this.m[3]*A,t[11]=-(this.m[0]*m-this.m[1]*y+this.m[3]*v),t[15]=this.m[0]*w-this.m[1]*A+this.m[2]*v;let x=this.m[0]*t[0]+this.m[1]*t[4]+this.m[2]*t[8]+this.m[3]*t[12];for(let e=0;e<4;e++)for(let s=0;s<4;s++)t[4*e+s]*=1/x;return new e(t)}clone(){return new e([...this.m])}toString(){return this.m.toString()}};function x(e,t,s,n=e=>-Math.cos(e)){return e+(n(s)+1)/2*(t-e)}var b=2147483648,E=class{constructor(e){n(this,"seed"),this.seed=e}gen(){return this.seed=(1103515245*this.seed+12345)%b,this.seed/b}genNumber(e,t){return e+this.gen()*(t-e)}genVec2(e,t){return new p(this.genNumber(e.x,t.x),this.genNumber(e.y,t.y))}genColor(e,t){return new a(this.genNumber(e.r,t.r),this.genNumber(e.g,t.g),this.genNumber(e.b,t.b))}genAny(...e){if(0===e.length)return this.gen();if(1===e.length){if("number"==typeof e[0])return this.genNumber(0,e[0]);if(e[0]instanceof p)return this.genVec2(g(0,0),e[0]);if(e[0]instanceof a)return this.genColor(o(0,0,0),e[0])}else if(2===e.length){if("number"==typeof e[0]&&"number"==typeof e[1])return this.genNumber(e[0],e[1]);if(e[0]instanceof p&&e[1]instanceof p)return this.genVec2(e[0],e[1]);if(e[0]instanceof a&&e[1]instanceof a)return this.genColor(e[0],e[1])}throw new Error("More than 2 arguments not supported")}},M=new E(Date.now());function q(e){return null!=e&&(M.seed=e),M.seed}function S(...e){return M.genAny(...e)}function B(...e){return Math.floor(S(...e.length>0?e:[2]))}function R(e){return S()<=e}function I(e){for(let t=e.length-1;t>0;t--){let s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e}function P(e,t){return e.length<=t?e.slice():I(e.slice()).slice(0,t)}function C(e){return e[B(e.length)]}function k(e,t){return e.pos.x+e.width>t.pos.x&&e.pos.x<t.pos.x+t.width&&e.pos.y+e.height>t.pos.y&&e.pos.y<t.pos.y+t.height}function F(e,t){let s=function(e,t){if(e.p1.x===e.p2.x&&e.p1.y===e.p2.y||t.p1.x===t.p2.x&&t.p1.y===t.p2.y)return null;let s=(t.p2.y-t.p1.y)*(e.p2.x-e.p1.x)-(t.p2.x-t.p1.x)*(e.p2.y-e.p1.y);if(0===s)return null;let n=((t.p2.x-t.p1.x)*(e.p1.y-t.p1.y)-(t.p2.y-t.p1.y)*(e.p1.x-t.p1.x))/s,i=((e.p2.x-e.p1.x)*(e.p1.y-t.p1.y)-(e.p2.y-e.p1.y)*(e.p1.x-t.p1.x))/s;return n<0||n>1||i<0||i>1?null:n}(e,t);return s?g(e.p1.x+s*(e.p2.x-e.p1.x),e.p1.y+s*(e.p2.y-e.p1.y)):null}function T(e,t){let s=t.p2.sub(t.p1),n=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY;if(0!=s.x){let r=(e.pos.x-t.p1.x)/s.x,a=(e.pos.x+e.width-t.p1.x)/s.x;n=Math.max(n,Math.min(r,a)),i=Math.min(i,Math.max(r,a))}if(0!=s.y){let r=(e.pos.y-t.p1.y)/s.y,a=(e.pos.y+e.height-t.p1.y)/s.y;n=Math.max(n,Math.min(r,a)),i=Math.min(i,Math.max(r,a))}return i>=n&&i>=0&&n<=1}function D(e,t){return t.x>e.pos.x&&t.x<e.pos.x+e.width&&t.y>e.pos.y&&t.y<e.pos.y+e.height}function O(e,t){return g(Math.max(e.pos.x,Math.min(t.center.x,e.pos.x+e.width)),Math.max(e.pos.y,Math.min(t.center.y,e.pos.y+e.height))).sdist(t.center)<=t.radius*t.radius}function U(e,t){return V(t,new ie(e.points()))}function L(e,t){let s=t.sub(e.p1),n=e.p2.sub(e.p1);if(Math.abs(s.cross(n))>Number.EPSILON)return!1;let i=s.dot(n)/n.dot(n);return i>=0&&i<=1}function N(e,t){let s=e.p2.sub(e.p1),n=s.dot(s),i=e.p1.sub(t.center),r=2*s.dot(i),a=r*r-4*n*(i.dot(i)-t.radius*t.radius);if(n<=Number.EPSILON||a<0)return!1;if(0==a){let e=-r/(2*n);if(e>=0&&e<=1)return!0}else{let e=(-r+Math.sqrt(a))/(2*n),t=(-r-Math.sqrt(a))/(2*n);if(e>=0&&e<=1||t>=0&&t<=1)return!0}return j(t,e.p1)}function H(e,t){if(K(t,e.p1)||K(t,e.p2))return!0;for(let s=0;s<t.pts.length;s++){let n=t.pts[s],i=t.pts[(s+1)%t.pts.length];if(F(e,new ee(n,i)))return!0}return!1}function j(e,t){return e.center.sdist(t)<e.radius*e.radius}function G(e,t){let s=t.pts[t.pts.length-1];for(let n of t.pts){if(N(new ee(s,n),e))return!0;s=n}return!!j(e,t.pts[0])||K(t,e.center)}function V(e,t){for(let s=0;s<e.pts.length;s++)if(H(new ee(e.pts[s],e.pts[(s+1)%e.pts.length]),t))return!0;return!(!e.pts.some(e=>K(t,e))&&!t.pts.some(t=>K(e,t)))}function K(e,t){let s=!1,n=e.pts;for(let i=0,r=n.length-1;i<n.length;r=i++)n[i].y>t.y!=n[r].y>t.y&&t.x<(n[r].x-n[i].x)*(t.y-n[i].y)/(n[r].y-n[i].y)+n[i].x&&(s=!s);return s}function Y(e,t){t=t.sub(e.center);let s=h(e.angle),n=Math.cos(s),i=Math.sin(s),r=t.x*n+t.y*i,a=-t.x*i+t.y*n;return r*r/(e.radiusX*e.radiusX)+a*a/(e.radiusY*e.radiusY)<1}function X(e,t){let s=t.center.sub(e.center),n=h(e.angle),i=Math.cos(n),r=Math.sin(n),a=s.x*i+s.y*r,o=-s.x*r+s.y*i;return Y(new ne(g(),e.radiusX+t.radius,e.radiusY+t.radius,0),g(a,o))}function Q(e,t){let s=e.toMat2().inverse;return N(t=new ee(s.transform(t.p1.sub(e.center)),s.transform(t.p2.sub(e.center))),new se(g(),1))}function W(e,t){return z(e,new ie(t.points()))}function z(e,t){let s=e.toMat2().inverse;return t=new ie(t.pts.map(t=>s.transform(t.sub(e.center)))),G(new se(g(),1),t)}function Z(e,t){return t instanceof p?Y(e,t):t instanceof se?X(e,t):t instanceof ee?Q(e,t):t instanceof te?W(e,t):t instanceof ie?z(e,t):t instanceof ne&&function(e,t){if(e.radiusX===e.radiusY)return X(t,new se(e.center,e.radiusX));if(t.radiusX===t.radiusY)return X(e,new se(t.center,t.radiusX));let s=new A(1/e.radiusX**2,0,0,0,1/e.radiusY**2,0,0,0,-1),n=new A(1/t.radiusX**2,0,0,0,1/t.radiusY**2,0,0,0,-1),i=e.center.x,r=e.center.y,a=t.center.x,o=t.center.y,l=h(e.angle),u=h(t.angle),d=new A(Math.cos(l),-Math.sin(l),i,Math.sin(l),Math.cos(l),r,0,0,1),c=new A(Math.cos(u),-Math.sin(u),a,Math.sin(u),Math.cos(u),o,0,0,1),f=d.inverse,p=c.inverse,g=f.transpose.mul(s).mul(f),m=p.transpose.mul(n).mul(p),w=g.m11,y=g.m12,v=g.m13,x=g.m21,b=g.m22,E=g.m23,M=g.m31,q=g.m32,S=g.m33,B=m.m11,R=m.m12,I=m.m13,P=m.m21,C=m.m22,k=m.m23,F=m.m31,T=m.m32,D=m.m33,O=w*b*S-w*E*q-y*x*S+y*E*M+v*x*q-v*b*M,U=(w*b*D-w*E*T-w*q*k+w*S*C-y*x*D+y*E*F+y*M*k-y*S*P+v*x*T-v*b*F-v*M*C+v*q*P+x*q*I-x*S*R-b*M*I+b*S*B+E*M*R-E*q*B)/O,L=(w*C*D-w*k*T-y*P*D+y*k*F+v*P*T-v*C*F-x*R*D+x*I*T+b*B*D-b*I*F-E*B*T+E*R*F+M*R*k-M*I*C-q*B*k+q*I*P+S*B*C-S*R*P)/O,N=(B*C*D-B*k*T-R*P*D+R*k*F+I*P*T-I*C*F)/O;if(U>=0)return!(-3*L+U**2>0&&3*U*N+L*U**2-4*L**2<0&&-27*N**2+18*N*U*L+U**2*L**2-4*U**3*N-4*L**3>0);return!(-3*L+U**2>0&&-27*N**2+18*N*U*L+U**2*L**2-4*U**3*N-4*L**3>0)}(t,e)}function J(e,t,s){let n=e,i=s.p1,r=t,a=s.p2.sub(i),o=r.cross(a);if(Math.abs(o)<Number.EPSILON)return null;let l=i.sub(n),h=l.cross(a)/o;if(h<=0||h>=1)return null;let u=l.cross(r)/o;if(u<=0||u>=1)return null;let d=a.normal().unit();return t.dot(d)>0&&(d.x*=-1,d.y*=-1),{point:n.add(r.scale(h)),normal:d,fraction:h}}function _(e,t,s){let n=e,i=s.center,r=t,a=r.dot(r),o=n.sub(i),l=2*r.dot(o),h=l*l-4*a*(o.dot(o)-s.radius*s.radius);if(a<=Number.EPSILON||h<0)return null;if(0==h){let e=-l/(2*a);if(e>=0&&e<=1){let t=n.add(r.scale(e));return{point:t,normal:t.sub(i),fraction:e}}}else{let e=(-l+Math.sqrt(h))/(2*a),t=(-l-Math.sqrt(h))/(2*a),s=null;if(e>=0&&e<=1&&(s=e),t>=0&&t<=1&&(s=Math.min(t,s??t)),null!=s){let e=n.add(r.scale(s));return{point:e,normal:e.sub(i).unit(),fraction:s}}}return null}var $=class e{constructor(e){n(this,"pt"),this.pt=e.clone()}transform(t){return new e(t.multVec2(this.pt))}bbox(){return new te(this.pt,0,0)}area(){return 0}clone(){return new e(this.pt)}collides(e){return function(e,t){return t instanceof p?function(e,t){return e.x===t.x&&e.y===t.y}(t,e.pt):t instanceof se?j(t,e.pt):t instanceof ee?L(t,e.pt):t instanceof te?D(t,e.pt):t instanceof ie?K(t,e.pt):t instanceof ne&&Y(t,e.pt)}(this,e)}contains(e){return this.pt.eq(e)}raycast(e,t){return null}random(){return this.pt.clone()}},ee=class e{constructor(e,t){n(this,"p1"),n(this,"p2"),this.p1=e.clone(),this.p2=t.clone()}transform(t){return new e(t.multVec2(this.p1),t.multVec2(this.p2))}bbox(){return te.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new e(this.p1,this.p2)}collides(e){return function(e,t){return t instanceof p?L(e,t):t instanceof se?N(e,t):t instanceof ee?null!=F(e,t):t instanceof te?T(t,e):t instanceof ie?H(e,t):t instanceof ne&&Q(t,e)}(this,e)}contains(e){return this.collides(e)}raycast(e,t){return J(e,t,this)}random(){return this.p1.add(this.p2.sub(this.p1).scale(S(1)))}},te=class e{constructor(e,t,s){n(this,"pos"),n(this,"width"),n(this,"height"),this.pos=e.clone(),this.width=t,this.height=s}static fromPoints(t,s){return new e(t.clone(),s.x-t.x,s.y-t.y)}center(){return new p(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new ie(this.points().map(t=>e.multVec2(t)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new e(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let t=this.pos,s=this.pos.add(this.width,this.height),n=Math.max(t.x-e.x,0,e.x-s.x),i=Math.max(t.y-e.y,0,e.y-s.y);return n*n+i*i}collides(e){return function(e,t){return t instanceof p?D(e,t):t instanceof se?O(e,t):t instanceof ee?T(e,t):t instanceof te?k(e,t):t instanceof ie?U(e,t):t instanceof ne&&W(t,e)}(this,e)}contains(e){return this.collides(e)}raycast(e,t){return function(e,t,s){let n,i=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;if(0!=e.x){let a=(s.pos.x-e.x)/t.x,o=(s.pos.x+s.width-e.x)/t.x;n=g(-Math.sign(t.x),0),i=Math.max(i,Math.min(a,o)),r=Math.min(r,Math.max(a,o))}if(0!=e.y){let a=(s.pos.y-e.y)/t.y,o=(s.pos.y+s.height-e.y)/t.y;Math.min(a,o)>i&&(n=g(0,-Math.sign(t.y))),i=Math.max(i,Math.min(a,o)),r=Math.min(r,Math.max(a,o))}return r>=i&&i>=0&&i<=1?{point:e.add(t.scale(i)),normal:n,fraction:i}:null}(e,t,this)}random(){return this.pos.add(S(this.width),S(this.height))}},se=class e{constructor(e,t){n(this,"center"),n(this,"radius"),this.center=e.clone(),this.radius=t}transform(e){return new ne(this.center,this.radius,this.radius).transform(e)}bbox(){return te.fromPoints(this.center.sub(g(this.radius)),this.center.add(g(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new e(this.center,this.radius)}collides(e){return function(e,t){return t instanceof p?j(e,t):t instanceof se?function(e,t){return e.center.sdist(t.center)<(e.radius+t.radius)*(e.radius+t.radius)}(e,t):t instanceof ee?N(t,e):t instanceof te?O(t,e):t instanceof ie?G(e,t):t instanceof ne&&X(t,e)}(this,e)}contains(e){return this.collides(e)}raycast(e,t){return _(e,t,this)}random(){return this.center.add(p.fromAngle(S(360)).scale(S(this.radius)))}},ne=class e{constructor(e,t,s,i=0){n(this,"center"),n(this,"radiusX"),n(this,"radiusY"),n(this,"angle"),this.center=e.clone(),this.radiusX=t,this.radiusY=s,this.angle=i}static fromMat2(t){let s=t.inverse,n=s.transpose.mul(s),[i,r]=n.eigenvalues,[a,o]=n.eigenvectors(i,r),[l,h]=[1/Math.sqrt(i),1/Math.sqrt(r)];return l>h?new e(g(),l,h,u(Math.atan2(-a[1],a[0]))):new e(g(),h,l,u(Math.atan2(-o[1],o[0])))}toMat2(){let e=h(this.angle),t=Math.cos(e),s=Math.sin(e);return new y(t*this.radiusX,-s*this.radiusY,s*this.radiusX,t*this.radiusY)}transform(t){if(0==this.angle&&0==t.getRotation())return new e(t.multVec2(this.center),t.m[0]*this.radiusX,t.m[5]*this.radiusY);{let s=this.toMat2(),n=t.getRotation(),i=t.getScale();s=A.fromMat2(s).scale(i.x,i.y).rotate(n).toMat2();let r=e.fromMat2(s);return r.center=t.multVec2(this.center),r}}bbox(){if(0==this.angle)return te.fromPoints(this.center.sub(g(this.radiusX,this.radiusY)),this.center.add(g(this.radiusX,this.radiusY)));{let e=h(this.angle),t=Math.cos(e),s=Math.sin(e),n=this.radiusX*t,i=this.radiusX*s,r=this.radiusY*s,a=this.radiusY*t,o=Math.sqrt(n*n+r*r),l=Math.sqrt(i*i+a*a);return te.fromPoints(this.center.sub(g(o,l)),this.center.add(g(o,l)))}}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new e(this.center,this.radiusX,this.radiusY,this.angle)}collides(e){return Z(this,e)}contains(e){e=e.sub(this.center);let t=h(this.angle),s=Math.cos(t),n=Math.sin(t),i=e.x*s+e.y*n,r=-e.x*n+e.y*s;return i*i/(this.radiusX*this.radiusX)+r*r/(this.radiusY*this.radiusY)<1}raycast(e,t){return function(e,t,s){let n=s.toMat2(),i=n.inverse,r=_(i.transform(e.sub(s.center)),i.transform(t),new se(g(),1));if(r){let i=y.rotation(h(-s.angle)),a=y.scale(s.radiusX,s.radiusY).transform(r.point),o=n.transform(r.point).add(s.center),l=o.dist(e)/t.len();return{point:o,normal:i.transform(g(s.radiusY**2*a.x,s.radiusX**2*a.y)).unit(),fraction:l}}return r}(e,t,this)}random(){return this.center}};var ie=class e{constructor(e){if(n(this,"pts"),e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(t){return new e(this.pts.map(e=>t.multVec2(e)))}bbox(){let e=g(Number.MAX_VALUE),t=g(-Number.MAX_VALUE);for(let s of this.pts)e.x=Math.min(e.x,s.x),t.x=Math.max(t.x,s.x),e.y=Math.min(e.y,s.y),t.y=Math.max(t.y,s.y);return te.fromPoints(e,t)}area(){let e=0,t=this.pts.length;for(let s=0;s<t;s++){let n=this.pts[s],i=this.pts[(s+1)%t];e+=n.x*i.y*.5,e-=i.x*n.y*.5}return Math.abs(e)}clone(){return new e(this.pts.map(e=>e.clone()))}collides(e){return function(e,t){return t instanceof p?K(e,t):t instanceof se?G(t,e):t instanceof ee?H(t,e):t instanceof te?U(t,e):t instanceof ie?V(t,e):t instanceof ne&&z(t,e)}(this,e)}contains(e){return this.collides(e)}raycast(e,t){return function(e,t,s){let n=s.pts,i=null,r=n[n.length-1];for(let a=0;a<n.length;a++){let s=n[a],o=J(e,t,new ee(r,s));o&&(!i||i.fraction>o.fraction)&&(i=o),r=s}return i}(e,t,this)}random(){return g()}cut(t,s){new ee(t,s);let n=[],i=[],r=s.sub(t),a=this.pts[this.pts.length-1],o=a.sub(t),l=r.cross(o)>0;return this.pts.forEach(e=>{o=e.sub(t);let h=r.cross(o)>0;if(l!=h){let r=function(e,t,s,n){let i=t.sub(e),r=n.sub(s),a=i.cross(r);return a<1e-5&&a>-1e-5||(a=s.sub(e).cross(r)/a,a<0||a>1)?null:e.add(i.scale(a))}(a,e,t,s);n.push(r),i.push(r),l=h}(h?n:i).push(e),a=e}),[n.length?new e(n):null,i.length?new e(i):null]}};function re(e,t,s,n){let i=n*n,r=1-n,a=r*r;return e.scale(a).add(t.scale(2*r*n)).add(s.scale(i))}function ae(e,t,s,n){let i=1-n;return t.sub(e).scale(2*i).add(s.sub(t).scale(2*n))}function oe(e,t,s,n){return s.sub(t.scale(2)).add(e).scale(2)}function le(e,t,s,n,i){let r=i*i,a=r*i,o=1-i,l=o*o,h=l*o;return e.scale(h).add(t.scale(3*l*i)).add(s.scale(3*o*r)).add(n.scale(a))}function he(e,t,s,n,i){let r=i*i,a=1-i,o=a*a;return t.sub(e).scale(3*o).add(s.sub(t).scale(6*a*i)).add(n.sub(s).scale(3*r))}function ue(e,t,s,n,i){let r=1-i;return s.sub(t.scale(2)).add(e).scale(6*r).add(n.sub(s.scale(2)).add(t).scale(6*i))}function de(e,t,s,n,i){let r=((2-i)*i-1)*i*.5,a=.5*((3*i-5)*i*i+2),o=((-3*i+4)*i+1)*i*.5,l=(i-1)*i*i*.5;return e.scale(r).add(t.scale(a)).add(s.scale(o)).add(n.scale(l))}function ce(e,t,s,n,i){let r=.5*((-3*i+4)*i-1),a=(9*i-10)*i*.5,o=.5*((-9*i+8)*i+1),l=(3*i-2)*i*.5;return e.scale(r).add(t.scale(a)).add(s.scale(o)).add(n.scale(l))}function fe(e){let t=pe(e),s=t(1);return n=>{let i=t(n*s,!0);return e(i)}}function pe(e,t=10,s=10){let n=[0],i=[0],r=1/(t-1)/s,a=0,o=e(0),l=0;for(let h=1;h<t;h++){for(let t=0;t<s;t++){l+=r;let t=e(l),s=t.dist(o);a+=s,o=t}n[h]=a,i[h]=l}return i[t-1]=1,(e,s=!1)=>{if(s){let t=e;if(t<=0)return 0;if(t>=a)return 1;let s=0;for(;n[s+1]<t;)s++;let r=i[s],o=i[s+1],l=n[s];return r+(o-r)*((t-l)/(n[s+1]-l))}{if(e<=0)return 0;if(e>=1)return n[t-1];let s=0;for(;i[s+1]<e;)s++;let r=i[s],a=i[s+1],o=n[s];return o+(n[s+1]-o)*((e-r)/(a-r))}}}function ge(e,t,s,n){let i=2*e+t-2*n+s,r=-3*e+3*n-2*t-s,a=t,o=e;return e=>{let t=e*e;return i*(t*e)+r*t+a*e+o}}function me(e,t,s,n,i,r=ge){let a=r(t.x,(1-i)*(s.x-e.x),(1-i)*(n.x-t.x),s.x),o=r(t.y,(1-i)*(s.y-e.y),(1-i)*(n.y-t.y),s.y);return e=>new p(a(e),o(e))}function we(e,t,s,n,i=ge){return me(e,t,s,n,.5,i)}function ye(e,t,s,n,i=ge){return we(n.add(e.sub(t).scale(6)),e,n,e.add(n.sub(s).scale(6)),i)}function Ae(e,t,s,n,i,r,a,o=ge){let l=o(t.x,.5*(1-i)*(1+a)*(1+r)*(t.x-e.x)+.5*(1-i)*(1-a)*(1-r)*(s.x-t.x),.5*(1-i)*(1+a)*(1-r)*(s.x-t.x)+.5*(1-i)*(1-a)*(1+r)*(n.x-s.x),s.x),h=o(t.y,.5*(1-i)*(1+a)*(1+r)*(t.y-e.y)+.5*(1-i)*(1-a)*(1-r)*(s.y-t.y),.5*(1-i)*(1+a)*(1-r)*(s.y-t.y)+.5*(1-i)*(1-a)*(1+r)*(n.y-s.y),s.y);return e=>new p(l(e),h(e))}function ve(e,t,s,n){let i=2*e+t-2*n+s,r=-3*e+3*n-2*t+s,a=t;return e=>3*i*(e*e)+2*r*e+a}function xe(e){return 0<=e&&e<=1}function be(e,t){return Math.abs(e-t)<=Number.EPSILON}function Ee(e){return e<0?-Math.pow(-e,1/3):Math.pow(e,1/3)}function Me(e,t,s,n,i){let r=function(e,t,s,n){let i=3*e-6*t+3*s,r=-3*e+3*t,a=e,o=3*t-e-3*s+n;if(be(o,0)){if(be(i,0))return be(r,0)?[]:[-a/r].filter(xe);let e=Math.sqrt(r*r-4*i*a),t=2*i;return[(e-r)/t,(-r-e)/t].filter(xe)}i/=o,r/=o,a/=o;let l=(3*r-i*i)/3,h=l/3,u=(2*i*i*i-9*i*r+27*a)/27,d=u/2,c=d*d+h*h*h;if(c<0){let e=-l/3,t=e*e*e,s=Math.sqrt(t),n=-u/(2*s),r=n<-1?-1:n>1?1:n,a=Math.acos(r),o=2*Ee(s);return[o*Math.cos(a/3)-i/3,o*Math.cos((a+2*Math.PI)/3)-i/3,o*Math.cos((a+4*Math.PI)/3)-i/3].filter(xe)}if(0===c){let e=d<0?Ee(-d):-Ee(d);return[2*e-i/3,-e-i/3].filter(xe)}let f=Math.sqrt(c);return[Ee(f-d)-Ee(f+d)-i/3].filter(xe)}(e.x-i,t.x-i,s.x-i,n.x-i);return r.length>0?le(e,t,s,n,r[0]).y:NaN}function qe(e){if(!e||0==e.length)throw new Error("Need at least one point for easingLinear.");let t=e.length;return s=>{if(s<=0||1==e.length||s<=e[0].x)return e[0].y;for(let n=0;n<t;n++)if(e[n].x>=s)return c(s,e[n-1].x,e[n].x,e[n-1].y,e[n].y);return e[e.length-1].y}}function Se(e,t){return s=>Me(g(0,0),e,t,g(1,1),s)}function Be(e,t="jump-end"){let s=1/e,n=1/(e+("jump-end"==t||"jump-both"==t?1:0)),i="jump-start"==t||"jump-both"==t?n:0;return e=>{let t=Math.floor(e/s);return i+t*n}}function Re(e,t){let s=Number.MAX_VALUE,n={normal:g(0),distance:0};for(let i of[e,t])for(let r=0;r<i.pts.length;r++){let a=i.pts[r],o=i.pts[(r+1)%i.pts.length].sub(a).normal().unit(),l=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(let t=0;t<e.pts.length;t++){let s=e.pts[t].dot(o);l=Math.min(l,s),h=Math.max(h,s)}let u=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let e=0;e<t.pts.length;e++){let s=t.pts[e].dot(o);u=Math.min(u,s),d=Math.max(d,s)}let c=Math.min(h,d)-Math.max(l,u);if(c<0)return null;if(c<Math.abs(s)){let e=d-l,t=u-h;s=Math.abs(e)<Math.abs(t)?e:t,n.normal=o,n.distance=s}}return n}function Ie(e,t,s){return(t.x-e.x)*(s.y-e.y)-(t.y-e.y)*(s.x-e.x)>=0}function Pe(e,t,s,n){let i=n.x-s.x,r=n.y-s.y;return(i*(e.y-s.y)-r*(e.x-s.x))*(i*(t.y-s.y)-r*(t.x-s.x))>=0}function Ce(e,t,s,n){return Pe(e,t,s,n)&&Pe(e,s,t,n)&&Pe(e,n,t,s)}function ke(e,t,s,n){return Ie(e,t,s)&&!function(e,t,s,n){for(let i of e)if(i!==t&&i!==s&&i!==n&&Ce(i,t,s,n))return!0;return!1}(n,e,t,s)}function Fe(e){if(e.length<3)return[];if(3==e.length)return[e];let t=[],s=[],n=0;for(let d=0;d<e.length;d++){let i=e[n],r=e[d];r.x<i.x||r.x==i.x&&(r.y,i.y),t[d]=d+1,s[d]=d-1}t[t.length-1]=0,s[0]=s.length-1,function(e){let t=0,s=e[e.length-1];for(let n=0;n<e.length;n++)t+=(e[n].x-s.x)*(e[n].y+s.y),s=e[n];return t<0}(e)||([t,s]=[s,t]);let i=[];for(let d=0;d<e.length;++d)Ie(e[s[d]],e[d],e[t[d]])||i.push(e[d]);let r,a,o=[],l=e.length,h=1,u=0;for(;l>3;){r=t[h],a=s[h];let n=e[a],d=e[h],c=e[r];if(ke(n,d,c,i))o.push([n,d,c]),t[a]=r,s[r]=a,i.splice(i.indexOf(d),1),--l,u=0;else if(++u>l)return[];h=r}return r=t[h],a=s[h],o.push([e[a],e[h],e[r]]),o}function Te(e){if(e.length<3)return!1;let t=e.length-2,s=e.length-1,n=0,i=e[s].sub(e[t]),r=e[n].sub(e[s]),a=i.cross(r);for(;n+1<e.length;)if(t=s,s=n,n++,i=e[s].sub(e[t]),r=e[n].sub(e[s]),i.cross(r)*a<0)return!1;return!0}var De=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",Oe="topleft",Ue="monospace",Le="linear",Ne=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],He=8192*Ne.reduce((e,t)=>e+t.size,0),je="\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 0.0, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n",Ge="\nprecision mediump float;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\tvec4 texColor = texture2D(u_tex, v_uv);\n\treturn vec4((v_color.rgb * texColor.rgb), texColor.a) * v_color.a;\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n",Ve="\nvec4 vert(vec2 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n",Ke="\nvec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n",Ye=new Set(["id","require"]),Xe=new Set(["add","fixedUpdate","update","draw","destroy","inspect","drawInspect"]),Qe=Symbol.for("kaplay.cancel"),We=class extends Map{constructor(){super(...arguments),n(this,"lastID",0)}push(e){let t=this.lastID;return this.set(t,e),this.lastID++,t}pushd(e){let t=this.push(e);return()=>this.delete(t)}},ze=class e{constructor(e){n(this,"paused",!1),n(this,"cancel"),this.cancel=e}static join(t){let s=new e(()=>t.forEach(e=>e.cancel()));return Object.defineProperty(s,"paused",{get:()=>t[0].paused,set:e=>t.forEach(t=>t.paused=e)}),s.paused=!1,s}static replace(e,t){return e.cancel=()=>t.cancel(),t.paused=e.paused,Object.defineProperty(e,"paused",{get:()=>t.paused,set:e=>t.paused=e}),e}},Ze=class{constructor(){n(this,"cancellers",new WeakMap),n(this,"handlers",new We)}add(e){function t(...t){if(!n.paused)return e(...t)}let s=this.handlers.pushd(t),n=new ze(s);return this.cancellers.set(t,s),n}addOnce(e){let t=this.add((...s)=>{t.cancel(),e(...s)});return t}next(){return new Promise(e=>this.addOnce(e))}trigger(...e){this.handlers.forEach(t=>{let s;t(...e)===Qe&&(s=this.cancellers.get(t))&&s()})}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},Je=class{constructor(){n(this,"handlers",{}),n(this,"registers",{})}on(e,t){return this.handlers[e]||(this.handlers[e]=new Ze),this.handlers[e].add(t)}onOnce(e,t){let s=this.on(e,(...e)=>{s.cancel(),t(...e)});return s}next(e){return new Promise(t=>{this.onOnce(e,(...e)=>t(e[0]))})}trigger(e,...t){this.handlers[e]&&this.handlers[e].trigger(...t)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){var t;return(null==(t=this.handlers[e])?void 0:t.numListeners())??0}},_e=e=>e[0]instanceof a,$e=e=>e[0]instanceof p,et=e=>"number"==typeof e[0],tt=class{constructor(e=(e,t)=>e<t){n(this,"_items"),n(this,"_compareFn"),this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(0===this._items.length)return null;let e=this._items[0],t=this._items.pop();return 0!==this._items.length&&(this._items[0]=t,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let t=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[t])&&this._items[e]>=this._items[t])break;this.swap(e,t),e=t}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let t=2*e+1;if(t<this._items.length-1&&!this._compareFn(this._items[t],this._items[t+1])&&++t,this._compareFn(this._items[e],this._items[t]))break;this.swap(e,t),e=t}}swap(e,t){[this._items[e],this._items[t]]=[this._items[t],this._items[e]]}get length(){return this._items.length}};function st(e){return function(e){let t=window.atob(e),s=t.length,n=new Uint8Array(s);for(let i=0;i<s;i++)n[i]=t.charCodeAt(i);return n.buffer}(e.split(",")[1])}function nt(e,t){let s=document.createElement("a");s.href=t,s.download=e,s.click()}function it(e,t){nt(e,"data:text/plain;charset=utf-8,"+t)}function rt(e,t){it(e,JSON.stringify(t))}function at(e,t){let s=URL.createObjectURL(t);nt(e,s),URL.revokeObjectURL(s)}var ot=e=>e.match(/^data:\w+\/\w+;base64,.+/);function lt(e,t){if(e===t)return!0;let s=typeof e,n=typeof t;if(s!==n)return!1;if("object"===s&&"object"===n&&null!==e&&null!==t){if(Array.isArray(e)!==Array.isArray(t))return!1;let s=Object.keys(e),n=Object.keys(t);if(s.length!==n.length)return!1;for(let i of s){if(!lt(e[i],t[i]))return!1}return!0}return!1}var ht=new Set;function ut(e,t){!function(e){ht.has(e)||(ht.add(e),console.warn(e))}(`${e} is deprecated. Use ${t} instead.`)}function dt(e,t){return Number(e.toFixed(t))}function ct(e,t){return(...s)=>{let n=s.length;return n===e.length?e(...s):n===t.length?t(...s):void 0}}var ft=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function pt(e,t){let s=t[e];if(!function(e){return e&&xt(e[0].charCodeAt(0),55296,56319)}(s)||e===t.length-1)return 1;let n=s+t[e+1],i=t.substring(e+2,e+5);return gt(n)&&gt(i)?4:function(e){return xt(vt(e),127988,127988)}(n)&&function(e){let t=e.codePointAt(0);return"string"==typeof e&&"number"==typeof t&&xt(t,917504,917631)}(i)?t.slice(e).indexOf(String.fromCodePoint(917631))+2:function(e){return xt(vt(e),127995,127999)}(i)?4:2}function gt(e){return xt(vt(e),127462,127487)}function mt(e){return"string"==typeof e&&xt(e.charCodeAt(0),65024,65039)}function wt(e){return"string"==typeof e&&xt(e.charCodeAt(0),8400,8447)}function yt(e){return"string"==typeof e&&ft.includes(e.charCodeAt(0))}function At(e){return"string"==typeof e&&8205===e.charCodeAt(0)}function vt(e){return(e.charCodeAt(0)-55296<<10)+(e.charCodeAt(1)-56320)+65536}function xt(e,t,s){return e>=t&&e<=s}var bt=(e,t)=>Array.isArray(e)?null==e?void 0:e.includes(t):e===t,Et=(e,t)=>Array.isArray(t)?t.some(t=>e.has(t)):e.has(t),Mt=(e,t,s)=>{var n;e.has(t)?null==(n=e.get(t))||n.push(s):e.set(t,[s])},qt=(()=>{let e=0;return()=>e++})();function St(){let e=Zr.globalOpt.pixelDensity??1,t=Zr.globalOpt.width,s=Zr.globalOpt.height,n=Zr.gfx.ggl.gl.drawingBufferWidth/e,i=Zr.gfx.ggl.gl.drawingBufferHeight/e,r=0,a=0,o=n,l=i;if(Zr.globalOpt.letterbox){if(!t||!s)throw new Error("Letterboxing requires width and height defined.");let e=t/s;if(n/i>e){let t=i*e;r=(n-t)/2,o=t}else{let t=n/e;l=t,a=(i-t)/2}}if(Zr.globalOpt.stretch&&(!Zr.globalOpt.width||!Zr.globalOpt.height))throw new Error("Stretching requires width and height defined.");Zr.gfx.viewport={x:r,y:a,width:o,height:l,scale:(Zr.gfx.viewport.width+Zr.gfx.viewport.height)/(Zr.gfx.width+Zr.gfx.height)}}function Bt(e){return new p((e.x-Zr.gfx.viewport.x)*Zr.gfx.width/Zr.gfx.viewport.width,(e.y-Zr.gfx.viewport.y)*Zr.gfx.height/Zr.gfx.viewport.height)}var Rt,It=()=>Rt.lastInputDevice,Pt=class{constructor(){n(this,"pressed",new Set([])),n(this,"pressedRepeat",new Set([])),n(this,"released",new Set([])),n(this,"down",new Set([]))}update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}},Ct=class{constructor(){n(this,"buttonState",new Pt),n(this,"stickState",new Map)}},kt=class{constructor(){n(this,"dts",[]),n(this,"timer",0),n(this,"fps",0)}tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((e,t)=>e+t)/this.dts.length)),this.dts=[])}},Ft={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},Tt=e=>{if(!e.canvas)throw new Error("Please provide a canvas");let t=(e=>{let t=e.buttons??{};return{canvas:e.canvas,buttons:t,buttonsByKey:new Map,buttonsByMouse:new Map,buttonsByGamepad:new Map,buttonsByKeyCode:new Map,loopID:null,stopped:!1,dt:0,fixedDt:.02,restDt:0,time:0,realTime:0,fpsCounter:new kt,timeScale:1,skipTime:!1,isHidden:!1,numFrames:0,mousePos:new p(0),mouseDeltaPos:new p(0),keyState:new Pt,mouseState:new Pt,mergedGamepadState:new Ct,gamepadStates:new Map,lastInputDevice:null,buttonState:new Pt,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:e.canvas.offsetWidth,lastHeight:e.canvas.offsetHeight,events:new Je}})(e);function s(){return t.dt*t.timeScale}function n(){return document.fullscreenElement===t.canvas||document.webkitFullscreenElement===t.canvas}function i(){return t.mousePos.clone()}function r(){return t.mouseDeltaPos.clone()}Rt=t,(()=>{let e=Rt.buttons;for(let t in e){let s=e[t].keyboard&&[e[t].keyboard].flat(),n=e[t].keyboardCode&&[e[t].keyboardCode].flat(),i=e[t].gamepad&&[e[t].gamepad].flat(),r=e[t].mouse&&[e[t].mouse].flat();s&&s.forEach(e=>{Mt(Rt.buttonsByKey,e,t)}),n&&n.forEach(e=>{Mt(Rt.buttonsByKeyCode,e,t)}),i&&i.forEach(e=>{Mt(Rt.buttonsByGamepad,e,t)}),r&&r.forEach(e=>{Mt(Rt.buttonsByMouse,e,t)})}})();let a=ct(e=>t.events.on("keyDown",e),(e,s)=>t.events.on("keyDown",t=>bt(e,t)&&s(t))),o=ct(e=>t.events.on("keyPress",t=>e(t)),(e,s)=>t.events.on("keyPress",t=>bt(e,t)&&s(t))),l=ct(e=>t.events.on("keyPressRepeat",e),(e,s)=>t.events.on("keyPressRepeat",t=>bt(e,t)&&s(t))),h=ct(e=>t.events.on("keyRelease",e),(e,s)=>t.events.on("keyRelease",t=>bt(e,t)&&s(t))),u=ct(e=>t.events.on("mouseDown",t=>e(t)),(e,s)=>t.events.on("mouseDown",t=>bt(e,t)&&s(t))),d=ct(e=>t.events.on("mousePress",t=>e(t)),(e,s)=>t.events.on("mousePress",t=>bt(e,t)&&s(t))),f=ct(e=>t.events.on("mouseRelease",t=>e(t)),(e,s)=>t.events.on("mouseRelease",t=>t===e&&s(t)));let m=ct(e=>t.events.on("gamepadButtonPress",(t,s)=>e(t,s)),(e,s)=>t.events.on("gamepadButtonPress",(t,n)=>bt(e,t)&&s(t,n))),w=ct(e=>t.events.on("gamepadButtonDown",(t,s)=>e(t,s)),(e,s)=>t.events.on("gamepadButtonDown",(t,n)=>bt(e,t)&&s(t,n))),y=ct(e=>t.events.on("gamepadButtonRelease",(t,s)=>e(t,s)),(e,s)=>t.events.on("gamepadButtonRelease",(t,n)=>bt(e,t)&&s(t,n)));function A(){return[...t.gamepads]}let v=ct(e=>t.events.on("buttonPress",t=>e(t)),(e,s)=>t.events.on("buttonPress",t=>bt(e,t)&&s(t))),x=ct(e=>t.events.on("buttonDown",t=>e(t)),(e,s)=>t.events.on("buttonDown",t=>bt(e,t)&&s(t))),b=ct(e=>t.events.on("buttonRelease",t=>e(t)),(e,s)=>t.events.on("buttonRelease",t=>bt(e,t)&&s(t)));function E(){t.events.trigger("input"),t.keyState.down.forEach(e=>t.events.trigger("keyDown",e)),t.mouseState.down.forEach(e=>t.events.trigger("mouseDown",e)),t.buttonState.down.forEach(e=>{t.events.trigger("buttonDown",e)}),function(){var s,n;for(let e of navigator.getGamepads())e&&!t.gamepadStates.has(e.index)&&q(e);for(let i of t.gamepads){let r=navigator.getGamepads()[i.index];if(!r)continue;let a=(e.gamepads??{})[r.id]||Ft[r.id]||Ft.default,o=t.gamepadStates.get(i.index);if(o){for(let e=0;e<r.buttons.length;e++){let l=a.buttons[e],h=r.buttons[e],u=t.buttonsByGamepad.has(l);if(h.pressed){if(o.buttonState.down.has(l)){t.events.trigger("gamepadButtonDown",l,i);continue}t.lastInputDevice="gamepad",u&&(null==(s=t.buttonsByGamepad.get(l))||s.forEach(e=>{t.buttonState.press(e),t.events.trigger("buttonPress",e)})),t.mergedGamepadState.buttonState.press(l),o.buttonState.press(l),t.events.trigger("gamepadButtonPress",l,i)}else o.buttonState.down.has(l)&&(u&&(null==(n=t.buttonsByGamepad.get(l))||n.forEach(e=>{t.buttonState.release(e),t.events.trigger("buttonRelease",e)})),t.mergedGamepadState.buttonState.release(l),o.buttonState.release(l),t.events.trigger("gamepadButtonRelease",l,i))}for(let e in a.sticks){let s=a.sticks[e];if(!s)continue;let n=new p(r.axes[s.x],r.axes[s.y]);o.stickState.set(e,n),t.mergedGamepadState.stickState.set(e,n),t.events.trigger("gamepadStick",e,n,i)}}}}()}function M(){t.keyState.update(),t.mouseState.update(),t.buttonState.update(),t.mergedGamepadState.buttonState.update(),t.mergedGamepadState.stickState.forEach((e,s)=>{t.mergedGamepadState.stickState.set(s,new p(0))}),t.charInputted=[],t.isMouseMoved=!1,t.mouseDeltaPos=new p(0),t.gamepadStates.forEach(e=>{e.buttonState.update(),e.stickState.forEach((t,s)=>{e.stickState.set(s,new p(0))})})}function q(e){let s={index:e.index,isPressed:s=>{var n;return(null==(n=t.gamepadStates.get(e.index))?void 0:n.buttonState.pressed.has(s))||!1},isDown:s=>{var n;return(null==(n=t.gamepadStates.get(e.index))?void 0:n.buttonState.down.has(s))||!1},isReleased:s=>{var n;return(null==(n=t.gamepadStates.get(e.index))?void 0:n.buttonState.released.has(s))||!1},getStick:s=>{var n;return(null==(n=t.gamepadStates.get(e.index))?void 0:n.stickState.get(s))||g()}};return t.gamepads.push(s),t.gamepadStates.set(e.index,{buttonState:new Pt,stickState:new Map([["left",new p(0)],["right",new p(0)]])}),s}let S={},B={},R={},I=e.pixelDensity||1;S.mousemove=e=>{let s=Bt(new p(e.offsetX,e.offsetY)),i=new p(e.movementX,e.movementY);if(n()){let n=t.canvas.width/I,i=t.canvas.height/I,r=window.innerWidth,a=window.innerHeight;if(r/a>n/i){let t=a/i,o=(r-n*t)/2;s.x=c(e.offsetX-o,0,n*t,0,n),s.y=c(e.offsetY,0,i*t,0,i)}else{let t=r/n,o=(a-i*t)/2;s.x=c(e.offsetX,0,n*t,0,n),s.y=c(e.offsetY-o,0,i*t,0,i)}}t.events.onOnce("input",()=>{t.isMouseMoved=!0,t.mousePos=s,t.mouseDeltaPos=i,t.events.trigger("mouseMove")})};let P=["left","middle","right","back","forward"];S.mousedown=e=>{t.events.onOnce("input",()=>{var s;let n=P[e.button];n&&(t.lastInputDevice="mouse",t.buttonsByMouse.has(n)&&(null==(s=t.buttonsByMouse.get(n))||s.forEach(e=>{t.buttonState.press(e),t.events.trigger("buttonPress",e)})),t.mouseState.press(n),t.events.trigger("mousePress",n))})},S.mouseup=e=>{t.events.onOnce("input",()=>{var s;let n=P[e.button];n&&(t.buttonsByMouse.has(n)&&(null==(s=t.buttonsByMouse.get(n))||s.forEach(e=>{t.buttonState.release(e),t.events.trigger("buttonRelease",e)})),t.mouseState.release(n),t.events.trigger("mouseRelease",n))})};let C=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),k={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};S.keydown=e=>{C.has(e.key)&&e.preventDefault(),t.events.onOnce("input",()=>{var s,n;let i=k[e.key]||e.key.toLowerCase(),r=e.code;if(void 0===i)throw new Error(`Unknown key: ${e.key}`);1===i.length?(t.events.trigger("charInput",i),t.charInputted.push(i)):"space"===i&&(t.events.trigger("charInput"," "),t.charInputted.push(" ")),e.repeat?(t.keyState.pressRepeat(i),t.events.trigger("keyPressRepeat",i)):(t.lastInputDevice="keyboard",t.buttonsByKey.has(i)&&(null==(s=t.buttonsByKey.get(i))||s.forEach(e=>{t.buttonState.press(e),t.events.trigger("buttonPress",e)})),t.buttonsByKeyCode.has(r)&&(null==(n=t.buttonsByKeyCode.get(r))||n.forEach(e=>{t.buttonState.press(e),t.events.trigger("buttonPress",e)})),t.keyState.press(i),t.events.trigger("keyPressRepeat",i),t.events.trigger("keyPress",i))})},S.keyup=e=>{t.events.onOnce("input",()=>{var s,n;let i=k[e.key]||e.key.toLowerCase(),r=e.code;t.buttonsByKey.has(i)&&(null==(s=t.buttonsByKey.get(i))||s.forEach(e=>{t.buttonState.release(e),t.events.trigger("buttonRelease",e)})),t.buttonsByKeyCode.has(r)&&(null==(n=t.buttonsByKeyCode.get(r))||n.forEach(e=>{t.buttonState.release(e),t.events.trigger("buttonRelease",e)})),t.keyState.release(i),t.events.trigger("keyRelease",i)})},S.touchstart=s=>{s.preventDefault(),t.events.onOnce("input",()=>{var n;let i=[...s.changedTouches],r=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=Bt(new p(i[0].clientX-r.x,i[0].clientY-r.y)),t.lastInputDevice="mouse",t.buttonsByMouse.has("left")&&(null==(n=t.buttonsByMouse.get("left"))||n.forEach(e=>{t.buttonState.press(e),t.events.trigger("buttonPress",e)})),t.mouseState.press("left"),t.events.trigger("mousePress","left")),i.forEach(e=>{t.events.trigger("touchStart",Bt(new p(e.clientX-r.x,e.clientY-r.y)),e)})})},S.touchmove=s=>{s.preventDefault(),t.events.onOnce("input",()=>{let n=[...s.changedTouches],i=t.canvas.getBoundingClientRect();if(!1!==e.touchToMouse){let e=t.mousePos;t.mousePos=Bt(new p(n[0].clientX-i.x,n[0].clientY-i.y)),t.mouseDeltaPos=t.mousePos.sub(e),t.events.trigger("mouseMove")}n.forEach(e=>{t.events.trigger("touchMove",Bt(new p(e.clientX-i.x,e.clientY-i.y)),e)})})},S.touchend=s=>{t.events.onOnce("input",()=>{var n;let i=[...s.changedTouches],r=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=Bt(new p(i[0].clientX-r.x,i[0].clientY-r.y)),t.mouseDeltaPos=new p(0,0),t.buttonsByMouse.has("left")&&(null==(n=t.buttonsByMouse.get("left"))||n.forEach(e=>{t.buttonState.release(e),t.events.trigger("buttonRelease",e)})),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),i.forEach(e=>{t.events.trigger("touchEnd",Bt(new p(e.clientX-r.x,e.clientY-r.y)),e)})})},S.touchcancel=s=>{t.events.onOnce("input",()=>{let n=[...s.changedTouches],i=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=Bt(new p(n[0].clientX-i.x,n[0].clientY-i.y)),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),n.forEach(e=>{t.events.trigger("touchEnd",Bt(new p(e.clientX-i.x,e.clientY-i.y)),e)})})},S.wheel=e=>{e.preventDefault(),t.events.onOnce("input",()=>{t.events.trigger("scroll",new p(e.deltaX,e.deltaY))})},S.contextmenu=e=>e.preventDefault(),B.visibilitychange=()=>{"visible"===document.visibilityState?(t.skipTime=!0,t.isHidden=!1,t.events.trigger("show")):(t.isHidden=!0,t.events.trigger("hide"))},R.gamepadconnected=e=>{let s=q(e.gamepad);t.events.onOnce("input",()=>{t.events.trigger("gamepadConnect",s)})},R.gamepaddisconnected=e=>{let s=A().filter(t=>t.index===e.gamepad.index)[0];(function(e){t.gamepads=t.gamepads.filter(t=>t.index!==e.index),t.gamepadStates.delete(e.index)})(e.gamepad),t.events.onOnce("input",()=>{t.events.trigger("gamepadDisconnect",s)})};for(let[c,p]of Object.entries(S))t.canvas.addEventListener(c,p);for(let[c,p]of Object.entries(B))document.addEventListener(c,p);for(let[c,p]of Object.entries(R))window.addEventListener(c,p);let F=new ResizeObserver(e=>{for(let s of e)if(s.target===t.canvas){if(t.lastWidth===t.canvas.offsetWidth&&t.lastHeight===t.canvas.offsetHeight)return;t.lastWidth=t.canvas.offsetWidth,t.lastHeight=t.canvas.offsetHeight,t.events.onOnce("input",()=>{t.events.trigger("resize")})}});return F.observe(t.canvas),{state:t,dt:s,fixedDt:function(){return t.fixedDt*t.timeScale},restDt:function(){return t.restDt*t.timeScale},time:function(){return t.time},run:function(n,i){null!==t.loopID&&cancelAnimationFrame(t.loopID);let r=0,a=0,o=l=>{if(t.stopped)return;if("visible"!==document.visibilityState)return void(t.loopID=requestAnimationFrame(o));let h=l/1e3,u=Math.min(h-t.realTime,.25),d=e.maxFPS?1/e.maxFPS:0;if(t.realTime=h,a+=u,a>d){if(!t.skipTime){for(r+=a,t.dt=t.fixedDt,t.restDt=0;r>t.fixedDt;)r-=t.fixedDt,r<t.fixedDt&&(t.restDt=r),n();t.restDt=r,t.dt=a,t.time+=s(),t.fpsCounter.tick(t.dt)}a=0,t.skipTime=!1,t.numFrames++,i(E,M)}t.loopID=requestAnimationFrame(o)};o(0)},canvas:t.canvas,fps:function(){return t.fpsCounter.fps},numFrames:function(){return t.numFrames},quit:function(){t.stopped=!0;let e=Object.entries(S),s=Object.entries(B),n=Object.entries(R);for(let[i,r]of e)t.canvas.removeEventListener(i,r);for(let[t,i]of s)document.removeEventListener(t,i);for(let[t,i]of n)window.removeEventListener(t,i);F.disconnect()},isHidden:function(){return t.isHidden},setFullscreen:function(e=!0){e?function(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}(t.canvas):document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()},isFullscreen:n,setCursor:function(e){t.canvas.style.cursor=e},screenshot:function(){return t.canvas.toDataURL()},getGamepads:A,getCursor:function(){return t.canvas.style.cursor},setCursorLocked:function(e){if(e)try{let e=t.canvas.requestPointerLock();(null==e?void 0:e.catch)&&e.catch(e=>console.error(e))}catch(s){console.error(s)}else document.exitPointerLock()},isCursorLocked:function(){return!!document.pointerLockElement},isTouchscreen:function(){return"ontouchstart"in window||navigator.maxTouchPoints>0},mousePos:i,mouseDeltaPos:r,isKeyDown:function(e){return void 0===e?t.keyState.down.size>0:Et(t.keyState.down,e)},isKeyPressed:function(e){return void 0===e?t.keyState.pressed.size>0:Et(t.keyState.pressed,e)},isKeyPressedRepeat:function(e){return void 0===e?t.keyState.pressedRepeat.size>0:Et(t.keyState.pressedRepeat,e)},isKeyReleased:function(e){return void 0===e?t.keyState.released.size>0:Et(t.keyState.released,e)},isMouseDown:function(e="left"){return t.mouseState.down.has(e)},isMousePressed:function(e="left"){return t.mouseState.pressed.has(e)},isMouseReleased:function(e="left"){return t.mouseState.released.has(e)},isMouseMoved:function(){return t.isMouseMoved},isGamepadButtonPressed:function(e){return void 0===e?t.mergedGamepadState.buttonState.pressed.size>0:Et(t.mergedGamepadState.buttonState.pressed,e)},isGamepadButtonDown:function(e){return void 0===e?t.mergedGamepadState.buttonState.down.size>0:Et(t.mergedGamepadState.buttonState.down,e)},isGamepadButtonReleased:function(e){return void 0===e?t.mergedGamepadState.buttonState.released.size>0:Et(t.mergedGamepadState.buttonState.released,e)},getGamepadStick:function(e){return t.mergedGamepadState.stickState.get(e)||new p(0)},isButtonPressed:function(e){return void 0===e?t.buttonState.pressed.size>0:Et(t.buttonState.pressed,e)},isButtonDown:function(e){return void 0===e?t.buttonState.down.size>0:Et(t.buttonState.down,e)},isButtonReleased:function(e){return void 0===e?t.buttonState.released.size>0:Et(t.buttonState.released,e)},setButton:function(e,s){t.buttons[e]={...t.buttons[e],...s}},getButton:function(e){var s;return null==(s=t.buttons)?void 0:s[e]},pressButton:function(e){t.buttonState.press(e),t.events.trigger("buttonPress",e)},releaseButton:function(e){t.buttonState.release(e),t.events.trigger("buttonRelease",e)},charInputted:function(){return[...t.charInputted]},onResize:function(e){return t.events.on("resize",e)},onKeyDown:a,onKeyPress:o,onKeyPressRepeat:l,onKeyRelease:h,onMouseDown:u,onMousePress:d,onMouseRelease:f,onMouseMove:function(e){return t.events.on("mouseMove",()=>e(i(),r()))},onCharInput:function(e){return t.events.on("charInput",e)},onTouchStart:function(e){return t.events.on("touchStart",e)},onTouchMove:function(e){return t.events.on("touchMove",e)},onTouchEnd:function(e){return t.events.on("touchEnd",e)},onScroll:function(e){return t.events.on("scroll",e)},onHide:function(e){return t.events.on("hide",e)},onShow:function(e){return t.events.on("show",e)},onGamepadButtonDown:w,onGamepadButtonPress:m,onGamepadButtonRelease:y,onGamepadStick:function(e,s){return t.events.on("gamepadStick",(t,n,i)=>t===e&&s(n,i))},onGamepadConnect:function(e){t.events.on("gamepadConnect",e)},onGamepadDisconnect:function(e){t.events.on("gamepadDisconnect",e)},onButtonPress:v,onButtonDown:x,onButtonRelease:b,getLastInputDeviceType:It,events:t.events}};function Dt(){return Zr.app.dt()}function Ot(){return Zr.app.fixedDt()}function Ut(){return Zr.app.restDt()}var Lt=new p(-1,-1),Nt=new p(0,-1),Ht=new p(1,-1),jt=new p(-1,0),Gt=new p(0,0),Vt=new p(1,0),Kt=new p(-1,1),Yt=new p(0,1),Xt=new p(1,1);function Qt(e){switch(e){case"topleft":return Lt;case"top":return Nt;case"topright":return Ht;case"left":return jt;case"center":return Gt;case"right":return Vt;case"botleft":return Kt;case"bot":return Yt;case"botright":return Xt;default:return e}}function Wt(e){switch(e){case"left":default:return 0;case"center":return.5;case"right":return 1}}var zt=2.5949095,Zt=2.70158,Jt=2*Math.PI/3,_t=2*Math.PI/4.5,$t={linear:e=>e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInExpo:e=>0===e?0:Math.pow(2,10*e-10),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>Zt*e*e*e-1.70158*e*e,easeOutBack:e=>1+Zt*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*(7.189819*e-zt)/2:(Math.pow(2*e-2,2)*((zt+1)*(2*e-2)+zt)+2)/2,easeInElastic:e=>0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*Jt),easeOutElastic:e=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*Jt)+1,easeInOutElastic:e=>0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*_t)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*_t)/2+1,easeInBounce:e=>1-$t.easeOutBounce(1-e),easeOutBounce:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,easeInOutBounce:e=>e<.5?(1-$t.easeOutBounce(1-2*e))/2:(1+$t.easeOutBounce(2*e-1))/2},es=$t;var ts=class{constructor(e,t,s){n(this,"a"),n(this,"b"),n(this,"polygon"),this.a=e,this.b=t,this.polygon=new WeakRef(s)}isLeft(e,t){return(this.b.x-this.a.x)*(t-this.a.y)-(e-this.a.x)*(this.b.y-this.a.y)}get middle(){return this.a.add(this.b).scale(.5)}},ss=class{constructor(e){n(this,"_edges"),n(this,"_centroid"),n(this,"_id"),this._id=e}get id(){return this._id}set edges(e){this._edges=e;let t=0,s=0,n=0;for(let i of this._edges){i.polygon=new WeakRef(this);let e=i.a.x*i.b.y-i.a.y*i.b.x;t+=(i.a.x+i.b.x)*e,s+=(i.a.y+i.b.y)*e,n+=e}n/=2,this._centroid=g(t/(6*n),s/(6*n))}get edges(){return this._edges}get centroid(){return this._centroid}contains(e){let t=!1;for(let s of this.edges)s.b.y>e.y!=s.a.y>e.y&&e.x<(s.a.x-s.b.x)*(e.y-s.b.y)/(s.a.y-s.b.y)+s.b.x&&(t=!t);return t}},ns=class{constructor(){n(this,"_polygons"),n(this,"_pointCache"),n(this,"_edgeCache"),this._polygons=[],this._pointCache={},this._edgeCache={}}_addPoint(e){let t=this._pointCache[`${e.x}_${e.y}`];return t||(t=e.clone(),this._pointCache[`${e.x}_${e.y}`]=t,t)}_addEdge(e){let t=`${e.a.x}_${e.a.y}-${e.b.x}_${e.b.y}`;return this._edgeCache[t]=e,e}_findEdge(e,t){let s=`${e.x}_${e.y}-${t.x}_${t.y}`;return this._edgeCache[s]}_findCommonEdge(e,t){for(let s of e.edges){let e=this._findEdge(s.b,s.a);if(e&&e.polygon.deref().id===t.id)return e}return null}addPolygon(e){let t=new ss(this._polygons.length),s=e.map((s,n)=>new ts(s,e[(n+1)%e.length],t));t.edges=s,this._polygons.push(t);for(let n of t.edges)this._addEdge(n);return t}addRect(e,t){let s=this._addPoint(e),n=this._addPoint(e.add(t.x,0)),i=this._addPoint(e.add(t)),r=this._addPoint(e.add(0,t.y));return this.addPolygon([s,n,i,r])}_getLocation(e){for(let t of this._polygons)if(t.contains(e))return t;return null}getNeighbours(e){let t=[];for(let s of this._polygons[e].edges){let e=this._findEdge(s.b,s.a);if(e){let s=e.polygon.deref();s&&t.push(s.id)}}return t}getCost(e,t){return 1}getHeuristic(e,t){let s=this._polygons[e],n=this._polygons[t],i=s.centroid.x-n.centroid.x,r=s.centroid.y-n.centroid.y;return Math.sqrt(i*i+r*r)}getPath(e,t){return void 0===e||void 0===t?[]:e===t?[e,t]:function(e,t,s){var n;let i=new tt((e,t)=>e.cost<t.cost);i.insert({cost:0,node:t});let r=new Map;r.set(t,t);let a=new Map;for(a.set(t,0);0!==i.length;){let t=null==(n=i.remove())?void 0:n.node;if(t===s)break;let o=e.getNeighbours(t);for(let n of o){let o=(a.get(t)||0)+e.getCost(t,n)+e.getHeuristic(n,s);(!a.has(n)||o<a.get(n))&&(a.set(n,o),i.insert({cost:o,node:n}),r.set(n,t))}}return function(e,t,s){let n=[],i=t;for(n.push(i);i!==e;){if(i=s.get(i),null==i)return null;n.push(i)}return n.reverse()}(t,s,r)}(this,e,t)}getWaypointPath(e,t,s){let n=(null==s?void 0:s.type)||"centroids",i=this._getLocation(e),r=this._getLocation(t);if(void 0===i||void 0===r)return[];let a=this.getPath(i.id,r.id);if(!a)return[];if("edges"===n){let s=[];for(let e=1;e<a.length;e++){let t=this._polygons[a[e-1]],n=this._polygons[a[e]],i=this._findCommonEdge(t,n);s.push(i.middle.add(n.centroid.sub(i.middle).unit().scale(4)))}return[e,...s,t]}return[e,...a.slice(1,-1).map(e=>this._polygons[e].centroid),t]}};function is(e){let t=new v;return e.pos&&t.translate(e.pos),e.scale&&t.scale(e.scale),e.angle&&t.rotate(e.angle),e.parent?t.mult(e.parent.transform):t}function rs(e){return new p(e.x/ms()*2-1,-e.y/ws()*2+1)}function as(e,t,s,n,i,r=1){n=h(n%360),(i=h(i%360))<=n&&(i+=2*Math.PI);let a=[],o=Math.ceil((i-n)/h(8)*r),l=(i-n)/o,u=g(Math.cos(n),Math.sin(n)),d=g(Math.cos(l),Math.sin(l));for(let h=0;h<=o;h++)a.push(e.add(t*u.x,s*u.y)),u=g(u.x*d.x-u.y*d.y,u.x*d.y+u.y*d.x);return a}function os(...e){let t=o(...e),s=e[3]??1;Zr.gfx.bgColor=t,Zr.gfx.bgAlpha=s,Zr.gfx.ggl.gl.clearColor(t.r/255,t.g/255,t.b/255,s)}function ls(){var e,t;return(null==(t=null==(e=Zr.gfx.bgColor)?void 0:e.clone)?void 0:t.call(e))??null}function hs(...e){if(void 0===e[0])return;let t=g(...e);0===t.x&&0===t.y||Zr.gfx.transform.translate(t)}function us(){Zr.gfx.transformStack.push(Zr.gfx.transform.clone())}function ds(e){Zr.gfx.transform=e.clone()}function cs(...e){if(void 0===e[0])return;let t=g(...e);1===t.x&&1===t.y||Zr.gfx.transform.scale(t)}function fs(e){e&&Zr.gfx.transform.rotate(e)}function ps(){Zr.gfx.transformStack.length>0&&(Zr.gfx.transform=Zr.gfx.transformStack.pop())}function gs(){Zr.gfx.renderer.flush()}function ms(){return Zr.gfx.width}function ws(){return Zr.gfx.height}function ys(){return(Zr.gfx.viewport.width+Zr.gfx.viewport.height)/(Zr.gfx.width+Zr.gfx.height)}function As(){return g(ms()/2,ws()/2)}var vs=class{constructor(e,t,s,i){n(this,"lastTextureId",0),n(this,"textures",[]),n(this,"bigTextures",[]),n(this,"texturesPosition",new Map),n(this,"canvas"),n(this,"c2d"),n(this,"x",0),n(this,"y",0),n(this,"curHeight",0),n(this,"gfx"),n(this,"padding"),this.gfx=e,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=s,this.textures=[fn.fromImage(e,this.canvas)],this.bigTextures=[],this.padding=i;let r=this.canvas.getContext("2d");if(!r)throw new Error("Failed to get 2d context");this.c2d=r}addSingle(e){let t=fn.fromImage(this.gfx,e);return this.bigTextures.push(t),[t,new m(0,0,1,1),0]}add(e){let t=e.width+2*this.padding,s=e.height+2*this.padding;if(t>this.canvas.width||s>this.canvas.height)return this.addSingle(e);this.x+t>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+s>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(fn.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let n=this.textures[this.textures.length-1],i=new p(this.x+this.padding,this.y+this.padding);return this.x+=t,s>this.curHeight&&(this.curHeight=s),e instanceof ImageData?this.c2d.putImageData(e,i.x,i.y):this.c2d.drawImage(e,i.x,i.y),n.update(this.canvas),this.texturesPosition.set(this.lastTextureId,{position:i,size:new p(e.width,e.height),texture:n}),this.lastTextureId++,[n,new m(i.x/this.canvas.width,i.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height),this.lastTextureId-1]}free(){for(let e of this.textures)e.free();for(let e of this.bigTextures)e.free()}};function xs(e){return"string"!=typeof e||ot(e)?e:Zr.assets.urlPrefix+e}var bs=class e{constructor(e){n(this,"loaded",!1),n(this,"data",null),n(this,"error",null),n(this,"onLoadEvents",new Ze),n(this,"onErrorEvents",new Ze),n(this,"onFinishEvents",new Ze),e.then(e=>{this.loaded=!0,this.data=e,this.onLoadEvents.trigger(e)}).catch(e=>{if(this.error=e,!(this.onErrorEvents.numListeners()>0))throw e;this.onErrorEvents.trigger(e)}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(t){let s=new e(Promise.resolve(t));return s.data=t,s.loaded=!0,s}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},Es=class{constructor(){n(this,"assets",new Map),n(this,"lastUID",0)}add(e,t){let s=e??this.lastUID+++"",n=new bs(t);return this.assets.set(s,n),n}addLoaded(e,t){let s=e??this.lastUID+++"",n=bs.loaded(t);return this.assets.set(s,n),n}get(e){return this.assets.get(e)}progress(){if(0===this.assets.size)return 1;let e=0;return this.assets.forEach(t=>{t.loaded&&e++}),e/this.assets.size}getFailedAssets(){return Array.from(this.assets.keys()).filter(e=>null!==this.assets.get(e).error).map(e=>[e,this.assets.get(e)])}};function Ms(e){return fetch(e).then(t=>{if(!t.ok)throw new Error(`Failed to fetch "${e}"`);return t})}function qs(e){return Ms(e).then(e=>e.json())}function Ss(e){return void 0!==e&&(Zr.assets.urlPrefix=e),Zr.assets.urlPrefix}function Bs(e,t){return Zr.assets.custom.add(e,qs(xs(t)))}function Rs(e){let t=new Image;return t.crossOrigin="anonymous",t.src=e,new Promise((s,n)=>{t.onload=()=>s(t),t.onerror=()=>n(new Error(`Failed to load image from "${e}"`))})}function Is(){let e=[Zr.assets.sprites,Zr.assets.sounds,Zr.assets.shaders,Zr.assets.fonts,Zr.assets.bitmapFonts,Zr.assets.custom];return e.reduce((e,t)=>e+t.progress(),0)/e.length}function Ps(){return[Zr.assets.sprites,Zr.assets.sounds,Zr.assets.shaders,Zr.assets.fonts,Zr.assets.bitmapFonts,Zr.assets.custom].reduce((e,t)=>e.concat(t.getFailedAssets()),[])}function Cs(e){return Zr.assets.custom.get(e)??null}function ks(e){return Zr.assets.custom.add(null,e)}var Fs=class e{constructor(e,t,s={},i=null){n(this,"tex"),n(this,"frames",[new m(0,0,1,1)]),n(this,"anims",{}),n(this,"slice9",null),this.tex=e,t&&(this.frames=t),this.anims=s,this.slice9=i}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(t,s={}){return"string"==typeof t?e.fromURL(t,s):Promise.resolve(e.fromImage(t,s))}static fromImage(t,s={}){let[n,i]=s.singular?Zr.assets.packer.addSingle(t):Zr.assets.packer.add(t),r=s.frames?s.frames.map(e=>new m(i.x+e.x*i.w,i.y+e.y*i.h,e.w*i.w,e.h*i.h)):Us(s.sliceX||1,s.sliceY||1,i.x,i.y,i.w,i.h);return new e(n,r,s.anims,s.slice9)}static fromURL(t,s={}){return Rs(t).then(t=>e.fromImage(t,s))}};function Ts(e){if("string"==typeof e){let t=Ds(e);if(t)return t;if(Is()<1)return null;throw new Error(`Sprite not found: ${e}`)}if(e instanceof Fs)return bs.loaded(e);if(e instanceof bs)return e;throw new Error(`Invalid sprite: ${e}`)}function Ds(e){return Zr.assets.sprites.get(e)??null}function Os(e,t,s={sliceX:1,sliceY:1,anims:{}}){return t=xs(t),Array.isArray(t)?t.some(e=>"string"==typeof e)?Zr.assets.sprites.add(e,Promise.all(t.map(e=>"string"==typeof e?Rs(e):Promise.resolve(e))).then(e=>Ls(e,s))):Zr.assets.sprites.addLoaded(e,Ls(t,s)):"string"==typeof t?Zr.assets.sprites.add(e,Fs.from(t,s)):Zr.assets.sprites.addLoaded(e,Fs.fromImage(t,s))}function Us(e=1,t=1,s=0,n=0,i=1,r=1){let a=[],o=i/e,l=r/t;for(let h=0;h<t;h++)for(let t=0;t<e;t++)a.push(new m(s+t*o,n+h*l,o,l));return a}function Ls(e,t={}){let s=document.createElement("canvas"),n=e[0].width,i=e[0].height;s.width=n*e.length,s.height=i;let r=s.getContext("2d");if(!r)throw new Error("Failed to create canvas context");e.forEach((e,t)=>{e instanceof ImageData?r.putImageData(e,t*n,0):r.drawImage(e,t*n,0)});let a=r.getImageData(0,0,e.length*n,i);return Fs.fromImage(a,{...t,sliceX:e.length,sliceY:1})}function Ns(e="bean"){return Os(e,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==")}function Hs(e,t,s){t=xs(t),s=xs(s),"string"==typeof t&&!s&&(s=(e=>e.split(".").slice(0,-1).join("."))(t)+".json");let n="string"==typeof s?qs(s):Promise.resolve(s);return Zr.assets.sprites.add(e,n.then(e=>{let s=e.meta.size,n=e.frames.map(e=>new m(e.frame.x/s.w,e.frame.y/s.h,e.frame.w/s.w,e.frame.h/s.h)),i={};for(let t of e.meta.frameTags)t.from===t.to?i[t.name]=t.from:i[t.name]={from:t.from,to:t.to,speed:10,loop:!0,pingpong:"pingpong"===t.direction};return Fs.from(t,{frames:n,anims:i})}))}var js=class{constructor(e,t={}){if(n(this,"fontface"),n(this,"filter",Le),n(this,"outline",null),n(this,"size",64),this.fontface=e,this.filter=t.filter??Le,this.size=t.size??64,this.size>256)throw new Error("Max font size: 256");t.outline&&(this.outline={width:1,color:o(0,0,0)},"number"==typeof t.outline?this.outline.width=t.outline:"object"==typeof t.outline&&(t.outline.width&&(this.outline.width=t.outline.width),t.outline.color&&(this.outline.color=t.outline.color)))}};function Gs(e){if(!e)return Gs(Zr.globalOpt.font??"monospace");if("string"==typeof e){let t=Ys(e),s=Vs(e);if(t)return t.data??t;if(s)return s.data??s;if(document.fonts.check(`64px ${e}`))return e;if(Is()<1)return null;throw new Error(`Font not found: ${e}`)}return e instanceof bs&&e.data?e.data:e}function Vs(e){return Zr.assets.fonts.get(e)??null}function Ks(e,t,s={}){let n=xs(t),i=new FontFace(e,"string"==typeof t?`url(${n})`:n);return document.fonts.add(i),Zr.assets.fonts.add(e,i.load().catch(e=>{throw new Error(`Failed to load font from "${n}": ${e}`)}).then(e=>new js(e,s)))}function Ys(e){return Zr.assets.bitmapFonts.get(e)??null}function Xs(e,t,s,n,i={}){let r=xs(t);return Zr.assets.bitmapFonts.add(e,Rs(r).then(e=>function(e,t,s,n){let i=e.width/t,r={},a=n.split("").entries();for(let[o,l]of a)r[l]=new m(o%i*t,Math.floor(o/i)*s,t,s);return{tex:e,map:r,size:s}}(fn.fromImage(Zr.gfx.ggl,e,i),s,n,i.chars??De)))}function Qs(e,t){return t=xs(t),Zr.assets.sprites.add(e,new Promise(async e=>{let s="string"==typeof t?await qs(t):t,n=await Promise.all(s.frames.map(Rs)),i=document.createElement("canvas");i.width=s.width,i.height=s.height*s.frames.length;let r=i.getContext("2d");if(!r)throw new Error("Failed to create canvas context");n.forEach((e,t)=>{r.drawImage(e,0,t*s.height)}),e(await Os(null,i,{sliceY:s.frames.length,anims:s.anims}))}))}var Ws=class{constructor(e,t,s,i){n(this,"ctx"),n(this,"glProgram"),this.ctx=e,e.onDestroy(()=>this.free());let r=e.gl,a=r.createShader(r.VERTEX_SHADER),o=r.createShader(r.FRAGMENT_SHADER);if(!a||!o)throw new Error("Failed to create shader");r.shaderSource(a,t),r.shaderSource(o,s),r.compileShader(a),r.compileShader(o);let l=r.createProgram();if(this.glProgram=l,r.attachShader(l,a),r.attachShader(l,o),i.forEach((e,t)=>r.bindAttribLocation(l,t,e)),r.linkProgram(l),!r.getProgramParameter(l,r.LINK_STATUS)){let e=r.getShaderInfoLog(a);if(e)throw new Error("VERTEX SHADER "+e);let t=r.getShaderInfoLog(o);if(t)throw new Error("FRAGMENT SHADER "+t)}r.deleteShader(a),r.deleteShader(o)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let t=this.ctx.gl;for(let s in e){let n=e[s],i=t.getUniformLocation(this.glProgram,s);if("number"==typeof n)t.uniform1f(i,n);else if(n instanceof v)t.uniformMatrix4fv(i,!1,new Float32Array(n.m));else if(n instanceof a)t.uniform3f(i,n.r,n.g,n.b);else if(n instanceof p)t.uniform2f(i,n.x,n.y);else{if(!Array.isArray(n))throw new Error("Unsupported uniform data type");n[0],et(n)?t.uniform1fv(i,n):$e(n)?t.uniform2fv(i,n.map(e=>[e.x,e.y]).flat()):_e(n)&&t.uniform3fv(i,n.map(e=>[e.r,e.g,e.b]).flat())}}}free(){this.ctx.gl.deleteProgram(this.glProgram)}};function zs(e,t=Ve,s=Ke){let n=je.replace("{{user}}",t??Ve),i=Ge.replace("{{user}}",s??Ke);try{return new Ws(e,n,i,Ne.map(e=>e.name))}catch(r){let e=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,t=(e=>e instanceof Error?e.message:String(e))(r).match(e);if(!(null==t?void 0:t.groups))throw r;let s=Number(t.groups.line)-14,n=t.groups.msg.trim(),i=t.groups.type.toLowerCase();throw new Error(`${i} shader line ${s}: ${n}`)}}function Zs(e){return Zr.assets.shaders.get(e)??null}function Js(e,t,s){return Zr.assets.shaders.addLoaded(e,zs(Zr.gfx.ggl,t,s))}function _s(e,t,s){t=xs(t),s=xs(s);let n=e=>e?function(e){return Ms(e).then(e=>e.text())}(e):Promise.resolve(null),i=Promise.all([n(t),n(s)]).then(([e,t])=>zs(Zr.gfx.ggl,e,t));return Zr.assets.shaders.add(e,i)}var $s=class e{constructor(e){n(this,"buf"),this.buf=e}static fromArrayBuffer(t){return new Promise((e,s)=>Zr.audio.ctx.decodeAudioData(t,e,s)).then(t=>new e(t))}static fromURL(t){return ot(t)?e.fromArrayBuffer(st(t)):(s=t,Ms(s).then(e=>e.arrayBuffer())).then(t=>e.fromArrayBuffer(t));var s}};function en(e){return Zr.assets.sounds.get(e)??null}function tn(e,t){return t=xs(t),Zr.assets.sounds.add(e,"string"==typeof t?$s.fromURL(t):$s.fromArrayBuffer(t))}function sn(e,t){let s=xs(t);return new Audio(s).preload="auto",Zr.assets.music[e]=s}function nn(e,t){return e=xs(e),ks("string"==typeof t?new Promise((s,n)=>{qs(t).then(t=>{nn(e,t).then(s).catch(n)})}):Fs.from(e).then(e=>{let s={};for(let n in t){let i=t[n],r=e.frames[0],a=2048*r.w,o=2048*r.h,l=i.frames?i.frames.map(e=>new m(r.x+(i.x+e.x)/a*r.w,r.y+(i.y+e.y)/o*r.h,e.w/a*r.w,e.h/o*r.h)):Us(i.sliceX||1,i.sliceY||1,r.x+i.x/a*r.w,r.y+i.y/o*r.h,i.width/a*r.w,i.height/o*r.h),h=new Fs(e.tex,l,i.anims);Zr.assets.sprites.addLoaded(n,h),s[n]=h}return s}))}function rn(e,t,s=!1,n,i,r={}){let a=n??Zr.gfx.defTex,o=function(e){if(!e)return Zr.gfx.defShader;if("string"==typeof e){let t=Zs(e);if(t)return t.data??t;if(Is()<1)return null;throw new Error(`Shader not found: ${e}`)}return e instanceof bs&&e.data?e.data:e}(i??Zr.gfx.defShader);if(!o||o instanceof bs)return;let l=Zr.gfx.fixed||s?Zr.gfx.transform:Zr.game.cam.transform.mult(Zr.gfx.transform),h=[];for(let u of e){let e=rs(l.multVec2(u.pos));h.push(e.x,e.y,u.uv.x,u.uv.y,u.color.r/255,u.color.g/255,u.color.b/255,u.opacity)}Zr.gfx.renderer.push(Zr.gfx.ggl.gl.TRIANGLES,h,t,o,a,r)}function an(e){if(!e.pts)throw new Error('drawPolygon() requires property "pts".');let t=e.pts.length;if(!(t<3)){if(us(),hs(e.pos),cs(e.scale),fs(e.angle),hs(e.offset),!1!==e.fill){let s,n=e.color??a.WHITE,i=e.pts.map((t,s)=>({pos:new p(t.x,t.y),uv:e.uv?e.uv[s]:new p(0,0),color:e.colors&&e.colors[s]?e.colors[s].mult(n):n,opacity:e.opacity??1}));s=e.triangulate?Fe(e.pts).map(t=>t.map(t=>e.pts.indexOf(t))).flat():[...Array(t-2).keys()].map(e=>[0,e+1,e+2]).flat(),rn(i,e.indices??s,e.fixed,e.uv?e.tex:Zr.gfx.defTex,e.shader,e.uniform??void 0)}e.outline&&un({pts:[...e.pts,e.pts[0]],radius:e.radius,width:e.outline.width,color:e.outline.color,join:e.outline.join,uniform:e.uniform,fixed:e.fixed,opacity:e.opacity??e.outline.opacity}),ps()}}function on(e){if(void 0===e.radiusX||void 0===e.radiusY)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(0===e.radiusX||0===e.radiusY)return;let t=e.start??0,s=e.end??360,n=Qt(e.anchor??"center").scale(new p(-e.radiusX,-e.radiusY)),i=as(n,e.radiusX,e.radiusY,t,s,e.resolution);i.unshift(n);let r=Object.assign({},e,{pts:i,radius:0,...e.gradient?{colors:[e.gradient[0],...Array(i.length-1).fill(e.gradient[1])]}:{}});if(s-t>=360&&e.outline)return!1!==e.fill&&an(Object.assign({},r,{outline:null})),void an(Object.assign({},r,{pts:i.slice(1),fill:!1}));an(r)}function ln(e){if("number"!=typeof e.radius)throw new Error('drawCircle() requires property "radius".');0!==e.radius&&on(Object.assign({},e,{radiusX:e.radius,radiusY:e.radius,angle:0}))}function hn(e){let{p1:t,p2:s}=e;if(!t||!s)throw new Error('drawLine() requires properties "p1" and "p2".');let n=e.width||1,i=s.sub(t).unit().normal().scale(.5*n);rn([t.sub(i),t.add(i),s.add(i),s.sub(i)].map(t=>({pos:new p(t.x,t.y),uv:new p(0),color:e.color??a.WHITE,opacity:e.opacity??1})),[0,1,3,1,2,3],e.fixed,Zr.gfx.defTex,e.shader,e.uniform??void 0)}function un(e){let t=e.pts,s=e.width??1;if(!t)throw new Error('drawLines() requires property "pts".');if(!(t.length<2)){if(t.length>2)switch(e.join){case"bevel":return function(e){let t,s=e.pts,n=[],i=.5*(e.width||1),r=s[0]===s[s.length-1]||s[0].eq(s[s.length-1]),o=e.pos||g(0,0);t=r?s[0].sub(s[s.length-2]):s[1].sub(s[0]);let l,h=t.len(),u=t.normal().scale(-i/h),d=s[0];if(!r)switch(e.cap){case"square":{let e=t.scale(-i/h);n.push(d.add(e).add(u)),n.push(d.add(e).sub(u));break}case"round":{let e=Math.max(i,10),t=Math.PI/e,s=u.scale(-1),r=Math.cos(t),a=Math.sin(t);for(let i=0;i<e;i++)n.push(d),n.push(d.sub(s)),s=g(s.x*r-s.y*a,s.x*a+s.y*r)}}for(let a=1;a<s.length;a++){if(d===s[a]||d.eq(s[a]))continue;l=d,d=s[a];let e=d.sub(l),r=e.len(),o=e.normal().scale(-i/r),c=t.cross(e);if(Math.abs(c)/(h*r)<.05){n.push(l.add(u)),n.push(l.sub(u)),t.dot(e)<0&&(n.push(l.sub(u)),n.push(l.add(u))),t=e,h=r,u=o;continue}let f=o.sub(u).cross(e)/c,p=u.add(t.scale(f));c>0?(n.push(l.add(p)),n.push(l.sub(u)),n.push(l.add(p)),n.push(l.sub(o))):(n.push(l.add(u)),n.push(l.sub(p)),n.push(l.add(o)),n.push(l.sub(p))),t=e,h=r,u=o}if(!r)switch(n.push(d.add(u)),n.push(d.sub(u)),e.cap){case"square":{let e=t.scale(i/h);n.push(d.add(e).add(u)),n.push(d.add(e).sub(u));break}case"round":{let e=Math.max(i,10),t=Math.PI/e,s=u.scale(1),r=Math.cos(t),a=Math.sin(t);for(let i=0;i<e;i++)s=g(s.x*r-s.y*a,s.x*a+s.y*r),n.push(d),n.push(d.sub(s))}}if(n.length<4)return;let c=n.map(t=>({pos:o.add(t),uv:g(),color:e.color||a.WHITE,opacity:e.opacity??1})),f=[],p=0;for(let a=0;a<n.length-2;a+=2)f[p++]=a+1,f[p++]=a,f[p++]=a+2,f[p++]=a+2,f[p++]=a+3,f[p++]=a+1;r&&(f[p++]=n.length-1,f[p++]=n.length-2,f[p++]=0,f[p++]=0,f[p++]=1,f[p++]=n.length-1),rn(c,f,e.fixed,Zr.gfx.defTex,e.shader,e.uniform??void 0)}(e);case"round":return function(e){let t,s=e.pts,n=[],i=.5*(e.width||1),r=s[0]===s[s.length-1]||s[0].eq(s[s.length-1]),o=e.pos||g(0,0);t=r?s[0].sub(s[s.length-2]):s[1].sub(s[0]);let l,u=t.len(),d=t.normal().scale(-i/u),c=s[0];if(!r)switch(e.cap){case"square":{let e=t.scale(-i/u);n.push(c.add(e).add(d)),n.push(c.add(e).sub(d));break}case"round":{let e=Math.max(i,10),t=Math.PI/e,s=d.scale(-1),r=Math.cos(t),a=Math.sin(t);for(let i=0;i<e;i++)n.push(c),n.push(c.sub(s)),s=g(s.x*r-s.y*a,s.x*a+s.y*r)}}for(let a=1;a<s.length;a++){if(c===s[a]||c.eq(s[a]))continue;l=c,c=s[a];let e=c.sub(l),r=e.len(),o=e.normal().scale(-i/r),f=t.cross(e);if(Math.abs(f)/(u*r)<.05){n.push(l.add(d)),n.push(l.sub(d)),t.dot(e)<0&&(n.push(l.sub(d)),n.push(l.add(d))),t=e,u=r,d=o;continue}let p=o.sub(d).cross(e)/f,m=d.add(t.scale(p));if(f>0){let e=l.add(m),t=Math.max(i,10),s=h(d.angleBetween(o)/t),r=d,a=Math.cos(s),u=Math.sin(s);for(let i=0;i<t;i++)n.push(e),n.push(l.sub(r)),r=g(r.x*a-r.y*u,r.x*u+r.y*a)}else{let e=l.sub(m),t=Math.max(i,10),s=h(d.angleBetween(o)/t),r=d,a=Math.cos(s),u=Math.sin(s);for(let i=0;i<t;i++)n.push(l.add(r)),n.push(e),r=g(r.x*a-r.y*u,r.x*u+r.y*a)}t=e,u=r,d=o}if(!r)switch(n.push(c.add(d)),n.push(c.sub(d)),e.cap){case"square":{let e=t.scale(i/u);n.push(c.add(e).add(d)),n.push(c.add(e).sub(d));break}case"round":{let e=Math.max(i,10),t=Math.PI/e,s=d.scale(1),r=Math.cos(t),a=Math.sin(t);for(let i=0;i<e;i++)s=g(s.x*r-s.y*a,s.x*a+s.y*r),n.push(c),n.push(c.sub(s))}}if(n.length<4)return;let f=n.map(t=>({pos:o.add(t),uv:g(),color:e.color||a.WHITE,opacity:e.opacity??1})),p=[],m=0;for(let a=0;a<n.length-2;a+=2)p[m++]=a+1,p[m++]=a,p[m++]=a+2,p[m++]=a+2,p[m++]=a+3,p[m++]=a+1;r&&(p[m++]=n.length-1,p[m++]=n.length-2,p[m++]=0,p[m++]=0,p[m++]=1,p[m++]=n.length-1),rn(f,p,e.fixed,Zr.gfx.defTex,e.shader,e.uniform??void 0)}(e);case"miter":return function(e){let t,s=e.pts,n=[],i=.5*(e.width||1),r=s[0]===s[s.length-1]||s[0].eq(s[s.length-1]),o=e.pos||g(0,0);t=r?s[0].sub(s[s.length-2]):s[1].sub(s[0]);let l,h=t.len(),u=t.normal().scale(-i/h),d=s[0];if(!r)switch(e.cap){case"square":{let e=t.scale(-i/h);n.push(d.add(e).add(u)),n.push(d.add(e).sub(u));break}case"round":{let e=Math.max(i,10),t=Math.PI/e,s=u.scale(-1),r=Math.cos(t),a=Math.sin(t);for(let i=0;i<e;i++)n.push(d),n.push(d.sub(s)),s=g(s.x*r-s.y*a,s.x*a+s.y*r)}}for(let a=1;a<s.length;a++){if(d===s[a]||d.eq(s[a]))continue;l=d,d=s[a];let e=d.sub(l),r=e.len(),o=e.normal().scale(-i/r),c=t.cross(e);if(Math.abs(c)/(h*r)<.05){n.push(l.add(u)),n.push(l.sub(u)),t.dot(e)<0&&(n.push(l.sub(u)),n.push(l.add(u))),t=e,h=r,u=o;continue}let f=o.sub(u).cross(e)/c,p=u.add(t.scale(f));n.push(l.add(p)),n.push(l.sub(p)),t=e,h=r,u=o}if(!r)switch(n.push(d.add(u)),n.push(d.sub(u)),e.cap){case"square":{let e=t.scale(i/h);n.push(d.add(e).add(u)),n.push(d.add(e).sub(u));break}case"round":{let e=Math.max(i,10),t=Math.PI/e,s=u.scale(1),r=Math.cos(t),a=Math.sin(t);for(let i=0;i<e;i++)s=g(s.x*r-s.y*a,s.x*a+s.y*r),n.push(d),n.push(d.sub(s))}}if(n.length<4)return;let c=n.map(t=>({pos:o.add(t),uv:g(),color:e.color||a.WHITE,opacity:e.opacity??1})),f=[],p=0;for(let a=0;a<n.length-2;a+=2)f[p++]=a+1,f[p++]=a,f[p++]=a+2,f[p++]=a+2,f[p++]=a+3,f[p++]=a+1;r&&(f[p++]=n.length-1,f[p++]=n.length-2,f[p++]=0,f[p++]=0,f[p++]=1,f[p++]=n.length-1),rn(c,f,e.fixed,Zr.gfx.defTex,e.shader,e.uniform??void 0)}(e)}if(e.radius&&t.length>=3){hn(Object.assign({},e,{p1:t[0],p2:t[1]}));for(let s=1;s<t.length-2;s++){let n=t[s],i=t[s+1];hn(Object.assign({},e,{p1:n,p2:i}))}hn(Object.assign({},e,{p1:t[t.length-2],p2:t[t.length-1]}))}else for(let n=0;n<t.length-1;n++)hn(Object.assign({},e,{p1:t[n],p2:t[n+1]})),"none"!==e.join&&ln(Object.assign({},e,{pos:t[n],radius:s/2}))}}function dn(e,t){let s=t.segments??16,n=[];for(let i=0;i<=s;i++)n.push(e(i/s));un({pts:n,width:t.width||1,pos:t.pos,color:t.color,opacity:t.opacity})}function cn(e){dn(t=>le(e.pt1,e.pt2,e.pt3,e.pt4,t),e)}var fn=class e{constructor(e,t,s,i={}){n(this,"ctx"),n(this,"src",null),n(this,"glTex"),n(this,"width"),n(this,"height"),this.ctx=e;let r=e.gl,a=e.gl.createTexture();if(!a)throw new Error("Failed to create texture");this.glTex=a,e.onDestroy(()=>this.free()),this.width=t,this.height=s;let o={linear:r.LINEAR,nearest:r.NEAREST}[i.filter??e.opts.texFilter??"nearest"],l={repeat:r.REPEAT,clampToEdge:r.CLAMP_TO_EDGE}[i.wrap??"clampToEdge"];this.bind(),t&&s&&r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,s,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,l),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,l),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.unbind()}static fromImage(t,s,n={}){let i=new e(t,s.width,s.height,n);return i.update(s),i.src=s,i}update(e,t=0,s=0){let n=this.ctx.gl;this.bind(),n.texSubImage2D(n.TEXTURE_2D,0,t,s,n.RGBA,n.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},pn=class{constructor(e,t,s,i={}){n(this,"ctx"),n(this,"tex"),n(this,"glFramebuffer"),n(this,"glRenderbuffer"),this.ctx=e;let r=e.gl;e.onDestroy(()=>this.free()),this.tex=new fn(e,t,s,i);let a=r.createFramebuffer(),o=r.createRenderbuffer();if(!a||!o)throw new Error("Failed to create framebuffer");this.glFramebuffer=a,this.glRenderbuffer=o,this.bind(),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.tex.glTex,0),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,t=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,t),this.unbind();let s=4*this.width,n=new Uint8Array(s);for(let i=0;i<(this.height/2|0);i++){let e=i*s,r=(this.height-i-1)*s;n.set(t.subarray(e,e+s)),t.copyWithin(e,r,r+s),t.set(n,r)}return new ImageData(t,this.width,this.height)}toDataURL(){let e=document.createElement("canvas"),t=e.getContext("2d");if(e.width=this.width,e.height=this.height,!t)throw new Error("Failed to get 2d context");return t.putImageData(this.toImageData(),0,0),e.toDataURL()}clear(){let e=this.ctx.gl;e.clear(e.COLOR_BUFFER_BIT)}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},gn=class{constructor(e,t,s,i){n(this,"ctx"),n(this,"glVBuf"),n(this,"glIBuf"),n(this,"vqueue",[]),n(this,"iqueue",[]),n(this,"stride"),n(this,"maxVertices"),n(this,"maxIndices"),n(this,"vertexFormat"),n(this,"numDraws",0),n(this,"curPrimitive",null),n(this,"curTex",null),n(this,"curShader",null),n(this,"curUniform",{});let r=e.gl;this.vertexFormat=t,this.ctx=e,this.stride=t.reduce((e,t)=>e+t.size,0),this.maxVertices=s,this.maxIndices=i;let a=r.createBuffer();if(!a)throw new Error("Failed to create vertex buffer");this.glVBuf=a,e.pushArrayBuffer(this.glVBuf),r.bufferData(r.ARRAY_BUFFER,4*s,r.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=r.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),r.bufferData(r.ELEMENT_ARRAY_BUFFER,4*i,r.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,t,s,n,i=null,r={}){(e!==this.curPrimitive||i!==this.curTex||n!==this.curShader||!lt(this.curUniform,r)||this.vqueue.length+t.length*this.stride>this.maxVertices||this.iqueue.length+s.length>this.maxIndices)&&this.flush();let a=this.vqueue.length/this.stride;for(let o of t)this.vqueue.push(o);for(let o of s)this.iqueue.push(o+a);this.curPrimitive=e,this.curShader=n,this.curTex=i,this.curUniform=r}flush(){var e,t;if(!this.curPrimitive||!this.curShader||0===this.vqueue.length||0===this.iqueue.length)return;let s=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),s.bufferSubData(s.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),null==(e=this.curTex)||e.bind(),s.drawElements(this.curPrimitive,this.iqueue.length,s.UNSIGNED_SHORT,0),null==(t=this.curTex)||t.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}};function mn(e){let t=[],s=()=>t[t.length-1];return[s=>{t.push(s),e(s)},()=>{t.pop(),e(s()??null)},s]}var wn={};function yn(e,t){t.override?Object.assign(e,t):(t.pos&&(e.pos=e.pos.add(t.pos)),t.scale&&(e.scale=e.scale.scale(g(t.scale))),t.angle&&(e.angle+=t.angle),t.color&&1===e.ch.length&&(e.color=e.color.mult(t.color)),null!=t.opacity&&(e.opacity*=t.opacity))}function An(e){let t={},s="",n=[],i=String(e),r=e=>{n.length>0&&(t[s.length]=n.slice()),s+=e};for(;""!==i;)if("\\"!==i[0]){if("["===i[0]){let e=/^\[(\/)?(\w+?)\]/.exec(i);if(!e){r(i[0]),i=i.slice(1);continue}let[t,s,a]=e;if(void 0!==s){let e=n.pop();if(e!==a)throw void 0!==e?new Error(`Styled text error: mismatched tags. Expected [/${e}], got [/${a}]`):new Error(`Styled text error: stray end tag [/${a}]`)}else n.push(a);i=i.slice(t.length);continue}r(i[0]),i=i.slice(1)}else{if(1===i.length)throw new Error("Styled text error: \\ at end of string");r(i[1]),i=i.slice(2)}if(n.length>0)throw new Error(`Styled text error: unclosed tags ${n}`);return{charStyleMap:t,text:s}}function vn(e){var t,s,n;if(void 0===e.text)throw new Error('formatText() requires property "text".');let i=Gs(e.font);if(!e.text||""===e.text||i instanceof bs||!i)return{width:0,height:0,chars:[],opt:e,renderedText:""};let{charStyleMap:r,text:o}=An(e.text+""),l=function(e){if("string"!=typeof e)throw new TypeError("string cannot be undefined or null");let t=[],s=0,n=0;for(;s<e.length;)n+=pt(s+n,e),yt(e[s+n])&&n++,mt(e[s+n])&&n++,wt(e[s+n])&&n++,At(e[s+n])?n++:(t.push(e.substring(s,s+n)),s+=n,n=0);return t}(o);if(i instanceof js||"string"==typeof i){let e=i instanceof js?i.fontface.family:i,n=i instanceof js?{outline:i.outline,filter:i.filter}:{outline:null,filter:Le},r=wn[e]??{font:{tex:new fn(Zr.gfx.ggl,2048,2048,{filter:n.filter}),map:{},size:64},cursor:new p(0),maxHeight:0,outline:n.outline};wn[e]||(wn[e]=r),i=r.font;for(let a of l)if(!r.font.map[a]){let n=Zr.fontCacheC2d;if(!n)throw new Error("fontCacheC2d is not defined.");if(!Zr.fontCacheCanvas)throw new Error("fontCacheCanvas is not defined.");n.clearRect(0,0,Zr.fontCacheCanvas.width,Zr.fontCacheCanvas.height),n.font=`${i.size}px ${e}`,n.textBaseline="top",n.textAlign="left",n.fillStyle="#ffffff";let o=n.measureText(a),l=Math.ceil(o.width);if(!l)continue;let h=Math.ceil(Math.abs(o.actualBoundingBoxAscent))+Math.ceil(Math.abs(o.actualBoundingBoxDescent));r.outline&&r.outline.width&&r.outline.color&&(n.lineJoin="round",n.lineWidth=2*r.outline.width,n.strokeStyle=r.outline.color.toHex(),n.strokeText(a,r.outline.width,r.outline.width),l+=2*r.outline.width,h+=3*r.outline.width),n.fillText(a,(null==(t=r.outline)?void 0:t.width)??0,(null==(s=r.outline)?void 0:s.width)??0);let u=n.getImageData(0,0,l,h);if(r.cursor.x+l>2048&&(r.cursor.x=0,r.cursor.y+=r.maxHeight,r.maxHeight=0,r.cursor.y>2048))throw new Error("Font atlas exceeds character limit");i.tex.update(u,r.cursor.x,r.cursor.y),i.map[a]=new m(r.cursor.x,r.cursor.y,l,h),r.cursor.x+=l+1,r.maxHeight=Math.max(r.maxHeight,h)}}let h,u=e.size||i.size,d=g(e.scale??1).scale(u/i.size),c=e.lineSpacing??0,f=e.letterSpacing??0,w=0,y=0,A=0,v=[],x=[],b=0,E=null,M=0;for(;b<l.length;){let t=l[b];if("\n"===t)A+=u+c,v.push({width:w-f,chars:x}),E=null,M=0,w=0,x=[],h=void 0;else{let s=i.map[t];if(s){let n=s.w*d.x;e.width&&w+n>e.width&&(A+=u+c,null!=E&&(b-=x.length-E,t=l[b],s=i.map[t],n=s.w*d.x,x=x.slice(0,E-1),w=M),E=null,M=0,v.push({width:w-f,chars:x}),w=h??0,x=[]),x.push({tex:i.tex,width:s.w,height:s.h,quad:new m(s.x/i.tex.width,s.y/i.tex.height,s.w/i.tex.width,s.h/i.tex.height),ch:t,pos:new p(w,A),opacity:e.opacity??1,color:e.color??a.WHITE,scale:g(d),angle:0})," "===t&&(E=x.length,M=w),e.indentAll&&void 0===h&&/\S/.test(t)&&(h=w),w+=n,y=Math.max(y,w),w+=f}}b++}v.push({width:w-f,chars:x}),A+=u,e.width&&(y=e.width);let q=[];for(let a=0;a<v.length;a++){let t=(y-v[a].width)*Wt(e.align??"left");for(let s of v[a].chars){let o=i.map[s.ch],l=q.length+a;if(s.pos=s.pos.add(t,0).add(o.w*d.x*.5,o.h*d.y*.5),e.transform){let t="function"==typeof e.transform?e.transform(l,s.ch):e.transform;t&&yn(s,t)}if(r[l]){let t=r[l];for(let i of t){let t=null==(n=e.styles)?void 0:n[i],r="function"==typeof t?t(l,s.ch):t;r&&yn(s,r)}}q.push(s)}}return{width:y,height:A,chars:q,opt:e,renderedText:o}}function xn(e){if(void 0===e.width||void 0===e.height)throw new Error('drawUVQuad() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,s=e.height,n=Qt(e.anchor||Oe).scale(new p(t,s).scale(-.5)),i=e.quad||new m(0,0,1,1),r=e.color||o(255,255,255),a=e.opacity??1,l=e.tex?.1/e.tex.width:0,h=e.tex?.1/e.tex.height:0,u=i.x+l,d=i.y+h,c=i.w-2*l,f=i.h-2*h;us(),hs(e.pos),fs(e.angle),cs(e.scale),hs(n),rn([{pos:new p(-t/2,s/2),uv:new p(e.flipX?u+c:u,e.flipY?d:d+f),color:r,opacity:a},{pos:new p(-t/2,-s/2),uv:new p(e.flipX?u+c:u,e.flipY?d+f:d),color:r,opacity:a},{pos:new p(t/2,-s/2),uv:new p(e.flipX?u:u+c,e.flipY?d+f:d),color:r,opacity:a},{pos:new p(t/2,s/2),uv:new p(e.flipX?u:u+c,e.flipY?d:d+f),color:r,opacity:a}],[0,1,3,1,2,3],e.fixed,e.tex,e.shader,e.uniform??void 0),ps()}function bn(e){us(),hs(e.opt.pos),fs(e.opt.angle),hs(Qt(e.opt.anchor??"topleft").add(1,1).scale(e.width,e.height).scale(-.5)),e.chars.forEach(t=>{xn({tex:t.tex,width:t.width,height:t.height,pos:t.pos,scale:t.scale,angle:t.angle,color:t.color,opacity:t.opacity,quad:t.quad,anchor:"center",uniform:e.opt.uniform,shader:e.opt.shader,fixed:e.opt.fixed})}),ps()}function En(e){if(void 0===e.width||void 0===e.height)throw new Error('drawRect() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,s=e.height,n=Qt(e.anchor||Oe).add(1,1).scale(new p(t,s).scale(-.5)),i=[new p(0,0),new p(t,0),new p(t,s),new p(0,s)];if(e.radius){let n=Math.min(t,s)/2,r=Array.isArray(e.radius)?e.radius.map(e=>Math.min(n,e)):new Array(4).fill(Math.min(n,e.radius));i=[new p(r[0],0),...r[1]?as(new p(t-r[1],r[1]),r[1],r[1],270,360):[g(t,0)],...r[2]?as(new p(t-r[2],s-r[2]),r[2],r[2],0,90):[g(t,s)],...r[3]?as(new p(r[3],s-r[3]),r[3],r[3],90,180):[g(0,s)],...r[0]?as(new p(r[0],r[0]),r[0],r[0],180,270):[]]}an(Object.assign({},e,{offset:n,pts:i,...e.gradient?{colors:e.horizontal?[e.gradient[0],e.gradient[1],e.gradient[1],e.gradient[0]]:[e.gradient[0],e.gradient[0],e.gradient[1],e.gradient[1]]}:{}}))}function Mn(e){gs();let t=Zr.gfx.width,s=Zr.gfx.height;Zr.gfx.width=Zr.gfx.viewport.width,Zr.gfx.height=Zr.gfx.viewport.height,e(),gs(),Zr.gfx.width=t,Zr.gfx.height=s}function qn(e,t){Mn(()=>{let s=g(8);us(),hs(e);let n=vn({text:t,font:Ue,size:16,pos:s,color:o(255,255,255),fixed:!0}),i=n.width+2*s.x,r=n.height+2*s.x;e.x+i>=ms()&&hs(g(-i,0)),e.y+r>=ws()&&hs(g(0,-r)),En({width:i,height:r,color:o(0,0,0),radius:4,opacity:.8,fixed:!0}),bn(n),ps()})}function Sn(e){if(!e.p1||!e.p2||!e.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return an(Object.assign({},e,{pts:[e.p1,e.p2,e.p3]}))}function Bn(){if(Zr.debug.inspect){let e=null;for(let t of Zr.game.root.get("*",{recursive:!0}))if(t.has("area")&&t.isHovering()){e=t;break}if(Zr.game.root.drawInspect(),e){let t=[],s=e.inspect();for(let e in s)s[e]?t.push(`${s[e]}`):t.push(`${e}`);qn(function(e){return new p(e.x*Zr.gfx.viewport.width/Zr.gfx.width,e.y*Zr.gfx.viewport.height/Zr.gfx.height)}(Zr.k.mousePos()),t.join("\n"))}qn(g(8),`FPS: ${Zr.debug.fps()}`)}Zr.debug.paused&&Mn(()=>{us(),hs(ms(),0),hs(-8,8);En({width:32,height:32,anchor:"topright",color:o(0,0,0),opacity:.8,radius:4,fixed:!0});for(let e=1;e<=2;e++)En({width:4,height:19.2,anchor:"center",pos:g(-32/3*e,16),color:o(255,255,255),radius:2,fixed:!0});ps()}),1!==Zr.debug.timeScale&&Mn(()=>{us(),hs(ms(),ws()),hs(-8,-8);let e=vn({text:Zr.debug.timeScale.toFixed(1),font:Ue,size:16,color:o(255,255,255),pos:g(-8),anchor:"botright",fixed:!0});En({width:e.width+16+32,height:e.height+16,anchor:"botright",color:o(0,0,0),opacity:.8,radius:4,fixed:!0});for(let t=0;t<2;t++){let s=Zr.debug.timeScale<1;Sn({p1:g(-e.width-8*(s?2:3.5),-8),p2:g(-e.width-8*(s?2:3.5),-8-e.height),p3:g(-e.width-8*(s?3.5:2),-8-e.height/2),pos:g(8*-t*1+(s?-4:0),0),color:o(255,255,255),fixed:!0})}bn(e),ps()}),Zr.debug.curRecording&&Mn(()=>{us(),hs(0,ws()),hs(24,-24),ln({radius:12,color:o(255,0,0),opacity:x(0,1,4*Zr.app.time()),fixed:!0}),ps()}),Zr.debug.showLog&&Zr.game.logs.length>0&&Mn(()=>{us(),hs(0,ws()),hs(8,-8);let e=[];for(let s of Zr.game.logs){let t="",n=s.msg instanceof Error?"error":"info";t+=`[time]${s.time.toFixed(2)}[/time]`,t+=" ",t+=`[${n}]${Rn(s.msg)}[/${n}]`,e.push(t)}Zr.game.logs=Zr.game.logs.filter(e=>Zr.app.time()-e.time<(Zr.globalOpt.logTime||4));let t=vn({text:e.join("\n"),font:Ue,pos:g(8,-8),anchor:"botleft",size:16,width:.6*ms(),lineSpacing:4,fixed:!0,styles:{time:{color:o(127,127,127)},info:{color:o(255,255,255)},error:{color:o(255,0,127)}}});En({width:t.width+16,height:t.height+16,anchor:"botleft",color:o(0,0,0),radius:4,opacity:.8,fixed:!0}),bn(t),ps()})}function Rn(e,t=!1,s=new Set){if(s.has(e))return"<recursive>";var n,i="";return t&&"string"==typeof e&&(e=JSON.stringify(e)),Array.isArray(e)&&(i=["[",e.map(t=>Rn(t,!0,s.union(new Set([e])))).join(", "),"]"].join(""),e=i),null===e?"null":("object"==typeof e&&e.toString===Object.prototype.toString&&(e.constructor!==Object&&(i+=e.constructor.name+" "),i+=["{",(n=Object.getOwnPropertyNames(e).map(t=>`${/^\w+$/.test(t)?t:JSON.stringify(t)}: ${Rn(e[t],!0,s.union(new Set([e])))}`).join(", "))?` ${n} `:"","}"].join(""),e=i),String(e).replaceAll(new RegExp("(?<!\\\\)\\[","g"),"\\["))}function In(e,t,s){let n=Zr.gfx.ggl.gl;gs(),n.clear(n.STENCIL_BUFFER_BIT),n.enable(n.STENCIL_TEST),n.stencilFunc(n.NEVER,1,255),n.stencilOp(n.REPLACE,n.REPLACE,n.REPLACE),t(),gs(),n.stencilFunc(s,1,255),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),e(),gs(),n.disable(n.STENCIL_TEST)}function Pn(e,t){In(e,t,Zr.gfx.ggl.gl.EQUAL)}function Cn(e){var t,s;if(!e.tex)throw new Error('drawTexture() requires property "tex".');let n=e.quad??new m(0,0,1,1),i=e.tex.width*n.w,r=e.tex.height*n.h,o=new p(1);if(e.tiled){let o=Qt(e.anchor||Oe);null==(t=e.pos)||t.x,o.x,e.width,null==(s=e.pos)||s.y,o.y,e.height;let l=(e.width||i)/i,h=(e.height||r)/r,u=Math.floor(l),d=Math.floor(h),c=l-u,f=h-d,g=(u+c?1:0)*(d+f?1:0),w=new Array(6*g),y=new Array(4*g),A=0,v=(t,s,n,i,r)=>{w[6*A+0]=4*A+0,w[6*A+1]=4*A+1,w[6*A+2]=4*A+3,w[6*A+3]=4*A+1,w[6*A+4]=4*A+2,w[6*A+5]=4*A+3,y[4*A+0]={pos:new p(t-o.x,s-o.y),uv:new p(r.x,r.y),color:e.color||a.WHITE,opacity:e.opacity||1},y[4*A+1]={pos:new p(t+n-o.x,s-o.y),uv:new p(r.x+r.w,r.y),color:e.color||a.WHITE,opacity:e.opacity||1},y[4*A+2]={pos:new p(t+n-o.x,s+i-o.y),uv:new p(r.x+r.w,r.y+r.h),color:e.color||a.WHITE,opacity:e.opacity||1},y[4*A+3]={pos:new p(t-o.x,s+i-o.y),uv:new p(r.x,r.y+r.h),color:e.color||a.WHITE,opacity:e.opacity||1},A++};for(let e=0;e<d;e++){for(let t=0;t<u;t++)v(t*i,e*r,i,r,n);c&&v(u*i,e*r,i*c,r,new m(n.x,n.y,n.w*c,n.h))}if(f){for(let e=0;e<u;e++)v(e*i,d*r,i,r*f,new m(n.x,n.y,n.w,n.h*f));c&&v(u*i,d*r,i*c,r*f,new m(n.x,n.y,n.w*c,n.h*f))}rn(y,w,e.fixed,e.tex,e.shader,e.uniform??void 0)}else e.width&&e.height?(o.x=e.width/i,o.y=e.height/r):e.width?(o.x=e.width/i,o.y=o.x):e.height&&(o.y=e.height/r,o.x=o.y),xn(Object.assign({},e,{scale:o.scale(e.scale||new p(1)),tex:e.tex,quad:n,width:i,height:r}))}function kn(e){if(!e.sprite)throw new Error('drawSprite() requires property "sprite"');let t=Ts(e.sprite);if(!t||!t.data)return;let s=t.data.frames[e.frame??0];if(!s)throw new Error(`Frame not found: ${e.frame??0}`);Cn(Object.assign({},e,{tex:t.data.tex,quad:s.scale(e.quad??new m(0,0,1,1))}))}function Fn(e,t){In(e,t,Zr.gfx.ggl.gl.NOTEQUAL)}function Tn(e){bn(vn(e))}function Dn(e){return!!e.fixed||!!e.parent&&Dn(e.parent)}function On(e){return{color:e.color,opacity:e.opacity,anchor:e.anchor,outline:e.outline,shader:e.shader,uniform:e.uniform}}function Un(e,t={}){return{id:"circle",radius:e,draw(){ln(Object.assign(On(this),{radius:this.radius,fill:t.fill}))},renderArea(){return new te(new p(this.anchor?0:-this.radius),2*this.radius,2*this.radius)},inspect(){return`radius: ${Math.ceil(this.radius)}`}}}function Ln(...e){return{id:"color",color:o(...e),inspect(){return`color: ${this.color.toString()}`}}}function Nn(e){return{add(){this.canvas=e}}}function Hn(e=1){let t,s=0,n=!1;return{require:["opacity"],add(){t=this.opacity,this.opacity=0},update(){n||(s+=Dt(),this.opacity=c(s,0,e,0,t),s>=e&&(this.opacity=t,n=!0))}}}function jn(e="intersect"){return{id:"mask",mask:e}}function Gn(e){return{id:"opacity",opacity:e??1,fadeIn(e=1,t=Zr.k.easings.linear){return Zr.game.root.tween(0,this.opacity,e,e=>this.opacity=e,t)},fadeOut(e=1,t=Zr.k.easings.linear){return Zr.game.root.tween(this.opacity,0,e,e=>this.opacity=e,t)},inspect(){return`opacity: ${dt(this.opacity,1)}`}}}function Vn(e=1,t=o(0,0,0),s=1,n="miter",i=10,r="butt"){return{id:"outline",outline:{width:e,color:t,opacity:s,join:n,miterLimit:i,cap:r},inspect(){return`outline: ${this.outline.width}px, ${this.outline.color}`}}}var Kn=class{constructor(){n(this,"pos",g(0)),n(this,"vel",g(0)),n(this,"acc",g(0)),n(this,"angle",0),n(this,"angularVelocity",0),n(this,"damping",0),n(this,"t"),n(this,"lt",null),n(this,"gc"),this.t=0,this.gc=!0}get progress(){return this.lt?this.t/this.lt:this.t}};function Yn(e,t){let s=t.lifetime,n=[],i=e.colors||[a.WHITE],r=e.opacities||[1],l=e.quads||[new m(0,0,1,1)],h=e.scales||[1],u=e.lifeTime,f=t.direction,w=t.spread,y=e.speed||[0,0],A=e.angle||[0,0],v=e.angularVelocity||[0,0],x=e.acceleration||[g(0),g(0)],b=e.damping||[0,0],E=[],M=new Array(e.max),q=0,B=0;for(let a=0;a<e.max;a++){E[6*a+0]=4*a+0,E[6*a+1]=4*a+1,E[6*a+2]=4*a+3,E[6*a+3]=4*a+1,E[6*a+4]=4*a+2,E[6*a+5]=4*a+3;for(let e=0;e<4;e++)M[4*a+e]={pos:new p(0,0),uv:new p(0,0),color:o(255,255,255),opacity:1};n[a]=new Kn}let R=new Ze;function I(t=0){for(;t<e.max;){if(n[t].gc)return t;t++}return null}return{id:"particles",emit(e){let s=0;for(let i=0;i<e;i++){if(s=I(s),null==s)return;let e=S(f-w,f+w),i=p.fromAngle(e).scale(S(y[0],y[1])),r=S(A[0],A[1]),a=S(v[0],v[1]),o=g(S(x[0].x,x[1].x),S(x[0].y,x[1].y)),l=S(b[0],b[1]),h=u?S(u[0],u[1]):null,d=t.shape?t.shape.random():g(),c=n[s];c.lt=h,c.pos=d,c.vel=i,c.acc=o,c.angle=r,c.angularVelocity=a,c.damping=l,c.angularVelocity=a,c.gc=!1}q+=e},update(){if(void 0!==s&&s<=0)return;let i=Dt();for(let e of n)if(!e.gc){if(e.t+=i,e.lt&&e.t>=e.lt){e.gc=!0,q--;continue}e.vel=e.vel.add(e.acc.scale(i)).scale(1-e.damping*i),e.pos=e.pos.add(e.vel.scale(i)),e.angle+=e.angularVelocity*i}for(void 0!==s&&(s-=i,s<=0&&R.trigger()),B+=i;q<e.max&&t.rate&&B>t.rate;)this.emit(1),q++,B-=t.rate},draw(){if(!(void 0!==s&&s<=0)){for(let t=0;t<n.length;t++){let s=n[t];if(s.gc)continue;let a=s.progress,o=Math.floor(s.progress*i.length),u=o<i.length-1?d(i[o],i[o+1],c(a,o/i.length,(o+1)/i.length,0,1)):i[o],f=Math.floor(s.progress*r.length),p=f<r.length-1?d(r[f],r[f+1],c(a,f/r.length,(f+1)/r.length,0,1)):r[f],g=Math.floor(s.progress*l.length),m=l[g],w=Math.floor(s.progress*h.length),y=h[w],A=Math.cos(s.angle*Math.PI/180),v=Math.sin(s.angle*Math.PI/180),x=(e.texture?e.texture.width:10)*m.w/2,b=(e.texture?e.texture.height:10)*m.h/2,E=4*t,q=M[E];q.pos.x=s.pos.x+-x*y*A- -b*y*v,q.pos.y=s.pos.y+-x*y*v+-b*y*A,q.uv.x=m.x,q.uv.y=m.y,q.color.r=u.r,q.color.g=u.g,q.color.b=u.b,q.opacity=p,q=M[E+1],q.pos.x=s.pos.x+x*y*A- -b*y*v,q.pos.y=s.pos.y+x*y*v+-b*y*A,q.uv.x=m.x+m.w,q.uv.y=m.y,q.color.r=u.r,q.color.g=u.g,q.color.b=u.b,q.opacity=p,q=M[E+2],q.pos.x=s.pos.x+x*y*A-b*y*v,q.pos.y=s.pos.y+x*y*v+b*y*A,q.uv.x=m.x+m.w,q.uv.y=m.y+m.h,q.color.r=u.r,q.color.g=u.g,q.color.b=u.b,q.opacity=p,q=M[E+3],q.pos.x=s.pos.x+-x*y*A-b*y*v,q.pos.y=s.pos.y+-x*y*v+b*y*A,q.uv.x=m.x,q.uv.y=m.y+m.h,q.color.r=u.r,q.color.g=u.g,q.color.b=u.b,q.opacity=p}rn(M,E,this.fixed,e.texture,this.shader,this.uniform)}},onEnd:e=>R.add(e),inspect:()=>`count: ${q}/${e.max}`}}function Xn(e,t={}){if(e.length<3)throw new Error(`Polygon's need more than two points, ${e.length} points provided`);return{id:"polygon",pts:e,colors:t.colors,uv:t.uv,tex:t.tex,radius:t.radius,draw(){an(Object.assign(On(this),{pts:this.pts,colors:this.colors,uv:this.uv,tex:this.tex,radius:this.radius,fill:t.fill,triangulate:t.triangulate}))},renderArea(){return new ie(this.pts)},inspect(){return`polygon: ${this.pts.map(e=>`[${e.x},${e.y}]`).join(",")}`}}}function Qn(e,t,s){let n;return Zr.game.root.get("area").forEach(i=>{if(s&&s.some(e=>i.is(e)))return;let r=i.worldArea().raycast(e,t);r&&(n?r.fraction<n.fraction&&(n=r,n.object=i):(n=r,n.object=i))}),n}function Wn(e,t,s={}){return{id:"rect",width:e,height:t,radius:s.radius||0,draw(){En(Object.assign(On(this),{width:this.width,height:this.height,radius:this.radius,fill:s.fill}))},renderArea(){return new te(g(0),this.width,this.height)},inspect(){return`rect: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)}h)`}}}function zn(e,t){return{id:"shader",shader:e,..."function"==typeof t?{uniform:t(),update(){this.uniform=t()}}:{uniform:t},inspect:()=>`shader: ${e}`}}function Zn(e,t){if(!t.tileWidth||!t.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let s=Zr.game.root.add([Xr(t.pos??g(0))]),n=e.length,i=0,r=null,a=null,o=null,l=null,h=e=>e.x+e.y*i,u=e=>g(Math.floor(e%i),Math.floor(e/i)),d=()=>{r=[];for(let e of s.children)c(e)},c=e=>{let t=h(e.tilePos);r[t]?r[t].push(e):r[t]=[e]},f=e=>{let t=h(e.tilePos);if(r[t]){let s=r[t].indexOf(e);s>=0&&r[t].splice(s,1)}},p=(e,t)=>a[t],m=(e,t)=>{let s=u(e),n=u(t);return s.dist(n)},w=(e,t)=>{let s=[],r=Math.floor(e%i),l=r>0&&1&o[e]&&a[e-1]!==1/0,h=e>=i&&2&o[e]&&a[e-i]!==1/0,u=r<i-1&&4&o[e]&&a[e+1]!==1/0,d=e<i*n-i-1&&8&o[e]&&a[e+i]!==1/0;return t?(l&&(h&&s.push(e-i-1),s.push(e-1),d&&s.push(e+i-1)),h&&s.push(e-i),u&&(h&&s.push(e-i+1),s.push(e+1),d&&s.push(e+i+1)),d&&s.push(e+i)):(l&&s.push(e-1),h&&s.push(e-i),u&&s.push(e+1),d&&s.push(e+i)),s},y={id:"level",tileWidth:()=>t.tileWidth,tileHeight:()=>t.tileHeight,spawn(e,...n){let i=g(...n),a=(()=>{if("string"!=typeof e){if(Array.isArray(e))return e;throw new Error("Expected a symbol or a component list")}if(t.tiles[e]){if("function"!=typeof t.tiles[e])throw new Error("Level symbol def must be a function returning a component list");return t.tiles[e](i)}if(t.wildcardTile)return t.wildcardTile(e,i)})();if(!a)return null;let o=!1,l=!1;for(let t of a)"tile"===t.id&&(l=!0),"pos"===t.id&&(o=!0);o||a.push(Xr(this.tile2Pos(i))),l||a.push(pr());let h=s.add(a);return o&&(h.tilePosOffset=h.pos.clone()),h.tilePos=i,h.transform=is(h),r&&(c(h),this.trigger("spatialMapChanged"),this.trigger("navigationMapInvalid")),h},numColumns:()=>i,numRows:()=>n,levelWidth(){return i*this.tileWidth()},levelHeight(){return n*this.tileHeight()},tile2Pos(...e){return g(...e).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...e){let t=g(...e);return g(Math.floor(t.x/this.tileWidth()),Math.floor(t.y/this.tileHeight()))},getSpatialMap:()=>(r||d(),r),removeFromSpatialMap:f,insertIntoSpatialMap:c,onSpatialMapChanged(e){return this.on("spatialMapChanged",e)},onNavigationMapInvalid(e){return this.on("navigationMapInvalid",e)},getAt(e){r||d();let t=h(e);return r[t]||[]},raycast(e,t){let s=this.toWorld(e),n=this.toWorld(e.add(t)).sub(s),i=1/this.tileWidth(),r=function(e,t,s,n=64){let i=e,r=t.len(),a=t.scale(1/r),o=0,l=g(Math.floor(e.x),Math.floor(e.y)),h=g(a.x>0?1:-1,a.y>0?1:-1),u=g(Math.abs(1/a.x),Math.abs(1/a.y)),d=g(h.x>0?l.x+1-e.x:e.x-l.x,h.y>0?l.y+1-e.y:e.y-l.y),c=g(u.x<1/0?u.x*d.x:1/0,u.y<1/0?u.y*d.y:1/0),f=-1;for(;o<=n;){let e=s(l);if(!0===e)return{point:i.add(a.scale(o)),normal:g(0===f?-h.x:0,1===f?-h.y:0),fraction:o/r,gridPos:l};if(e)return e;c.x<c.y?(l.x+=h.x,o=c.x,c.x+=u.x,f=0):(l.y+=h.y,o=c.y,c.y+=u.y,f=1)}return null}(e.scale(i),t,e=>{let t=this.getAt(e);if(t.some(e=>e.isObstacle))return!0;let r=null;for(let i of t)if(i.has("area")){let e=i.worldArea().raycast(s,n);e&&(r?e.fraction<r.fraction&&(r=e,r.object=i):(r=e,r.object=i))}return r&&(r.point=this.fromWorld(r.point).scale(i)),r||!1},64);return r&&(r.point=r.point.scale(this.tileWidth())),r},update(){r&&(()=>{let e=!1;for(let t of s.children){let n=s.pos2Tile(t.pos);(t.tilePos.x!=n.x||t.tilePos.y!=n.y)&&(e=!0,f(t),t.tilePos.x=n.x,t.tilePos.y=n.y,c(t))}e&&s.trigger("spatialMapChanged")})()},invalidateNavigationMap(){a=null,o=null,l=null},onNavigationMapChanged(e){return this.on("navigationMapChanged",e)},getTilePath(e,t,r={}){var d;if(a||(()=>{let e=s.getSpatialMap(),t=s.numRows()*s.numColumns();a?a.length=t:a=new Array(t),a.fill(1,0,t);for(let s=0;s<e.length;s++){let t=e[s];if(t){let e=0;for(let s of t){if(s.isObstacle){e=1/0;break}e+=s.cost}a[s]=e||1}}})(),o||(()=>{let e=s.getSpatialMap(),t=s.numRows()*s.numColumns();o?o.length=t:o=new Array(t),o.fill(15,0,t);for(let s=0;s<e.length;s++){let t=e[s];if(t){let e=t.length,n=15;for(let s=0;s<e;s++)n|=t[s].edgeMask;o[s]=n}}})(),l||(()=>{let e=s.numRows()*s.numColumns(),t=(e,t)=>{let s=[];for(s.push(e);s.length>0;){let e=s.pop();w(e).forEach(e=>{l[e]<0&&(l[e]=t,s.push(e))})}};l?l.length=e:l=new Array(e),l.fill(-1,0,e);let n=0;for(let s=0;s<a.length;s++)l[s]>=0||t(s,n),n++})(),e.x<0||e.x>=i||e.y<0||e.y>=n||t.x<0||t.x>=i||t.y<0||t.y>=n)return null;let c=h(e),f=h(t);if(a[f]===1/0)return null;if(c===f)return[];if(-1!=l[c]&&l[c]!==l[f])return null;let g=new tt((e,t)=>e.cost<t.cost);g.insert({cost:0,node:c});let y=new Map;y.set(c,c);let A=new Map;for(A.set(c,0);0!==g.length;){let e=null==(d=g.remove())?void 0:d.node;if(e===f)break;let t=w(e,r.allowDiagonals);for(let s of t){let t=(A.get(e)||0)+p(0,s)+m(s,f);(!A.has(s)||t<A.get(s))&&(A.set(s,t),g.insert({cost:t,node:s}),y.set(s,e))}}let v=[],x=f,b=u(x);for(v.push(b);x!==c;){let e=y.get(x);if(void 0===e)throw new Error("Bug in pathfinding algorithm");x=e;let t=u(x);v.push(t)}return v.reverse()},getPath(e,t,s={}){let n=this.tileWidth(),i=this.tileHeight(),r=this.getTilePath(this.pos2Tile(e),this.pos2Tile(t),s);return r?[e,...r.slice(1,-1).map(e=>e.scale(n,i).add(n/2,i/2)),t]:null}};return s.use(y),s.onNavigationMapInvalid(()=>{s.invalidateNavigationMap(),s.trigger("navigationMapChanged")}),e.forEach((e,t)=>{let n=e.split("");i=Math.max(n.length,i),n.forEach((e,n)=>{s.spawn(e,g(n,t))})}),s}function Jn(e,t,s){return Zr.game.objEvents.registers[e]||(Zr.game.objEvents.registers[e]=new We),Zr.game.objEvents.on(e,(e,...n)=>{e.is(t)&&s(e,...n)})}var _n=(e,t,...s)=>{for(let n of Zr.game.root.children)n.is(t)&&n.trigger(e,s)},$n=ct(e=>{let t=Zr.game.root.add([{fixedUpdate:e}]);return{get paused(){return t.paused},set paused(e){t.paused=e},cancel:()=>t.destroy()}},(e,t)=>Jn("fixedUpdate",e,t)),ei=ct(e=>{let t=Zr.game.root.add([{update:e}]);return{get paused(){return t.paused},set paused(e){t.paused=e},cancel:()=>t.destroy()}},(e,t)=>Jn("update",e,t)),ti=ct(e=>{let t=Zr.game.root.add([{draw:e}]);return{get paused(){return t.hidden},set paused(e){t.hidden=e},cancel:()=>t.destroy()}},(e,t)=>Jn("draw",e,t)),si=ct(e=>Zr.game.events.on("add",e),(e,t)=>Jn("add",e,t)),ni=ct(e=>Zr.game.events.on("destroy",e),(e,t)=>Jn("destroy",e,t)),ii=ct(e=>Zr.game.events.on("use",e),(e,t)=>Jn("use",e,t)),ri=ct(e=>Zr.game.events.on("unuse",e),(e,t)=>Jn("unuse",e,t)),ai=ct(e=>Zr.game.events.on("tag",e),(e,t)=>Jn("tag",e,t)),oi=ct(e=>Zr.game.events.on("untag",e),(e,t)=>Jn("untag",e,t));function li(e,t,s){return Jn("collide",e,(e,n,i)=>n.is(t)&&s(e,n,i))}function hi(e,t,s){return Jn("collideUpdate",e,(e,n,i)=>n.is(t)&&s(e,n,i))}function ui(e,t,s){return Jn("collideEnd",e,(e,n,i)=>n.is(t)&&s(e,n,i))}function di(e,t){Zr.game.root.get(e,{recursive:!0}).forEach(t),si(e,t),ai((s,n)=>{n===e&&t(s)})}var ci=ct(e=>Zr.app.onMousePress(e),(e,t)=>{let s=[];return di(e,e=>{if(!e.area)throw new Error("onClick() requires the object to have area() component");s.push(e.onClick(()=>t(e)))}),ze.join(s)});function fi(e,t){let s=[];return di(e,e=>{if(!e.area)throw new Error("onHover() requires the object to have area() component");s.push(e.onHover(()=>t(e)))}),ze.join(s)}function pi(e,t){let s=[];return di(e,e=>{if(!e.area)throw new Error("onHoverUpdate() requires the object to have area() component");s.push(e.onHoverUpdate(()=>t(e)))}),ze.join(s)}function gi(e,t){let s=[];return di(e,e=>{if(!e.area)throw new Error("onHoverEnd() requires the object to have area() component");s.push(e.onHoverEnd(()=>t(e)))}),ze.join(s)}function mi(e){Zr.game.events.on("loading",e)}function wi(e){Zr.app.onResize(e)}function yi(e){Zr.game.events.on("error",e)}function Ai(e){Zr.assets.loaded?e():Zr.game.events.on("load",e)}function vi(e){if(!Zr.assets.loaded)return Zr.game.events.on("loadError",e);Ps().forEach(t=>e(...t))}function xi(...e){Zr.game.cam.pos=g(...e)}function bi(){return Zr.game.cam.pos?Zr.game.cam.pos.clone():As()}function Ei(...e){Zr.game.cam.scale=g(...e)}function Mi(){return Zr.game.cam.scale.clone()}function qi(e){Zr.game.cam.angle=e}function Si(){return Zr.game.cam.angle}function Bi(){return Zr.game.cam.transform.clone()}function Ri(e=o(255,255,255),t=1){let s=Zr.game.root.add([Wn(ms(),ws()),Ln(e),Gn(1),{id:"fixed",fixed:!0}]),n=s.fadeOut(t);return n.onEnd(()=>tr(s)),n}function Ii(){return Zr.game.cam.transform.clone()}function Pi(e=12){Zr.game.cam.shake+=e}function Ci(e){return Zr.game.cam.transform.multVec2(e)}function ki(e){return Zr.game.cam.transform.invert().multVec2(e)}function Fi(...e){return ut("camPos","setCamPos / getCamPos"),e.length>0&&xi(...e),bi()}function Ti(...e){return ut("camScale","setCamScale / getCamScale"),e.length>0&&Ei(...e),Mi()}function Di(e){return ut("camRot","setCamRot / getCamRot"),void 0!==e&&qi(e),Si()}function Oi(e=o(255,255,255),t=1){return ut("camFlash","flash"),Ri(e,t)}function Ui(e=[]){let t=new Map,s=[],n={},i=new Je,r=[],a=new Set("*"),o=Zr.globalOpt.tagsAsComponents,l=null,h=!1,u={id:qt(),hidden:!1,transform:new v,children:[],parent:null,set paused(e){if(e!==h){h=e;for(let t of r)t.paused=e}},get paused(){return h},get tags(){return Array.from(a)},add(e){let t=Array.isArray(e)?Ui(e):e;if(t.parent)throw new Error("Cannot add a game obj that already has a parent.");return t.parent=this,t.transform=is(t),this.children.push(t),t.trigger("add",t),Zr.game.events.trigger("add",t),t},readd(e){let t=this.children.indexOf(e);return-1!==t&&(this.children.splice(t,1),this.children.push(e)),e},remove(e){let t=this.children.indexOf(e);if(-1!==t){e.parent=null,this.children.splice(t,1);let s=e=>{e.trigger("destroy"),Zr.game.events.trigger("destroy",e),e.children.forEach(e=>s(e))};s(e)}},removeAll(e){if(e)this.get(e).forEach(e=>this.remove(e));else for(let t of[...this.children])this.remove(t)},fixedUpdate(){this.paused||(this.children.forEach(e=>e.fixedUpdate()),this.trigger("fixedUpdate"))},update(){this.paused||(this.children.forEach(e=>e.update()),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&(gs(),this.canvas.bind());let e=Zr.gfx.fixed;this.fixed&&(Zr.gfx.fixed=!0),us(),hs(this.pos),cs(this.scale),fs(this.angle);let t=this.children.sort((e,t)=>(e.layerIndex??Zr.game.defaultLayerIndex)-(t.layerIndex??Zr.game.defaultLayerIndex)||(e.z??0)-(t.z??0));if(this.mask){let e={intersect:Zr.k.drawMasked,subtract:Zr.k.drawSubtracted}[this.mask];if(!e)throw new Error(`Invalid mask func: "${this.mask}"`);e(()=>{t.forEach(e=>e.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),t.forEach(e=>e.draw());ps(),Zr.gfx.fixed=e,this.canvas&&(gs(),this.canvas.unbind())},drawInspect(){this.hidden||(us(),hs(this.pos),cs(this.scale),fs(this.angle),this.children.forEach(e=>e.drawInspect()),this.trigger("drawInspect"),ps())},use(e){var i;if("string"==typeof e)return a.add(e);if(!e||"object"!=typeof e)throw new Error(`You can only pass a component or a string to .use(), you passed a "${typeof e}"`);let r=[];e.id?(this.unuse(e.id),n[e.id]=[],r=n[e.id],t.set(e.id,e),o&&a.add(e.id)):s.push(e);for(let s in e){if(Ye.has(s))continue;let n=Object.getOwnPropertyDescriptor(e,s);if(n)if("function"==typeof n.value&&(e[s]=e[s].bind(this)),n.set&&Object.defineProperty(e,s,{set:n.set.bind(this)}),n.get&&Object.defineProperty(e,s,{get:n.get.bind(this)}),Xe.has(s)){let t="add"===s?()=>{var t;l=e=>r.push(e),null==(t=e[s])||t.call(e),l=null}:e[s];r.push(this.on(s,t).cancel)}else{if(void 0!==this[s]){let n=null==(i=t.values().find(e=>void 0!==e[s]))?void 0:i.id;throw new Error(`Duplicate component property: "${s}" while adding component "${e.id}"`+(n?` (originally added by "${n}")`:""))}Object.defineProperty(this,s,{get:()=>e[s],set:t=>e[s]=t,configurable:!0,enumerable:!0}),r.push(()=>delete this[s])}}let h=()=>{if(e.require)for(let t of e.require)if(!this.c(t))throw new Error(`Component "${e.id}" requires component "${t}"`)};e.destroy&&r.push(e.destroy.bind(this)),this.exists()?(h(),e.add&&(l=e=>r.push(e),e.add.call(this),l=null),e.id&&(this.trigger("use",e.id),Zr.game.events.trigger("use",this,e.id))):e.require&&r.push(this.on("add",h).cancel)},unuse(e){if(t.has(e)){for(let s of t.values())if(s.require&&s.require.includes(e))throw new Error(`Can't unuse. Component "${s.id}" requires component "${e}"`);t.delete(e),this.trigger("unuse",e),Zr.game.events.trigger("unuse",this,e)}else o&&a.has(e)&&a.delete(e);n[e]&&(n[e].forEach(e=>e()),delete n[e])},c:e=>t.get(e)??null,get(e,t={}){let s=(e,s)=>"comps"===t.only?e.has(s):"tags"===t.only?e.is(s):e.is(s)||e.has(s),n=t.recursive?this.children.flatMap(function e(t){return[t,...t.children.flatMap(e)]}):this.children;if(n=n.filter(t=>!e||s(t,e)),t.liveUpdate){let i=e=>t.recursive?this.isAncestorOf(e):e.parent===this,r=[];r.push(Zr.k.onAdd(t=>{i(t)&&s(t,e)&&n.push(t)})),r.push(Zr.k.onDestroy(t=>{if(i(t)&&s(t,e)){let e=n.findIndex(e=>e.id===t.id);-1!==e&&n.splice(e,1)}})),this.onDestroy(()=>{for(let e of r)e.cancel()})}return n},query(e){let t=e.hierarchy||"children",s=e.include,n=e.exclude,i=[];switch(t){case"children":i=this.children;break;case"siblings":i=this.parent?this.parent.children.filter(e=>e!==this):[];break;case"ancestors":let e=this.parent;for(;e;)i.push(e),e=e.parent;break;case"descendants":i=this.children.flatMap(function e(t){return[t,...t.children.flatMap(e)]})}if(s&&(i="and"!==(e.includeOp||"and")&&Array.isArray(e.include)?i.filter(t=>e.include.some(e=>t.is(e))):i.filter(e=>e.is(s))),n&&(i="and"!==(e.includeOp||"and")&&Array.isArray(e.include)?i.filter(t=>!e.exclude.some(e=>t.is(e))):i.filter(e=>!e.is(n))),!0===e.visible&&(i=i.filter(e=>e.visible)),e.distance){if(!this.pos)throw Error("Can't do a distance query from an object without pos");let t=e.distanceOp||"near",s=e.distance*e.distance;i="near"===t?i.filter(e=>e.pos&&this.pos.sdist(e.pos)<=s):i.filter(e=>e.pos&&this.pos.sdist(e.pos)>s)}return e.name&&(i=i.filter(t=>t.name===e.name)),i},isAncestorOf(e){return!!e.parent&&(e.parent===this||this.isAncestorOf(e.parent))},exists(){return Zr.game.root.isAncestorOf(this)},is:(e,t="and")=>Array.isArray(e)?"and"===t?e.every(e=>a.has(e)):e.some(e=>a.has(e)):a.has(e),tag(e){if(Array.isArray(e))for(let t of e)a.add(t),this.trigger("tag",t),Zr.game.events.trigger("tag",this,t);else a.add(e),this.trigger("tag",e),Zr.game.events.trigger("tag",this,e)},untag(e){if(Array.isArray(e))for(let t of e)a.delete(t),this.trigger("untag",t),Zr.game.events.trigger("untag",this,t);else a.delete(e),this.trigger("untag",e),Zr.game.events.trigger("untag",this,e)},has:(e,s="and")=>Array.isArray(e)?"and"===s?e.every(e=>t.has(e)):e.some(e=>t.has(e)):t.has(e),on(e,t){let s=i.on(e,t.bind(this));return l&&l(()=>s.cancel()),s},trigger(e,...t){i.trigger(e,...t),Zr.game.objEvents.trigger(e,this,...t)},destroy(){this.parent&&this.parent.remove(this)},inspect(){var e;let n={};for(let[s,i]of t)n[s]=(null==(e=i.inspect)?void 0:e.call(i))??null;for(let[t,i]of s.entries())if(i.inspect)n[t]=i.inspect();else for(let[e,s]of Object.entries(i))"function"!=typeof s&&(n[e]=`${e}: ${s}`);return n},onAdd(e){return this.on("add",e)},onFixedUpdate(e){return this.on("fixedUpdate",e)},onUpdate(e){return this.on("update",e)},onDraw(e){return this.on("draw",e)},onDestroy(e){return this.on("destroy",e)},onUse(e){return this.on("use",e)},onUnuse(e){return this.on("unuse",e)},clearEvents(){i.clear()}},d=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick","onButtonPress","onButtonDown","onButtonRelease"];for(let c of d)u[c]=(...e)=>{var t,s;let n=null==(s=(t=Zr.app)[c])?void 0:s.call(t,...e);return r.push(n),u.onDestroy(()=>n.cancel()),u.on("sceneEnter",()=>{var t,s;r.splice(r.indexOf(n),1);let i=null==(s=(t=Zr.app)[c])?void 0:s.call(t,...e);ze.replace(n,i),r.push(n)}),n};for(let c of e)u.use(c);return u}function Li(e){Zr.game.gravity=e?(Zr.game.gravity||g(0,1)).unit().scale(e):null}function Ni(){return Zr.game.gravity?Zr.game.gravity.len():0}function Hi(e){Zr.game.gravity=e.unit().scale(Zr.game.gravity?Zr.game.gravity.len():1)}function ji(){return Zr.game.gravity?Zr.game.gravity.unit():g(0,1)}var Gi=i("//uUBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAATAAAeAAANDQ0NDRoaGhoaKCgoKCg1NTU1NTVDQ0NDQ1BQUFBQXl5eXl5ra2tra2t5eXl5eYaGhoaGlJSUlJShoaGhoaGvr6+vr7y8vLy8ysrKysrX19fX19fl5eXl5fLy8vLy//////8AAAA5TEFNRTMuMTAwAaoAAAAAAAAAABSAJAOPhgAAgAAAHgBaqIlmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uUBAAP8h1kPIABR4BEDGeQAEbkSb2RAACBFMEyMiAAASJw4xjgwAGyRvfIoZT2QKGV5YNw/tKID9+X93qXtBQUFBQ/e+EFKTQUT/dy3f5dK/3d04rkXHpufCClDAaH7jDMgFAQEGfPt+jI352U9vU4GLRpzkUDeeeTQggQe2ggF3d7/3j697DnhCH5iGf38//iNj9oy2Jk71oj+CBAABGNB4RJNMwgCABCB//8//l////1z6XEGd73az07sOkwZD9VYgjzjmQ6j4EMfZM86OJ7GUWwvFw3ZPcdVEtczf9RNf6xMyxLjZZgjMQ7KDkLSU8g2E12UDUWrf//////9LdtFdeeqKwSitW9SJL59VM5pyUGiBNiK0jIGO0j7p3pUpWpaeqi1nTvqP3b43mGmM6HeXFjIlRwiFiIDQRRAGgkDQhxMMv//+f1//6XM/PfMvysJa3993MjDjhaRkrV3cRPXjGptDDGTHtFKUeMHU0K5STvVfMtVX/UXHctt1Z1//uUBB0AgnZkQAAgRTBMzIgAACiqCdB9E1QRgAFuIuGmhjABPZRJRCHi4etY2gcEYRwFw5KFBMMRV/////z6kX2ppnJszEzKbkZKEumm+pBRUDBg9IsgXGXrazn1QhmGjBrLVjT5Xvir0HT7d//HSZh18IZdji2N5JZgbA3DwQAahogSDqUhQuNtpJmBTwAGMY2QP3c/dy4EKsAABoXEJEFmlf/c4TgYtwcAbwfD4gOOoS1QIH7jDnNzYVe1x4mNFyD2jMVaaykjV29ePMARwXcUOgAFr+UjhVz4jhwMDFxPKgYs3cDFpohVgAAYAIO7u8eAAjRNA7hBFAwN3ACDvu7nETkLMrnyIj8v/9fNwhF9vKRfm82P5zPPmLV/WKs9G3d16n/v3rubEN0zgs7RdWrHne9brdv5bI4EwEAM6lj7aVdTKtXQHgLdzCKQ2kcihe4FyMcD1r3nR4TWxuax5EOZJEs3DEQnjyqyB8cSfrI6GEcoJxiHBDEfrTOFYrO1//uUBCgAA406ym5hgAB1R1ktzDwACxDBZzj0gAFhGrA3HoACypAXH9HY4umZan4ZlZKldajczMzMzOTnzMvnb77f/1IuSzHIbnJLJdapWmwUAQBXqWPtqV1OyqVqXhB9abR90OyKEsM51pIJK/nXplbDPtKz2dH+oVWeZSm8z7nvAZ19bneqhk3qeBhrhZiLbCc8sRnXb520RnPFd61/AgSR4f8CVlfWpD/////+N6/jv8v4f/6Ln///06c8YYcQIaGmAJ9VhMHEZYc9Kn0TOOYKv2cibDoZieAaGy4Cd6AfGkxQQr+agomAw+dC7AkjOxklIZEpUgmHxXP7/znl/4qT9Z/8+T2a0WF9/lvpv39if/KZnV6Gp1vQRmN1rYDAADfLGQxVR2d49LQLXdImm5n40smwjQ4aIYKMeKCOEw0OBV5cHA8cFV8mB5LyIIeksHspy79/iTv9SH+v66f2Wn/i+Lt//x9y//5MohgAAXiTCVBil4RUZ7XUvPRCD9Uc//uUBAoAAro3Wzc9AABXRutm56AACrUhc6eYT0FWpC508wnoO35hs9j6x7PQOB0PF0JWIkYwigNPoXUBA0cKA6JwDB7lRKDm/93r/mb6iEqL5lv3Vq//6YgYd1AgECi4xACCYbHyukYAAF4kwlQYpeEVGe11Lz0Qg/VHDt+YbPY+sez0DgdDxdCViJGMIoDT6F1AQNHCgOicAwe5USg5v/d6/5m+ohKi+Zb91av/+mIGHdQIBAouMQAgmGx8rptmoLKSACTuBBUPFsH6RlCz+UhoKeVfJy/eqOspBG4PScFOnOxYJJcf/nVzmyfR42Zwxy//hfSUrPq1SzFnO7q/SzNUzst+GQpnZ/kLwzVZ9xJ2lVa02zUFlJABJ3AgqHi2D9IyhZ/KQ0FPKvk5fvVHWUgjcHpOCnTnYsEkuP/zq5zZPo8bM4Y5f/wvpKVn1apZiznd1fpZmqZ2W/DIUzs/yF4Zqs+4k7SqtaYkWgEGMgppYQlMVdKcos2bWFZbFIJp//uUBAsAAr0wWe1hAABXpgs9rCAACwS5azj0gAFgly1nHpAAVgWmZa3LaUWCcGh5HgOEYkViyQUjrX+G5FUr5Dla1ZhtXDf7ckpazXwzeusqq+zXwUePSw8NYzlZKWfbyzod4dCRItAIMZBTSwhKYq6U5RZs2sKy2KQTSrAtMy1uW0osE4NDyPAcIxIrFkgpHWv8NyKpXyHK1qzDauG/25JS1mvhm9dZVV9mvgo8elh4axnKyUs+3lnQ7w6EkIEIIZFKlBSAGwRMrEIEuM658s5gvyVtFDrQtgTY2YSPlAJcgwlXLmokM8sUQJYJOm3eaW04jWVsoghX+ZBt3SHFZOypVez//VONpL+du6U+4WLXBC79cuhAhBDIpUoKQA2CJlYhAlxnXPlnMF+StoodaFsCbGzCR8oBLkGEq5c1EhnliiBLBJ027zS2nEaytlEEK/zINu6Q4rJ2VKr2f/6pxtJfzt3Sn3Cxa4IXfrl6IGEh4icUSUDRZk/k88VFEmCy//uUBAkAAociWgZh4ABQ5EtAzDwAC6zBXBmXgAF1mCuDMvAART7WmhWQ9QwYJexoKJ+z1bcQqfEFmtDtXH8lUg2omFi2b/4+UhW/j+bHgwAM8SqMAQFxYj9wqAwhlftf//sSQMJDxE4okoGizJ/J54qKJMFkin2tNCsh6hgwS9jQUT9nq24hU+ILNaHauP5KpBtRMLFs3/x8pCt/H82PBgAZ4lUYAgLixH7hUBhDK/a///YmHznKbibgJd0lEi0TfuHXCfhZ0faHA6GL3GuUpLTgTwnd/upcFAbo+BGMfzKxWE9PNg+sbrEwwRLn6uFElWTc/zN8Yvf5V3xV29///8OO/f7j3cT0mgMTPP9uPEwIQ+c5TcTcBLukokWib9w64T8LOj7Q4HQxe41ylJacCeE7v91LgoDdHwIxj+ZWKwnp5sH1jdYmGCJc/Vwokqybn+ZvjF7/Ku+Ku3v///hx37/ce7iek0BiZ5/tx4mBCmI5QXQAgigG+j0P8fdg2Xjs//uUBAiAAqwlWwY94ABVhKtgx7wACoilZ7z0AAFUlOz3noAAii2PkO1AMBYBIssJqQ5PtEdSQ2WE3xIF22b19axY89F5QQmWCwxJrf51h5mt74jRvBahCxQkS0MgJxY15ITjX3sb+vlGI5QXQAgigG+j0P8fdg2Xjsii2PkO1AMBYBIssJqQ5PtEdSQ2WE3xIF22b19axY89F5QQmWCwxJrf51h5mt74jRvBahCxQkS0MgJxY15ITjX3sb+vlEBsAgCSkHfwmFY/MMKQyg4tjhHeuR2mpSZWstSwEQAw00wZaogwgZL3PPVWw9vuB51zUXf3Df/ytV917DjxQEGA+0mbu4YYg4TnkRcMGQsxH/Ioc1AbAIAkpB38JhWPzDCkMoOLY4R3rkdpqUmVrLUsBEAMNNMGWqIMIGS9zz1VsPb7gedc1F39w3/8rVfdew48UQIFwus29HKDIAW8tcsSGAOKXK/jHmF1AkIAAC8ZUaEFwTHUylbannoarv7HwxH8//uUBAwEAtAx18sMQuBVJisaYSJeCmhnX6eZLQFZJy208wmidE7zXIRk0ZLYCqc1eg1sKc3HZuweFNeSCHHGg+JyhTcd8RE3/+rJXIdH6UpI2qUdVtHGRCOewEOXGUfKG2/v+RIoA0MAAAByh2gABL0EpLTwNTz0qzjM2ER8SF2lsSRLESGiqG5JXMCauo+aTB1GQKTyJd6SDnG6Iv8rkaoYeRihQbVGzJSSQ4sOghQh7vhkf+T0agMeCYAcAABBO40gsg/gOpfIiHoQgldEIGLVK9EaTFmFH9jkkvLA41VT/4q0XDJLUopJkJmWHAqZyRAPJOvBUS+NYSLC4FFjoJkUfGP/La3XNJCMJPep5CkIaRQCSTuM4ikUepPHAnZLEErtHuqs1EWDizBAvsdVeWBxqqn9aiS9FK24Z0KUhvVkY7ZbylKV/SrKiK0yrKqFkPe3/sZ//8xt6t2dajIDpFMRf6tSU9FIlJJKChTJIgq2hhZlrTlNcpaB/Xv5rDOU//uUBA2AAoQl1lVgwARQxLrKrBgAjCyVTrmngAGFkqnXNPAAg4ANdH9PKxIijn/xmvyjW2ZISnLe5yUtyv2ufSTfVJUGyoFiU6s6Crgyd2PEyn5Ul/85kUElPRSJSSSgoUySIKtoYWZa05TXKWgf17+awzlIOADXR/TxLEiKOf/GZ/KNbZkhKct7nJS3K/a59JN9UlQbKgWJTqzoKuDJ3Y8TKflSX/zmRQSCs10kCQCFAcBJCZCbl2c0bF5RBELfoQBmp3G2m3m3lgZoN0/BmhutukeGPbe/GtGj9jtiXNZdfDjIwYiYvnePS27ebO75y/Edksl4SONB/PlBrg6dNh8h+pW2//lktFhYcFZrpIEgEKA4CSEyE3Ls5o2LyiCIW/QgDNTuNtNvNvLAzQbp+DNDdbdI8Me29+NaNH7HbEuay6+HGRgxExfO8elt282d3zl+I7JZLwkcaD+fKDXB06bD5D9Stt//LJaLCw4AhAEAACKEywIJz0PRwTBn6tS2//uUBAmAAmUjVNdhAABMpGqa7CAACWiNUay8pYEtEao1l5SwsvqET9LUv/TIpAROYdsSHIoHxzccjRUPRZmVQnHLH7FYdB9rF8Q11yOCAKeHZHyIhMO///lWz0JPcAQgCAABFCZYEE56Ho4Jgz9WpbWX1CJ+lqX/pkUgInMO2JDkUD45uORoqHoszKoTjlj9isOg+1i+Ia65HBAFPDsj5EQmHf//yrZ6EnuACgcjEAKT2Dfl0wUuCCDwOHgDLjMYs6OLViO840e/fHfBZmadNu+NYYNVT84fPkYRCJ/K5V3vsq0Gh0H0YgBP+moubbodw+IHr/kgAoHIxACk9g35dMFLggg8Dh4Ay4zGLOji1YjvONHv3x3wWZmnTbvjWGDVU/OHz5GEQifyuVd77KtBodB9GIAT/pqLm26HcPiB6/5KAE6OeESRRgDMViF4jCI2bT5fbThs6iKGQfPTVaYtXdjMROEbiIqKlZk1KJAzpcWEnNs6FapfKXq1jerLEhaS//uUBB+BAmUqVWsMKrhMpUqtYYVXCTSlTzWSgAE0lKp2sFAAqcgRPyRHxKsBPAQVtIgCdHPCJIowBmKxC8RhEbNp8vtpw2dRFDIPnpqtMWruxmInCNxEVFSsyalEgZ0uLCTm2dCtUvlL1axvVliQtJVOQIn5Ij4lWAngIK2kQCHQhVnhkMD1BlLGveBt13z8bjbsI+MtfqdjdaAQiJFeBGV0AQFB2Qr8QDBc8iiATM25R8+fqp/Izn9CHGC7CEg5BTqd6jM4IBoADCiIYSTWAeAwKIoGBRr+EfZ3bjcbhhdDLX6nY3WgEIiRXgRloICoOyFfiA4+RRAJmbco+fP1U/kZz+hDjBdhCQcgp1O9QZnAQAbiCQAm485bonLdZ5NLqAAAEaPfiGAJsDpfUrAhC8wIZFkkEsiX6UBGvscp3FQfN5VNjWCnQ6AGqvk/UqZBbG3rpCt0gR7qtiNBxOfSeTupa6fMjXaMuYTclIn9ZIVayP2pYMiVUajtVYufukCu//uUBDWABAw9Uu5p4AKDx9qdzLwAiiyjShmngAFFlGlDNPAAm9bW7Vct6q61jNa/e6f/0cL33T31CoACacjUkabckdbjkoAAQ2Pe5fJoCshU+EXmCMRGkCbpN6UCNfKFHfcVB8kSOgSgDsuTAAtXyfqVMgtjb10hW6QI91XCQyZP85jl1K90+ZGuz5Ewl0gGT+skKsGAr0weA/JVRqO1Vi5+6QK6b1tbtFct6q61jNa+26fG/RwvfdPeIpm6BswQctcoCeIAYEYf1mWXRGbxQSwlUiCoY91ytUSo4mqDAgHrhQ3Y/4l2ptfeDG/xHfQXlda18S59aW+rZz8/Gtf7vXU0aFeJUKxkREA+tA5tnJGCDlrlATxADAjD+syy6IzeKCWEqkQVDHuuVqiVHE1QYEA9cKG7H/Eu1Nr7wY3+I76C8rrWviXPrS31bOfn41r/d66mjQrxKhWMiIgH1oHNs5Iw4nNwugqcGVUIoOnFryq5YBVMFyLPEAM4rxNXgSVW//uUBA+AAtkszwZtgABapZngzbAACxyZTzmkgAljkynnNJABzA8PYTFvx2VIR78NqPytscLolrRXGbLUv3rfHNp37BGU77n4xv9NNmu7larWfrk294JgJMNJQ9k6Z//3mHE5uF0FTgyqhFB04teVXLAKpguRZ4gBnFeJq8CSq2YHh7CYt+OypCPfhtR+VtjhdEtaK4zZal+9b45tO/YIynfc/GN/pps13crVaz9cm3vBMBJhpKLJ0z//vAA/m9Y8//8wALImAAl3wUQQSnfKuPXkDS5Ql5I8JfOufQG0twDlAxToCFKYarEoVqWFNJ6nNVd9fnX5/O72D/GEfeJf1TBIwjlyh7XHDg+dW/e///9oGG0YAH83rHn//mABZEwAEu+CiCCU75Vx68gaXKEvJHhL51z6A2luAcoGKdAQpTDVYlCtSwppPU5qrvr86/P53ewf4wj7xL+qYJGEcuUPa44cHzq373///tAw2joy5iMKijE5A82dFg4+liKoGBQF//uUBAmAAqobToZt4ABVI2nQzbwAClBrX7j0gBFKDWv3HpACuAcKpXhYKYZtV8OtethxIYxrF3onBiRVg0Z5VNJHjodV8sWdI031RiPzue4vQ9IA5zgUawg6s0J1ixM4H0rkVfR6DLmIwqKMTkDzZ0WDj6WIqgYFAW4BwqleFgphm1Xw6162HEhjGsXeicGJFWDRnlU2I8dDqvlizpGm+qMR+dz3F6HpAHOcCjWEHVmhOsWJnA+lcir6PQCI3I43G43HIxGIwIABFJObxBmwXEYYlhzHKcYl4ccyEKlyI6ONNnSpVx1pORjqKXEvGgpRqN/VI1tIQnEAogesbyZtJhhEj7rQutav+WB4ClRCCI3I43G43HIxGIwIABFJObxBmwXEYYlhzHKcYl4ccyEKlyI6ONNnSpVx1pORjqKXEvGgpRqN/VI1tIQnEAogesbyZtJhhEj7rQutav+WB4ClRDWAElxIBP/fgA5BRsQaBJEcORBgUrqXzDOmyQ7B8Js0//uUBA+AAnIbz+9swABNA3nq7ZgACYxbKSxpgQEzi6UljTAh0ph0igLRRPKosl/+21oMFkUfTMlPbu5vLWMhsIpBoJlEBWacSYwqxs0adkSycpqwAugFfb4AMMU0BUCAJUc6VBAkwaXzDlPhDsnkNmmlMVAKAOiieBJHkv/22tBkzUfXZJ+37zy1jILgmkGjpRAVmnCVjCrGzRozkSydWoAAhAKsACEHAmDZAyOJvjXlQsCbLAhfALBGnDuUyMsKxSWoyN41Ma1yzl81ldaycS4FmOc/HeG0F0EouNMvOJY8wRknQ2MHFgo50O9wABCAVYAEIOBMGyBkcTfGvKhYE2WBC+AWCNOHcpkZYViktRkbxqY1rlnL5rK61k4lwLMc5+Od4vceyz2aZfD2t6Yf1T8VpbBUmvyf/6WSCIaFJmBQHBBPnChjBCJpALOEZzWEOoXAjEVcJwU6QNMnCQemw5lYr1wP4Yrd7Kh813KsJITdZtDZdO/Nb/EeIEOq6mn9//uUBCMMglwayou4eTBKg1lRdw8mCRxbKCzswxEuGGWdow2oj0ziXaKZIIhoUmYFAcEE+cKGMEImkAs4RnNYQ6hcCMRVwnBTpA0ycJB6bDmVivXA/hit3sqHzXcqwkhN1m0Nl0781v8R4gQ3qup/2PTcl2geDKLS0Dlz62OeezARhAXGxQHQWEYYrFAT3TZw4FCwS4JDTF8AkaliQVaJoBk2ZlkiTQ2GgZmiQ1TzBSo+AA7JnYoKkVD1ZLuX4AtuEAwAFeAsHNMiPlXBIxSunQZU2GQTJoCe6bOHAoWCXBIaYvkUWljkvhpGS5mWFUrqaky+ZUivDyLT+PkTH9Nf5Jc8MPCT5LS5agFKBGvwAEGuOYUBgViPhKwULrvceUN2EYE5cfjEPVa76oYHc8iajBh079LyeBx+8xsatjP5+f/v9moz085O0y92c1/TLeIQBc5iarAMAtQBhIDsHMLAswKiDlZBMLgFd7jyhuwXBjO4/GIeq131ERQsohipJqEF//uUBDuAAl4rSc1swABNpWkWriAAT6S1N7msABH4Fqa3NYACK3Y2lxKnyqWlj4I9evjntWStpWltoH3a1c9wPfBQe51tv4QIRW5JWpHY2wmAQCAA3Ez8JQ0wQP/M2RNaIDhCYutAAONBBkAlvb4j4+qi40CU4Bh3bhxXygTVd/7vSq0iY6iSWWXrsXQ29eVJCqUsoXWy7X/vdWvP1JZg/tBEovFId////7rne699onXkM9DUl/+GAZBQDf8JEQCKo//+ogQCRyuRRuRthMAgEABkJp6CMpiBP+aMybcYnwznWkEqoAuaC5GfvF8HZFWg/FXSa8blglIwmKgd/7XpVaYZFGTZZe5DuQPushJSpXIpuwbX/vdWvL6kswcmPQFF4Ef3////LXO917pQHTyGedqP//DAMgoD3/CREAiqP/2eqv////////3dk90KlpVV3eUWVjHLZSMUp5hxnpOcO1WpXVXu4ijKYTSd3IJ7Kzt6Wp7FWiGQUEGFRgdCgpRM//uUBB8P8lRjwIcAoABJLFgQ4BQASJmNAgAFHEkIsiAAAaegRMowxhYVZBMOCoAh7/////////79CTkvIITTqZkZjVGEMPHvEBE7IZXMpGVFYqsKyOYw5jjmOZkFDdkZLkW+9NjEIZxbiYixXO5QkcoRVQoYBgYPlK+XmRGbwXaEFZGvWIpZLWEizxltQ9uELQV7E73d3HESrONG7w3dTdpF6Skf/zNT3I6rIKxJy1oKCtGGjj5FDxcKB+HpYd/3//i3rZFOT0N05+QpgWZYZ3pi5biJNCj4fRQQwYK8p48BQUTWPDTbNjkPn8+1VXKvJ7dJ5Gb2mESWLjnHOYNH07r6//////////icK81KXqTXuvQEteLGdY0DKwrjQVTIMKbgE0b41Egi1KxtuNwUpf9X+bNqTUlXbDClWgIlS4wMVc1F0QZc3/N/yto/7eUShjGUstRgIUZXKUrFYwU5SgKOxgYE+krfVkf6St/VpnMaYwpwoCjoZwoCZwqFC4LH//uUBD+P4jNjPwAjN8I7THfwAEnqR8mAugCAcQkHsheEERr40LUwj//hIzL//9k/9rJZ9lks+yyVDL/////81YHZUMj//yZZLHIy7/5qwMHHIyZZL/sslQyNWt/I1DBQYRxPYaxS/////5kn///6on0VEVP/6on/7OVFVO5QwUGEOzyhgaoqKhQwMGCUjt////8qaLdr/qTiyzLxaJxpRTt6RBhIhDZMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq");function Vi(e,t={}){let s=new Ze,n=new Audio(e);function i(){Zr.debug.paused||Zr.app.isHidden()&&!Zr.globalOpt.backgroundAudio||Zr.audio.ctx.resume(),n.play()}return n.crossOrigin="anonymous",n.loop=!!t.loop,Zr.audio.ctx.createMediaElementSource(n).connect(Zr.audio.masterNode),t.paused||i(),n.onended=()=>s.trigger(),{play(){i()},seek(e){n.currentTime=e},stop(){n.pause(),this.seek(0)},set loop(e){n.loop=e},get loop(){return n.loop},set paused(e){e?n.pause():i()},get paused(){return n.paused},time:()=>n.currentTime,duration:()=>n.duration,set volume(e){n.volume=r(e,0,1)},get volume(){return n.volume},set speed(e){n.playbackRate=Math.max(e,0)},get speed(){return n.playbackRate},set detune(e){},get detune(){return 0},onEnd:e=>s.add(e),then(e){return this.onEnd(e)}}}function Ki(e,t={}){if("string"==typeof e&&Zr.assets.music[e])return Vi(Zr.assets.music[e],t);let s=Zr.audio.ctx,n=t.paused??!1,i=s.createBufferSource(),r=new Ze,a=s.createGain(),o=s.createStereoPanner(),l=t.seek??0,h=0,u=0,d=!1;i.loop=!!t.loop,i.detune.value=t.detune??0,i.playbackRate.value=t.speed??1,i.connect(o),i.onended=()=>{var e;f()>=((null==(e=i.buffer)?void 0:e.duration)??Number.POSITIVE_INFINITY)&&r.trigger()},o.pan.value=t.pan??0,o.connect(a),a.connect(Zr.audio.masterNode),a.gain.value=t.volume??1;let c=function(e){if("string"==typeof e){let t=en(e);if(t)return t;if(Is()<1)return null;throw new Error(`Sound not found: ${e}`)}if(e instanceof $s)return bs.loaded(e);if(e instanceof bs)return e;throw new Error(`Invalid sound: ${e}`)}(e);c instanceof bs&&c.onLoad(e=>{i.buffer=e.buf,n||(h=s.currentTime,i.start(0,l),d=!0)});let f=()=>{if(!i.buffer)return 0;let e=n?u-h:s.currentTime-h,t=i.buffer.duration;return i.loop?e%t:Math.min(e,t)},p=e=>{let t=s.createBufferSource();return t.buffer=e.buffer,t.loop=e.loop,t.playbackRate.value=e.playbackRate.value,t.detune.value=e.detune.value,t.onended=e.onended,t.connect(o),t};return{stop(){this.paused=!0,this.seek(0)},set paused(e){if(n!==e)if(n=e,e)d&&(i.stop(),d=!1),u=s.currentTime;else{i=p(i);let e=u-h;i.start(0,e),d=!0,h=s.currentTime-e,u=0}},get paused(){return n},play(e=0){this.seek(e),this.paused=!1},seek(e){var t;(null==(t=i.buffer)?void 0:t.duration)&&(e>i.buffer.duration||(n?(i=p(i),h=u-e):(i.stop(),i=p(i),h=s.currentTime-e,i.start(0,e),d=!0,u=0)))},set speed(e){i.playbackRate.value=e},get speed(){return i.playbackRate.value},set detune(e){i.detune.value=e},get detune(){return i.detune.value},set volume(e){a.gain.value=Math.max(e,0)},get volume(){return a.gain.value},set pan(e){o.pan.value=e},get pan(){return o.pan.value},set loop(e){i.loop=e},get loop(){return i.loop},duration(){var e;return(null==(e=i.buffer)?void 0:e.duration)??0},time(){return f()%this.duration()},onEnd:e=>r.add(e),then(e){return this.onEnd(e)}}}function Yi(e){return Zr.k.play(Zr.audio.burpSnd,e)}function Xi(e){Zr.audio.masterNode.gain.value=e}function Qi(){return Zr.audio.masterNode.gain.value}function Wi(e){return ut("volume","setVolume / getVolume"),void 0!==e&&Xi(e),Qi()}function zi(){Zr.app.onHide(()=>{Zr.globalOpt.backgroundAudio||Zr.audio.ctx.suspend()}),Zr.app.onShow(()=>{!Zr.globalOpt.backgroundAudio&&!Zr.debug.paused&&Zr.audio.ctx.resume()}),Zr.app.onResize(()=>{if(Zr.app.isFullscreen())return;let e=Zr.globalOpt.width&&Zr.globalOpt.height;e&&!Zr.globalOpt.stretch&&!Zr.globalOpt.letterbox||(Zr.canvas.width=Zr.canvas.offsetWidth*Zr.pixelDensity,Zr.canvas.height=Zr.canvas.offsetHeight*Zr.pixelDensity,St(),e||(Zr.gfx.frameBuffer.free(),Zr.gfx.frameBuffer=new pn(Zr.gfx.ggl,Zr.gfx.ggl.gl.drawingBufferWidth,Zr.gfx.ggl.gl.drawingBufferHeight),Zr.gfx.width=Zr.gfx.ggl.gl.drawingBufferWidth/Zr.pixelDensity/Zr.gscale,Zr.gfx.height=Zr.gfx.ggl.gl.drawingBufferHeight/Zr.pixelDensity/Zr.gscale))}),!1!==Zr.globalOpt.debug&&(Zr.app.onKeyPress(Zr.globalOpt.debugKey??"f1",()=>Zr.debug.inspect=!Zr.debug.inspect),Zr.app.onKeyPress("f2",()=>Zr.debug.clearLog()),Zr.app.onKeyPress("f8",()=>Zr.debug.paused=!Zr.debug.paused),Zr.app.onKeyPress("f7",()=>{Zr.debug.timeScale=dt(r(Zr.debug.timeScale-.2,0,2),1)}),Zr.app.onKeyPress("f9",()=>{Zr.debug.timeScale=dt(r(Zr.debug.timeScale+.2,0,2),1)}),Zr.app.onKeyPress("f10",()=>Zr.debug.stepFrame())),Zr.globalOpt.burp&&Zr.app.onKeyPress("b",()=>Yi())}function Zi(e,t={}){let s=Zr.game.root.add([Xr(e),Br()]),n=5*(t.speed||1),i=t.scale||1;s.add([or(Zr.boomSprite),Wr(0),Hr("center"),br(n,i),...t.comps??[]]);let r=s.add([or(Zr.kaSprite),Wr(0),Hr("center"),Ir(),...t.comps??[]]);return r.wait(.4/n,()=>r.use(br(n,i))),r.onDestroy(()=>s.destroy()),s}function Ji(e,t){if(Zr.game.layers)throw Error("Layers can only be assigned once.");let s=e.indexOf(t);if(-1==s)throw Error("The default layer name should be present in the layers list.");Zr.game.layers=e,Zr.game.defaultLayerIndex=s}function _i(){return Zr.game.layers}function $i(){var e;return(null==(e=Zr.game.layers)?void 0:e[Zr.game.defaultLayerIndex])??null}function er(e,t){ut("layers","setLayers"),Ji(e,t)}function tr(e){e.destroy()}function sr(){return Zr.game.root}function nr(e,t){Zr.game.scenes[e]=t}function ir(e,...t){if(!Zr.game.scenes[e])throw new Error(`Scene not found: ${e}`);Zr.game.events.onOnce("frameEnd",()=>{Zr.game.events.trigger("sceneLeave",e),Zr.app.events.clear(),Zr.game.events.clear(),Zr.game.objEvents.clear(),[...Zr.game.root.children].forEach(t=>{!t.stay||t.scenesToStay&&!t.scenesToStay.includes(e)?Zr.game.root.remove(t):t.trigger("sceneEnter",e)}),Zr.game.root.clearEvents(),zi(),Zr.game.cam={pos:null,scale:g(1),angle:0,shake:0,transform:new v},Zr.game.scenes[e](...t)}),Zr.game.currentScene=e}function rr(e){return Zr.game.events.on("sceneLeave",e)}function ar(){return Zr.game.currentScene}function or(e,t={}){let s=null,n=null,i=null,r=new Ze;if(!e)throw new Error("Please pass the resource name or data to sprite()");let a=(e,n)=>{if(!n)return;let i=n.frames[0].clone();t.quad&&(i=i.scale(t.quad));let a=((e,t,s,n)=>{let i=g(1,1);return s&&n?(i.x=s/(e.width*t.w),i.y=n/(e.height*t.h)):s?(i.x=s/(e.width*t.w),i.y=i.x):n&&(i.y=n/(e.height*t.h),i.x=i.y),i})(n.tex,i,t.width,t.height);if(e.width=n.tex.width*i.w*a.x,e.height=n.tex.height*i.h*a.y,n.anims)for(let t in n.anims){let e=n.anims[t];"number"!=typeof e&&(e.frames=o(e))}s=n,r.trigger(s),t.anim&&e.play(t.anim)},o=e=>{if(e.frames)return e.frames;let t=[];if(void 0===e.from||void 0===e.to)throw new Error("Sprite anim 'from' and 'to' must be defined if 'frames' is not defined");let s=Math.abs(e.to-e.from)+1;for(let n=0;n<s;n++)t.push(e.from+n*Math.sign(e.to-e.from));if(e.pingpong)for(let n=s-2;n>0;n--)t.push(t[n]);return t};return{id:"sprite",width:0,height:0,frame:t.frame||0,quad:t.quad||new m(0,0,1,1),animSpeed:t.animSpeed??1,flipX:t.flipX??!1,flipY:t.flipY??!1,get sprite(){return e.toString()},set sprite(e){let t=Ts(e);t&&t.onLoad(e=>a(this,e))},get animFrame(){if(!s||!n||null===i)return this.frame;let e=s.anims[n.name];return"number"==typeof e?e:void 0===e.from||void 0===e.to?n.frameIndex:this.frame-Math.min(e.from,e.to)},draw(){if(!s)return;let e=s.frames[this.frame??0];if(!e)throw new Error(`Frame not found: ${this.frame??0}`);if(s.slice9){let{left:n,right:i,top:r,bottom:a}=s.slice9,o=s.tex.width*e.w,l=s.tex.height*e.h,h=this.width-n-i,u=this.height-r-a,d=n/o,c=i/o,f=1-d-c,p=r/l,g=a/l,m=1-p-g,y=[w(0,0,d,p),w(d,0,f,p),w(d+f,0,c,p),w(0,p,d,m),w(d,p,f,m),w(d+f,p,c,m),w(0,p+m,d,g),w(d,p+m,f,g),w(d+f,p+m,c,g),w(0,0,n,r),w(n,0,h,r),w(n+h,0,i,r),w(0,r,n,u),w(n,r,h,u),w(n+h,r,i,u),w(0,r+u,n,a),w(n,r+u,h,a),w(n+h,r+u,i,a)];for(let w=0;w<9;w++){let n=y[w],i=y[w+9];Cn(Object.assign(On(this),{pos:i.pos(),tex:s.tex,quad:e.scale(n),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:i.w,height:i.h}))}}else Cn(Object.assign(On(this),{tex:s.tex,quad:e.scale(this.quad??new m(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:this.width,height:this.height}))},add(){let t=Ts(e);t?t.onLoad(e=>a(this,e)):Ai(()=>a(this,Ts(e).data))},update(){if(!s||!n||null===i)return;let e=s.anims[n.name];if("number"!=typeof e){if(0===e.speed)throw new Error("Sprite anim speed cannot be 0");if(n.timer+=Dt()*this.animSpeed,n.timer>=1/n.speed){n.timer=0,n.frameIndex+=i;let t=e.frames;if(n.frameIndex>=t.length)if(n.pingpong&&!e.pingpong)i=-1,n.frameIndex=t.length-2;else{if(!n.loop)return this.frame=t.at(-1),n.onEnd(),void this.stop();n.frameIndex=0}else if(n.frameIndex<0)if(n.pingpong&&n.loop)i=1,n.frameIndex=1;else{if(!n.loop)return this.frame=t[0],n.onEnd(),void this.stop();n.frameIndex=t.length-1}this.frame=t[n.frameIndex]}}else this.frame=e},play(e,t={}){if(!s)return void r.add(()=>this.play(e,t));let a=s.anims[e];if(void 0===a)throw new Error(`Anim not found: ${e}`);n&&this.stop(),n="number"==typeof a?{name:e,timer:0,loop:!1,pingpong:!1,speed:0,frameIndex:0,onEnd:()=>{}}:{name:e,timer:0,loop:t.loop??a.loop??!1,pingpong:t.pingpong??a.pingpong??!1,speed:t.speed??a.speed??10,frameIndex:0,onEnd:t.onEnd??(()=>{})},i="number"==typeof a?null:1,this.frame="number"==typeof a?a:a.frames[0],this.trigger("animStart",e)},stop(){if(!n)return;let e=n.name;n=null,this.trigger("animEnd",e)},numFrames:()=>(null==s?void 0:s.frames.length)??0,getCurAnim:()=>n,curAnim:()=>null==n?void 0:n.name,getAnim:e=>(null==s?void 0:s.anims[e])??null,hasAnim(e){return!!this.getAnim(e)},onAnimEnd(e){return this.on("animEnd",e)},onAnimStart(e){return this.on("animStart",e)},renderArea(){return new te(g(0),this.width,this.height)},inspect:()=>"string"==typeof e?`sprite: "${e}"`:null}}function lr(e,t={}){function s(e){var s,n;let i=vn(Object.assign(On(e),{text:e.text+"",size:e.textSize,font:e.font,width:t.width&&e.width,align:e.align,letterSpacing:e.letterSpacing,lineSpacing:e.lineSpacing,transform:e.textTransform,styles:e.textStyles,indentAll:t.indentAll}));return t.width||(e.width=i.width/((null==(s=e.scale)?void 0:s.x)||1)),e.height=i.height/((null==(n=e.scale)?void 0:n.y)||1),i}let n={id:"text",set text(t){e=t,s(this),this.renderedText=An(e).text},get text(){return e},textSize:t.size??36,font:t.font,width:t.width??0,height:0,align:t.align,lineSpacing:t.lineSpacing,letterSpacing:t.letterSpacing,textTransform:t.transform,textStyles:t.styles,renderedText:e?An(e).text:"",add(){Ai(()=>s(this))},draw(){bn(s(this))},renderArea(){return new te(g(0),this.width,this.height)}};return s(n),n}function hr(e,t){return{id:"rect",width:e,height:t,draw(){xn(Object.assign(On(this),{width:this.width,height:this.height}))},renderArea(){return new te(g(0),this.width,this.height)},inspect(){return`uvquad: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)})h`}}}function ur(e={}){let t=null,s=null,n=null,i=null;return{id:"agent",require:["pos","tile"],agentSpeed:e.speed??100,allowDiagonals:e.allowDiagonals??!0,getDistanceToTarget(){return t?this.pos.dist(t):0},getNextLocation:()=>s&&n?s[n]:null,getPath:()=>s?s.slice():null,getTarget:()=>t,isNavigationFinished:()=>!s||null===n,isTargetReachable:()=>null!==s,isTargetReached(){return!t||this.pos.eq(t)},setTarget(e){t=e,s=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),n=s?0:null,s&&null!==n?(i||(i=this.getLevel().onNavigationMapChanged(()=>{t&&s&&null!==n&&(s=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),s?(n=0,this.trigger("navigationNext",this,s[n])):(n=null,this.trigger("navigationEnded",this)))}),this.onDestroy(()=>null==i?void 0:i.cancel())),this.trigger("navigationStarted",this),this.trigger("navigationNext",this,s[n])):this.trigger("navigationEnded",this)},update(){if(t&&s&&null!==n){if(this.pos.sdist(s[n])<2){if(n===s.length-1)return this.pos=t.clone(),n=null,this.trigger("navigationEnded",this),void this.trigger("targetReached",this);n++,this.trigger("navigationNext",this,s[n])}this.moveTo(s[n],this.agentSpeed)}},onNavigationStarted(e){return this.on("navigationStarted",e)},onNavigationNext(e){return this.on("navigationNext",e)},onNavigationEnded(e){return this.on("navigationEnded",e)},onTargetReached(e){return this.on("targetReached",e)},inspect:()=>"agent: "+JSON.stringify({target:JSON.stringify(t),path:JSON.stringify(s)})}}function dr(e){let t=e.graph;return{id:"pathfinder",require:["pos"],navigateTo(t){var s;return null==(s=this.graph)?void 0:s.getWaypointPath(this.pos,t,e.navigationOpt)},get graph(){if(t)return t;let e=this.parent;for(;e;){if(e.has("pathfinderMap"))return e.graph;e=e.parent}},set graph(e){t=e}}}function cr(e={}){let t=e.waypoints,s=e.speed||100,n=e.endBehavior||"stop",i=0,r=null!=t;return{id:"patrol",require:["pos"],get patrolSpeed(){return s},set patrolSpeed(e){s=e},get waypoints(){return t},set waypoints(e){t=e,i=0,r=!1},get nextLocation(){return t?t[i]:void 0},update(){let e=this.nextLocation;if(t&&e&&!r&&(this.moveTo(e,s),this.pos.sdist(e)<9))switch(n){case"loop":i=(i+1)%t.length;break;case"ping-pong":i+=1,i==t.length&&(t.reverse(),i=0);break;case"stop":i<t.length-1?i+=1:r||(r=!0,this.trigger("patrolFinished",this))}},onPatrolFinished(e){return this.on("patrolFinished",e)}}}function fr(e,t={}){let s="function"==typeof e?e:()=>Zr.game.root.query(e),n=t.checkFrequency||1,i="number"==typeof t.direction?p.fromAngle(t.direction):t.direction,r=0;return{id:"sentry",require:["pos"],direction:"number"==typeof t.direction?p.fromAngle(t.direction):t.direction,spotted:[],set directionAngle(e){this.direction=void 0!==e?p.fromAngle(e):void 0},get directionAngle(){return this.direction?this.direction.angle():void 0},fieldOfView:t.fieldOfView||200,isWithinFieldOfView(e,s,n){let r=("number"==typeof s?p.fromAngle(s):s)||i,a=n||t.fieldOfView;if(!r||!a||a>=360)return!0;let o=a/2;return e.pos&&r.angleBetween(e.pos.sub(this.pos))<=o},hasLineOfSight(e){let s=Qn(this.pos,e.pos.sub(this.pos),t.raycastExclude);return null!=s&&s.object===e},update(){if(r+=Dt(),r>n){r-=n;let e=s();if(e.length&&i&&this.fieldOfView&&this.fieldOfView<360){let t=this.fieldOfView/2;e=e.filter(e=>e.pos&&i.angleBetween(e.pos.sub(this.pos))<=t)}e.length&&t.lineOfSight&&(e=e.filter(e=>e.pos&&this.hasLineOfSight(e))),e.length>0&&(this.spotted=e,this.trigger("objectSpotted",e))}},onObjectsSpotted(e){return this.on("objectSpotted",e)}}}function pr(e={}){let t=g(0),s=e.isObstacle??!1,n=e.cost??0,i=e.edges??[],r=()=>{let e={left:1,top:2,right:4,bottom:8};return i.map(t=>e[t]||0).reduce((e,t)=>e|t,0)},a=r();return{id:"tile",tilePosOffset:e.offset??g(0),set tilePos(e){let s=this.getLevel();t=e.clone(),this.pos=g(this.tilePos.x*s.tileWidth(),this.tilePos.y*s.tileHeight()).add(this.tilePosOffset)},get tilePos(){return t},set isObstacle(e){s!==e&&(s=e,this.getLevel().invalidateNavigationMap())},get isObstacle(){return s},set cost(e){n!==e&&(n=e,this.getLevel().invalidateNavigationMap())},get cost(){return n},set edges(e){i=e,a=r(),this.getLevel().invalidateNavigationMap()},get edges(){return i},get edgeMask(){return a},getLevel(){return this.parent},tileMove(e){let t=this.getLevel();t.removeFromSpatialMap(this),this.tilePos=this.tilePos.add(e),t.insertIntoSpatialMap(this),t.trigger("spatialMapChanged")},moveLeft(){this.tileMove(g(-1,0))},moveRight(){this.tileMove(g(1,0))},moveUp(){this.tileMove(g(0,-1))},moveDown(){this.tileMove(g(0,1))}}}var gr=class{constructor(e,t,s){n(this,"name"),n(this,"duration"),n(this,"loops"),n(this,"direction"),n(this,"easing"),n(this,"interpolation"),n(this,"isFinished"),n(this,"timing"),n(this,"easings"),n(this,"relative"),this.name=e,this.duration=t.duration,this.loops=t.loops||0,this.direction=t.direction||"forward",this.easing=t.easing||es.linear,this.interpolation=t.interpolation||"linear",this.isFinished=!1,this.timing=t.timing,this.easings=t.easings,this.relative=s}update(e,t){return!0}getLowerKeyIndexAndRelativeTime(e,t,s){let n=t-1,i=e/this.duration;if(0!==this.loops&&i>=this.loops)return[n,0,!0];let r=Math.trunc(i);if(i-=r,("reverse"==this.direction||"ping-pong"==this.direction&&1&r)&&(i=1-i),s){let e=0;for(;void 0!==s[e+1]&&s[e+1]<i;)e++;return e>=n?[n,0,!0]:[e,(i-s[e])/(s[e+1]-s[e]),!1]}{let e=Math.floor((t-1)*i);return[e,(i-e/n)*n,!1]}}setValue(e,t,s){if(this.relative)switch(t){case"pos":e.pos=e.base.pos.add(s);break;case"angle":e.angle=e.base.angle+s;break;case"scale":e.scale=e.base.scale.scale(s);break;case"opacity":e.opacity=e.base.opacity*s;break;default:e[t]=s}else e[t]=s}serialize(){let e={duration:this.duration,keys:[]};return this.loops&&(e.loops=this.loops),"forward"!==this.direction&&(e.direction=this.direction),this.easing!=es.linear&&(e.easing=this.easing.name),"linear"!==this.interpolation&&(e.interpolation=this.interpolation),this.timing&&(e.timing=this.timing),this.easings&&(e.easings=this.easings.map(e=>this.easing.name)),e}};function mr(e,t){return t.add(t.sub(e))}var wr=class extends gr{constructor(e,t,s,i){super(e,s,i),n(this,"keys"),this.keys=t}update(e,t){let[s,n,i]=this.getLowerKeyIndexAndRelativeTime(t,this.keys.length,this.timing);if(0==n||"none"===this.interpolation)this.setValue(e,this.name,this.keys[s]);else{let t=this.easings?this.easings[s]:this.easing;this.setValue(e,this.name,d(this.keys[s],this.keys[s+1],t(n)))}return i}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}},yr=class extends gr{constructor(e,t,s,i,r){var a;if(super(e,s,i),n(this,"keys"),n(this,"curves"),n(this,"dcurves"),this.keys=t,"spline"===this.interpolation){this.curves=[],r&&(this.dcurves=[]);for(let e=0;e<this.keys.length-1;e++){let t=this.keys[e],s=e+1,n=this.keys[s],i=e>0?this.keys[e-1]:mr(n,t),o=s<this.keys.length-1?this.keys[s+1]:mr(t,n);this.curves.push(we(i,t,n,o)),r&&(null==(a=this.dcurves)||a.push(we(i,t,n,o,ve)))}}}update(e,t){let[s,n,i]=this.getLowerKeyIndexAndRelativeTime(t,this.keys.length,this.timing);if(0==n||"none"===this.interpolation)this.setValue(e,this.name,this.keys[s]);else{let t=this.easings?this.easings[s]:this.easing;switch(this.interpolation){case"linear":this.setValue(e,this.name,this.keys[s].lerp(this.keys[s+1],t(n)));break;case"slerp":this.setValue(e,this.name,this.keys[s].slerp(this.keys[s+1],t(n)));break;case"spline":if(this.curves){this.setValue(e,this.name,this.curves[s](t(n))),this.dcurves&&this.setValue(e,"angle",this.dcurves[s](t(n)).angle());break}}}return i}serialize(){return Object.assign(super.serialize(),{keys:this.keys.map(e=>[e.x,e.y])})}},Ar=class extends gr{constructor(e,t,s,i){super(e,s,i),n(this,"keys"),this.keys=t}update(e,t){let[s,n,i]=this.getLowerKeyIndexAndRelativeTime(t,this.keys.length,this.timing);if(0==n||"none"==this.interpolation)this.setValue(e,this.name,this.keys[s]);else{let t=this.easings?this.easings[s]:this.easing;this.setValue(e,this.name,this.keys[s].lerp(this.keys[s+1],t(n)))}return i}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}};function vr(e={}){let t=[],s=0,n=!1;return{id:"animate",require:e.followMotion?["rotate"]:void 0,base:{pos:g(0,0),angle:0,scale:g(1,1),opacity:1},animation:{paused:!1,seek(e){s=r(e,0,this.duration),t.forEach(e=>{e.isFinished=!1}),n=!1},get duration(){return t.reduce((e,t)=>Math.max(t.duration,e),0)}},add(){e.relative&&(this.has("pos")&&(this.base.pos=this.pos.clone()),this.has("rotate")&&(this.base.angle=this.angle),this.has("scale")&&(this.base.scale=this.scale),this.has("opacity")&&(this.base.opacity=this.opacity))},update(){if(this.animation.paused)return;let e,i=!0;s+=Dt();for(let n of t)e=n.update(this,s),e&&!n.isFinished&&(n.isFinished=!0,this.trigger("animateChannelFinished",n.name)),i&&(i=e);i&&!n&&(n=!0,this.trigger("animateFinished"))},animate(s,i,r){n=!1,this.unanimate(s),"number"==typeof i[0]?t.push(new wr(s,i,r,e.relative||!1)):i[0]instanceof p?t.push(new yr(s,i,r,e.relative||!1,"pos"===s&&(e.followMotion||!1))):i[0]instanceof a&&t.push(new Ar(s,i,r,e.relative||!1))},unanimate(e){let s=t.findIndex(t=>t.name===e);s>=0&&t.splice(s,1)},unanimateAll(){t.splice(0,t.length)},onAnimateFinished(e){return this.on("animateFinished",e)},onAnimateChannelFinished(e){return this.on("animateChannelFinished",e)},serializeAnimationChannels:()=>t.reduce((e,t)=>(e[t.name]=t.serialize(),e),{}),serializeAnimationOptions(){let t={};return e.followMotion&&(t.followMotion=!0),e.relative&&(t.relative=!0),t}}}function xr(e,t){let s={name:e.name};return e.has("animate")&&(s.channels=e.serializeAnimationChannels(),Object.assign(s,e.serializeAnimationOptions())),e.children.length>0&&(s.children=e.children.filter(e=>e.has("named")).map(e=>xr(e,e.name))),s}function br(e=2,t=1){let s=0;return{require:["scale"],update(){let n=Math.sin(s*e)*t;n<0&&this.destroy(),this.scale=g(n),s+=Dt()}}}function Er(e,t){if(null==e)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(t=1){this.setHP(e-t),this.trigger("hurt",t)},heal(t=1){let s=e;this.setHP(e+t),this.trigger("heal",e-s)},hp:()=>e,maxHP:()=>t??null,setMaxHP(e){t=e},setHP(s){(e=t?Math.min(t,s):s)<=0&&this.trigger("death")},onHurt(e){return this.on("hurt",e)},onHeal(e){return this.on("heal",e)},onDeath(e){return this.on("death",e)},inspect:()=>`health: ${e}`}}function Mr(e,t={}){if(null==e)throw new Error("lifespan() requires time");let s=t.fade??0;return{id:"lifespan",require:["opacity"],add(){Zr.game.root.wait(e,()=>{this.opacity=this.opacity??1,s>0?Zr.game.root.tween(this.opacity,0,s,e=>this.opacity=e,es.linear).onEnd(()=>{this.destroy()}):this.destroy()})}}}function qr(e){return{id:"named",name:e}}function Sr(e,t,s){if(!e)throw new Error("state() requires an initial state");let n={};function i(e){n[e]||(n[e]={enter:new Ze,end:new Ze,update:new Ze,draw:new Ze})}function r(e,t,s){return i(t),n[t][e].add(s)}function a(e,t,...s){i(t),n[t][e].trigger(...s)}let o=!1;return{id:"state",state:e,enterState(e,...n){if(o=!0,t&&!t.includes(e))throw new Error(`State not found: ${e}`);let i=this.state;if(s){if(!(null==s?void 0:s[i]))return;let t="string"==typeof s[i]?[s[i]]:s[i];if(!t.includes(e))throw new Error(`Cannot transition state from "${i}" to "${e}". Available transitions: ${t.map(e=>`"${e}"`).join(", ")}`)}a("end",i,...n),this.state=e,a("enter",e,...n),a("enter",`${i} -> ${e}`,...n)},onStateTransition:(e,t,s)=>r("enter",`${e} -> ${t}`,s),onStateEnter:(e,t)=>r("enter",e,t),onStateUpdate:(e,t)=>r("update",e,t),onStateDraw:(e,t)=>r("draw",e,t),onStateEnd:(e,t)=>r("end",e,t),update(){o||(a("enter",e),o=!0),a("update",this.state)},draw(){a("draw",this.state)},inspect(){return`state: ${this.state}`}}}function Br(e){return{id:"stay",stay:!0,scenesToStay:e}}function Rr(e=!0,t){let s,n;return{id:"textInput",hasFocus:e,require:["text"],typedText:"",add(){let e=()=>{this.text=this.typedText.replace(/([\[\\])/g,"\\$1")};s=Zr.k.onCharInput(s=>{this.hasFocus&&(!t||this.typedText.length<t)&&(Zr.k.isKeyDown("shift")?this.typedText+=s.toUpperCase():this.typedText+=s,e())}),n=Zr.k.onKeyPressRepeat("backspace",()=>{this.hasFocus&&(this.typedText=this.typedText.slice(0,-1),e())})},destroy(){s.cancel(),n.cancel()}}}function Ir(e=1e3){return{id:"timer",maxLoopsPerFrame:e,loop(e,t,s=1/0,n=!1){let i=n?0:e,r=new Ze,a=this.onUpdate(()=>{i+=Zr.app.state.dt;for(let n=0;i>=e&&n<this.maxLoopsPerFrame;n++)if(s--,t(),i-=e,s<=0)return a.cancel(),void r.trigger()});return{get paused(){return a.paused},set paused(e){a.paused=e},cancel:a.cancel,onEnd(e){r.add(e)},then(e){return r.add(e),this}}},wait(e,t){return this.loop(e,t??(()=>{}),1,!0)},tween(e,t,s,n,i=es.linear){let r=0,a=[],o=this.onUpdate(()=>{r+=Zr.app.state.dt;let l=Math.min(r/s,1);n(d(e,t,i(l))),1===l&&(o.cancel(),n(t),a.forEach(e=>e()))});return{get paused(){return o.paused},set paused(e){o.paused=e},onEnd(e){a.push(e)},then(e){return this.onEnd(e),this},cancel(){o.cancel()},finish(){o.cancel(),n(t),a.forEach(e=>e())}}}}}var Pr=0;function Cr(e={}){let t={},s=new Set,n=[];return{id:"area",collisionIgnore:e.collisionIgnore??[],add(){Pr++,this.area.cursor&&n.push(this.onHover(()=>Zr.app.setCursor(this.area.cursor))),n.push(this.onCollideUpdate((e,n)=>{if(!e.id)throw new Error("area() requires the object to have an id");t[e.id]||this.trigger("collide",e,n),n&&(t[e.id]=n,s.add(e.id))}))},destroy(){Pr--;for(let e of n)e.cancel()},fixedUpdate(){for(let e in t)s.has(Number(e))||(this.trigger("collideEnd",t[e].target),delete t[e]);s.clear()},drawInspect(){let e=this.localArea();us(),hs(this.area.offset);let t={outline:{width:4/ys(),color:o(0,0,255)},anchor:this.anchor,fill:!1,fixed:Dn(this)};e instanceof te?En({...t,pos:e.pos,width:e.width*this.area.scale.x,height:e.height*this.area.scale.y}):e instanceof ie?an({...t,pts:e.pts,scale:this.area.scale}):e instanceof se&&ln({...t,pos:e.center,radius:e.radius}),ps()},area:{shape:e.shape??null,scale:e.scale?g(e.scale):g(1),offset:e.offset??g(0),cursor:e.cursor??null},isClicked(){return Zr.app.isMousePressed()&&this.isHovering()},isHovering(){let e=Dn(this)?Zr.k.mousePos():Zr.k.toWorld(Zr.k.mousePos());return this.hasPoint(e)},checkCollision(e){if(!e.id)throw new Error("checkCollision() requires the object to have an id");return t[e.id]??null},getCollisions:()=>Object.values(t),isColliding(e){if(!e.id)throw new Error("isColliding() requires the object to have an id");return!!t[e.id]},isOverlapping(e){if(!e.id)throw new Error("isOverlapping() requires the object to have an id");let s=t[e.id];return s&&s.hasOverlap()},onClick(e,t="left"){let s=this.onMousePress(t,()=>{this.isHovering()&&e()});return n.push(s),s},onHover(e){let t=!1;return this.onUpdate(()=>{t?t=this.isHovering():this.isHovering()&&(t=!0,e())})},onHoverUpdate(e){return this.onUpdate(()=>{this.isHovering()&&e()})},onHoverEnd(e){let t=!1;return this.onUpdate(()=>{t?this.isHovering()||(t=!1,e()):t=this.isHovering()})},onCollide(e,t){if("function"==typeof e&&void 0===t)return this.on("collide",e);if("string"==typeof e)return this.onCollide((s,n)=>{s.is(e)&&(null==t||t(s,n))});throw new Error("onCollide() requires either a function or a tag")},onCollideUpdate(e,t){if("function"==typeof e&&void 0===t)return this.on("collideUpdate",e);if("string"==typeof e)return this.on("collideUpdate",(s,n)=>s.is(e)&&(null==t?void 0:t(s,n)));throw new Error("onCollideUpdate() requires either a function or a tag")},onCollideEnd(e,t){if("function"==typeof e&&void 0===t)return this.on("collideEnd",e);if("string"==typeof e)return this.on("collideEnd",s=>s.is(e)&&(null==t?void 0:t(s)));throw new Error("onCollideEnd() requires either a function or a tag")},hasPoint(e){return K(this.worldArea(),e)},resolveCollision(e){let t=this.checkCollision(e);t&&!t.resolved&&(this.pos=this.pos.add(t.displacement),t.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let e=this.localArea();if(!(e instanceof ie||e instanceof te))throw new Error("Only support polygon and rect shapes for now");let t=this.transform.clone().translate(this.area.offset).scale(g(this.area.scale??1));if(e instanceof te){let s=Qt(this.anchor||Oe).add(1,1).scale(-.5).scale(e.width,e.height);t.translate(s)}return e.transform(t)},screenArea(){let e=this.worldArea();return Dn(this)?e:e.transform(Zr.game.cam.transform)},inspect(){var e,t,s,n,i,r,a;return(null==(e=this.area.scale)?void 0:e.x)==(null==(t=this.area.scale)?void 0:t.y)?`area: ${null==(n=null==(s=this.area.scale)?void 0:s.x)?void 0:n.toFixed(1)}x`:`area: (${null==(r=null==(i=this.area.scale)?void 0:i.x)?void 0:r.toFixed(1)}x, ${null==(a=this.area.scale.y)?void 0:a.toFixed(1)}y)`}}}function kr(e={}){let t,s=null,n=null,i=!1,r=g(0),a=null,o=null;return{id:"body",require:["pos"],vel:g(0),drag:e.drag??0,jumpForce:e.jumpForce??640,gravityScale:e.gravityScale??1,isStatic:e.isStatic??!1,mass:e.mass??1,add(){if(a=this.pos.clone(),o=this.pos.clone(),t=this.pos.clone(),0===this.mass)throw new Error("Can't set body mass to 0");this.has("area")&&(this.onCollideUpdate((e,t)=>{if(!t||!e.has("body")||t.resolved)return;this.trigger("beforePhysicsResolve",t);let s=t.reverse();if(e.trigger("beforePhysicsResolve",s),!(t.resolved||s.resolved||this.isStatic&&e.isStatic)){if(this.isStatic||e.isStatic){let s=!this.isStatic&&e.isStatic?t:t.reverse();s.source.pos=s.source.pos.add(s.displacement),s.source.transform=is(s.source)}else{let s=this.mass+e.mass;this.pos=this.pos.add(t.displacement.scale(e.mass/s)),e.pos=e.pos.add(t.displacement.scale(-this.mass/s)),this.transform=is(this),e.transform=is(e)}t.resolved=!0,this.trigger("physicsResolve",t),e.trigger("physicsResolve",t.reverse())}}),this.onPhysicsResolve(e=>{if(Zr.game.gravity)if(e.isBottom()&&this.isFalling()){this.vel=this.vel.reject(Zr.game.gravity.unit());let t=s;s=e.target,t!=s&&(n=e.target.pos),i?i=!1:t||(this.trigger("ground",s),e.target.trigger("land",this))}else e.isTop()&&this.isJumping()&&(this.vel=this.vel.reject(Zr.game.gravity.unit()),this.trigger("headbutt",e.target),e.target.trigger("headbutted",this))}))},update(){s&&this.isColliding(s)&&s.exists()&&s.has("body")&&(n&&!s.pos.eq(n)&&!1!==e.stickToPlatform&&this.moveBy(s.pos.sub(n)),n=s.pos);let i=Ut();i&&(this.pos.x==t.x&&(this.pos.x=d(a.x,o.x,i/Ot()),t.x=this.pos.x),this.pos.y==t.y&&(this.pos.y=d(a.y,o.y,i/Ot()),t.y=this.pos.y))},fixedUpdate(){if(a&&(this.pos.x==t.x&&(this.pos.x=a.x),this.pos.y==t.y&&(this.pos.y=a.y),a=null),Zr.game.gravity&&!this.isStatic){i&&(s=null,n=null,this.trigger("fallOff"),i=!1),s&&(!this.isColliding(s)||!s.exists()||!s.has("body"))&&(i=!0);let t=this.vel.clone();this.vel=this.vel.add(Zr.game.gravity.scale(this.gravityScale*Dt()));let r=e.maxVelocity??65536;this.vel.slen()>r*r&&(this.vel=this.vel.unit().scale(r)),t.dot(Zr.game.gravity)<0&&this.vel.dot(Zr.game.gravity)>=0&&this.trigger("fall")}if(this.vel.x+=r.x*Dt(),this.vel.y+=r.y*Dt(),this.vel.x*=1-this.drag*Dt(),this.vel.y*=1-this.drag*Dt(),this.move(this.vel),Ut()){a=this.pos.clone();let e=this.vel.add(r.scale(Dt()));o=this.pos.add(e.scale(Dt())),t=this.pos.clone()}r.x=0,r.y=0},onPhysicsResolve(e){return this.on("physicsResolve",e)},onBeforePhysicsResolve(e){return this.on("beforePhysicsResolve",e)},curPlatform:()=>s,isGrounded:()=>null!==s,isFalling(){return this.vel.dot(ji())>0},isJumping(){return this.vel.dot(ji())<0},applyImpulse(e){this.isStatic||(this.vel=this.vel.add(e))},addForce(e){this.isStatic||(r.x+=e.x/this.mass,r.y+=e.y/this.mass)},jump(e){this.isStatic||(s=null,n=null,this.vel=ji().scale(-e||-this.jumpForce))},onGround(e){return this.on("ground",e)},onFall(e){return this.on("fall",e)},onFallOff(e){return this.on("fallOff",e)},onHeadbutt(e){return this.on("headbutt",e)},onLand(e){return this.on("land",e)},onHeadbutted(e){return this.on("headbutted",e)},inspect(){return`gravityScale: ${this.gravityScale}x`}}}function Fr(e=2){let t=e;return{id:"doubleJump",require:["body"],numJumps:e,add(){this.onGround(()=>{t=this.numJumps})},doubleJump(e){t<=0||(t<this.numJumps&&this.trigger("doubleJump"),t--,this.jump(e))},onDoubleJump(e){return this.on("doubleJump",e)},inspect:()=>`jumpsLeft: ${t}`}}function Tr(e){return{id:"surfaceEffector",require:["area"],speed:e.speed,speedVariation:e.speedVariation??0,forceScale:e.speedVariation??.9,add(){this.onCollideUpdate("body",(e,t)=>{var s;let n=null==t?void 0:t.normal.normal(),i=e.vel.project(n),r=null==(s=null==n?void 0:n.scale(this.speed))?void 0:s.sub(i);e.addForce(null==r?void 0:r.scale(e.mass*this.forceScale))})}}}function Dr(e){return{id:"areaEffector",require:["area"],useGlobalAngle:e.useGlobalAngle||!1,forceAngle:e.forceAngle,forceMagnitude:e.forceMagnitude,forceVariation:e.forceVariation??0,linearDrag:e.linearDrag??0,add(){this.onCollideUpdate("body",(e,t)=>{if(!e.has("body"))return;let s=p.fromAngle(this.forceAngle).scale(this.forceMagnitude);e.addForce(s),this.linearDrag&&e.addForce(e.vel.scale(-this.linearDrag))})}}}function Or(e){return{id:"pointEffector",require:["area","pos"],forceMagnitude:e.forceMagnitude,forceVariation:e.forceVariation??0,distanceScale:e.distanceScale??1,forceMode:e.forceMode||"inverseLinear",linearDrag:e.linearDrag??0,add(){this.onCollideUpdate("body",(e,t)=>{let s=this.pos.sub(e.pos),n=s.len(),i=n*this.distanceScale/10,r="constant"===this.forceMode?1:"inverseLinear"===this.forceMode?1/i:1/i**2,a=s.scale(this.forceMagnitude*r/n);e.addForce(a),this.linearDrag&&e.addForce(e.vel.scale(-this.linearDrag))})}}}function Ur(e){return{id:"constantForce",require:["body"],force:e.force,update(){this.force&&this.addForce(this.force)}}}function Lr(e){return{id:"platformEffector",require:["area","body"],surfaceArc:e.surfaceArc??180,useOneWay:e.useOneWay??!1,add(){this.onBeforePhysicsResolve(e=>{let t=e.target.vel,s=ji().scale(-1).angleBetween(t);Math.abs(s)>this.surfaceArc/2&&e.preventResolution()})}}}function Nr(e){return{id:"buoyancyEffector",require:["area"],surfaceLevel:e.surfaceLevel,density:e.density??1,linearDrag:e.linearDrag??1,angularDrag:e.angularDrag??.2,flowAngle:e.flowAngle??0,flowMagnitude:e.flowMagnitude??0,flowVariation:e.flowVariation??0,add(){this.onCollideUpdate("body",(e,t)=>{let s=e,n=s.worldArea(),[i,r]=n.cut(g(-100,this.surfaceLevel),g(100,this.surfaceLevel));i&&(this.applyBuoyancy(s,i),this.applyDrag(s,i)),this.flowMagnitude&&s.addForce(p.fromAngle(this.flowAngle).scale(this.flowMagnitude))})},applyBuoyancy(e,t){let s=this.density*t.area(),n=g(0,1).scale(-s);e.addForce(n)},applyDrag(e,t){let s=e.vel,n=this.density*this.linearDrag,i=s.scale(-n);e.addForce(i)}}}function Hr(e){if(!e)throw new Error("Please define an anchor");return{id:"anchor",anchor:e,inspect(){return"string"==typeof this.anchor?"anchor: "+this.anchor:"anchor: "+this.anchor.toString()}}}function jr(){return{id:"fixed",fixed:!0}}function Gr(e,t){return{id:"follow",require:["pos"],follow:{obj:e,offset:t??g(0)},add(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}function Vr(e){var t;let s=null==(t=Zr.game.layers)?void 0:t.indexOf(e);return{id:"layer",get layerIndex(){return s??null},get layer(){var e;return s?(null==(e=Zr.game.layers)?void 0:e[s])??null:null},set layer(e){var t;if(s=null==(t=Zr.game.layers)?void 0:t.indexOf(e),-1==s)throw Error("Invalid layer name")},inspect(){return`layer: ${this.layer}`}}}function Kr(e,t){let s="number"==typeof e?p.fromAngle(e):e.unit();return{id:"move",require:["pos"],update(){this.move(s.scale(t))}}}function Yr(e={}){let t=!1,s=new te(g(0),ms(),ws()),n=new te(g(0),0,0),i=s=>{s.isOffScreen()?(t||(s.trigger("exitView"),t=!0),e.hide&&(s.hidden=!0),e.pause&&(s.paused=!0),e.destroy&&s.destroy()):(t&&(s.trigger("enterView"),t=!1),e.hide&&(s.hidden=!1),e.pause&&(s.paused=!1))};return{id:"offscreen",require:["pos"],offscreenDistance:e.distance??200,isOffScreen(){let e=this.screenPos();if(!e)return!1;if(s.width=ms(),s.height=ws(),!this.offscreenDistance&&this.width&&this.height)return n.width=this.width,n.height=this.height,n.pos=this.pos,n.collides(s);let t=this.offscreenDistance?this.offscreenDistance:200;return!D(s,e)&&s.sdistToPoint(e)>t*t},onExitScreen(e){return this.on("exitView",e)},onEnterScreen(e){return this.on("enterView",e)},add(){e.pause&&e.unpause?ei(()=>i(this)):this.onUpdate(()=>i(this))}}}function Xr(...e){return{id:"pos",pos:g(...e),moveBy(...e){this.pos=this.pos.add(g(...e))},move(...e){this.moveBy(g(...e).scale(Dt()))},moveTo(...e){if("number"==typeof e[0]&&"number"==typeof e[1])return this.moveTo(g(e[0],e[1]),e[2]);let t=e[0],s=e[1];if(void 0===s)return void(this.pos=g(t));let n=t.sub(this.pos);n.len()<=s*Dt()?this.pos=g(t):this.move(n.unit().scale(s))},worldPos(e=null){return e?(this.pos=this.pos.add(this.fromWorld(e)),null):this.parent?this.parent.transform.multVec2(this.pos):this.pos},toWorld(e){return this.parent?this.parent.transform.multVec2(this.pos.add(e)):this.pos.add(e)},fromWorld(e){return this.parent?this.parent.transform.invert().multVec2(e).sub(this.pos):e.sub(this.pos)},screenPos(e=null){if(e)return this.pos=this.pos.add(this.fromScreen(e)),null;{let e=this.worldPos();return e?Dn(this)?e:Ci(e):null}},toScreen(e){let t=this.toWorld(e);return Dn(this)?t:Ci(t)},fromScreen(e){return Dn(this)?this.fromWorld(e):this.fromWorld(ki(e))},toOther(e,t){return e.fromWorld(this.toWorld(t))},fromOther(e,t){return e.toOther(this,t)},inspect(){return`pos: (${Math.round(this.pos.x)}x, ${Math.round(this.pos.y)}y)`},drawInspect(){ln({color:o(255,0,0),radius:4/ys()})}}}function Qr(e){return{id:"rotate",angle:e??0,rotateBy(e){this.angle+=e},rotateTo(e){this.angle=e},inspect(){return`angle: ${Math.round(this.angle)}`}}}function Wr(...e){if(0===e.length)return Wr(1);let t=g(...e);return{id:"scale",set scale(e){if(!(e instanceof p))throw Error("The scale property on scale is a vector. Use scaleTo or scaleBy to set the scale with a number.");t=g(e)},get scale(){return t},scaleTo(...e){t=g(...e)},scaleBy(...e){t=t.scale(g(...e))},inspect:()=>t.x==t.y?`scale: ${t.x.toFixed(1)}x`:`scale: (${t.x.toFixed(1)}x, ${t.y.toFixed(1)}y)`}}function zr(e){return{id:"z",z:e,inspect(){return`z: ${this.z}`}}}var Zr={k:null,globalOpt:null,gfx:null,game:null,app:null,assets:null,fontCacheCanvas:null,fontCacheC2d:null,debug:null,audio:null,pixelDensity:null,canvas:null,gscale:null,kaSprite:null,boomSprite:null},Jr=(e={tagsAsComponents:!0})=>{Zr.k&&(console.warn("KAPLAY already initialized, you are calling kaplay() multiple times, it may lead bugs!"),Zr.k.quit()),Zr.globalOpt=e;let t=e.root??document.body;t===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let s=e.canvas??t.appendChild(document.createElement("canvas"));Zr.canvas=s;let i=e.scale??1;Zr.gscale=i;let y=e.width&&e.height&&!e.stretch&&!e.letterbox;y?(s.width=e.width*i,s.height=e.height*i):(s.width=s.parentElement.offsetWidth,s.height=s.parentElement.offsetHeight);let A=["outline: none","cursor: default"];if(y){let e=s.width,t=s.height;A.push(`width: ${e}px`),A.push(`height: ${t}px`)}else A.push("width: 100%"),A.push("height: 100%");e.crisp&&(A.push("image-rendering: pixelated"),A.push("image-rendering: crisp-edges")),s.style.cssText=A.join(";");let b=e.pixelDensity||1;Zr.pixelDensity=b,s.width*=b,s.height*=b,s.tabIndex=0;let M=document.createElement("canvas");M.width=256,M.height=256,Zr.fontCacheCanvas=M;let O=M.getContext("2d",{willReadFrequently:!0});Zr.fontCacheC2d=O;let U=Tt({canvas:s,touchToMouse:e.touchToMouse,gamepads:e.gamepads,pixelDensity:e.pixelDensity,maxFPS:e.maxFPS,buttons:e.buttons});Zr.app=U;let H=[],j=U.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});if(!j)throw new Error("WebGL not supported");let V=j,K=function(e,t={}){let s=[],n=null,[i,r]=mn(t=>e.bindTexture(e.TEXTURE_2D,t)),[a,o]=mn(t=>e.bindBuffer(e.ARRAY_BUFFER,t)),[l,h]=mn(t=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t)),[u,d]=mn(t=>e.bindFramebuffer(e.FRAMEBUFFER,t)),[c,f]=mn(t=>e.bindRenderbuffer(e.RENDERBUFFER,t)),[p,g]=mn(t=>{if(!t)return;let{x:s,y:n,w:i,h:r}=t;e.viewport(s,n,i,r)}),[m,w]=mn(t=>e.useProgram(t));return p({x:0,y:0,w:e.drawingBufferWidth,h:e.drawingBufferHeight}),{gl:e,opts:t,onDestroy:function(e){s.push(e)},destroy:function(){s.forEach(e=>e());let t=e.getExtension("WEBGL_lose_context");t&&t.loseContext()},pushTexture2D:i,popTexture2D:r,pushArrayBuffer:a,popArrayBuffer:o,pushElementArrayBuffer:l,popElementArrayBuffer:h,pushFramebuffer:u,popFramebuffer:d,pushRenderbuffer:c,popRenderbuffer:f,pushViewport:p,popViewport:g,pushProgram:m,popProgram:w,setVertexFormat:function(t){if(lt(t,n))return;n=t;let s=t.reduce((e,t)=>e+t.size,0);t.reduce((t,n,i)=>(e.vertexAttribPointer(i,n.size,e.FLOAT,!1,4*s,t),e.enableVertexAttribArray(i),t+4*n.size),0)}}}(V,{texFilter:e.texFilter}),Y=((e,t)=>{let s=zs(t,Ve,Ke),n=e.pixelDensity??1,i=e.scale??1,{gl:r}=t,a=fn.fromImage(t,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),l=e.width&&e.height?new pn(t,e.width*n*i,e.height*n*i):new pn(t,r.drawingBufferWidth,r.drawingBufferHeight),h=null,u=1;e.background&&("string"==typeof e.background?h=o(e.background):(h=o(...e.background),u=e.background[3]??1),r.clearColor(h.r/255,h.g/255,h.b/255,u??1)),r.enable(r.BLEND),r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);let d=new gn(t,Ne,He,12288),c=fn.fromImage(t,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,ggl:t,defShader:s,defTex:a,frameBuffer:l,postShader:null,postShaderUniform:null,renderer:d,transform:new v,transformStack:[],bgTex:c,bgColor:h,bgAlpha:u,width:e.width??r.drawingBufferWidth/n/i,height:e.height??r.drawingBufferHeight/n/i,viewport:{x:0,y:0,width:r.drawingBufferWidth,height:r.drawingBufferHeight,scale:1},fixed:!1}})(e,K);Zr.gfx=Y;let X=(()=>{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createGain();t.connect(e.destination);let s=new $s(e.createBuffer(1,1,44100));return e.decodeAudioData(Gi.buffer.slice(0)).then(e=>{s.buf=e}).catch(e=>{console.error("Failed to load burp: ",e)}),{ctx:e,masterNode:t,burpSnd:s}})();Zr.audio=X;let Q=((e,t)=>({urlPrefix:"",sprites:new Es,fonts:new Es,bitmapFonts:new Es,sounds:new Es,shaders:new Es,custom:new Es,music:{},packer:new vs(e,2048,2048,t),loaded:!1}))(K,e.spriteAtlasPadding??0);Zr.assets=Q;let W={events:new Je,objEvents:new Je,root:Ui([]),gravity:null,scenes:{},currentScene:null,layers:null,defaultLayerIndex:0,logs:[],cam:{pos:null,scale:new p(1),angle:0,shake:0,transform:new v}};function z(){V.clear(V.COLOR_BUFFER_BIT),Y.frameBuffer.bind(),V.clear(V.COLOR_BUFFER_BIT),Y.bgColor||Mn(()=>{xn({width:ms(),height:ws(),quad:new m(0,0,ms()/64,ws()/64),tex:Y.bgTex,fixed:!0})}),Y.renderer.numDraws=0,Y.fixed=!1,Y.transformStack.length=0,Y.transform=new v}function Z(){gs(),Y.lastDrawCalls=Y.renderer.numDraws,Y.frameBuffer.unbind(),V.viewport(0,0,V.drawingBufferWidth,V.drawingBufferHeight);let e=Y.width,t=Y.height;Y.width=V.drawingBufferWidth/b,Y.height=V.drawingBufferHeight/b,Cn({flipY:!0,tex:Y.frameBuffer.tex,pos:new p(Y.viewport.x,Y.viewport.y),width:Y.viewport.width,height:Y.viewport.height,shader:Y.postShader,uniform:"function"==typeof Y.postShaderUniform?Y.postShaderUniform():Y.postShaderUniform,fixed:!0}),gs(),Y.width=e,Y.height=t}Zr.game=W,W.root.use(Ir());let J=!1,_={inspect:!1,set timeScale(e){Zr.app.state.timeScale=e},get timeScale(){return Zr.app.state.timeScale},showLog:!0,fps:()=>U.fps(),numFrames:()=>U.numFrames(),stepFrame:Ge,drawCalls:()=>Y.lastDrawCalls,clearLog:()=>W.logs=[],log:(...t)=>{let s=e.logMax??8,n=t.length>1?t.concat(" ").join(" "):t[0];W.logs.unshift({msg:n,time:U.time()}),W.logs.length>s&&(W.logs=W.logs.slice(0,s))},error:e=>_.log(new Error(e.toString?e.toString():e)),curRecording:null,numObjects:()=>Ie("*",{recursive:!0}).length,get paused(){return J},set paused(e){J=e,e?X.ctx.suspend():X.ctx.resume()}};function ve(e,t){window.localStorage[e]=JSON.stringify(t)}function xe(t,...s){let n,i=t($e);n="function"==typeof i?i(...s)($e):i;for(let r in n)$e[r]=n[r],!1!==e.global&&(window[r]=n[r]);return $e}Zr.debug=_;let be=W.root.add.bind(W.root),Ee=W.root.readd.bind(W.root),Me=W.root.removeAll.bind(W.root),Ie=W.root.get.bind(W.root),Pe=W.root.wait.bind(W.root),Ce=W.root.loop.bind(W.root),ke=W.root.query.bind(W.root),Oe=W.root.tween.bind(W.root),Le=Os(null,"data:image/png;base64,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"),je=Os(null,"data:image/png;base64,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");function Ge(){W.root.update()}Zr.kaSprite=Le,Zr.boomSprite=je;class Ye{constructor(e,t,s,i,r=!1){n(this,"source"),n(this,"target"),n(this,"normal"),n(this,"distance"),n(this,"resolved",!1),this.source=e,this.target=t,this.normal=s,this.distance=i,this.resolved=r}get displacement(){return this.normal.scale(this.distance)}reverse(){return new Ye(this.target,this.source,this.normal.scale(-1),this.distance,this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.cross(W.gravity||g(0,1))>0}isRight(){return this.displacement.cross(W.gravity||g(0,1))<0}isTop(){return this.displacement.dot(W.gravity||g(0,1))>0}isBottom(){return this.displacement.dot(W.gravity||g(0,1))<0}preventResolution(){this.resolved=!0}}function Xe(){if(!(Pr>0))return;let t={},s=e.hashGridSize||64,n=new v,i=[];!function e(r){if(i.push(n.clone()),r.pos&&n.translate(r.pos),r.scale&&n.scale(r.scale),r.angle&&n.rotate(r.angle),r.transform=n.clone(),r.c("area")&&!r.paused){let e=r,n=e.worldArea().bbox(),i=Math.floor(n.pos.x/s),a=Math.floor(n.pos.y/s),o=Math.ceil((n.pos.x+n.width)/s),l=Math.ceil((n.pos.y+n.height)/s),h=new Set;for(let s=i;s<=o;s++)for(let n=a;n<=l;n++)if(t[s])if(t[s][n]){let i=t[s][n];e:for(let t of i){if(t.paused||!t.exists()||h.has(t.id))continue;for(let n of e.collisionIgnore)if(t.is(n))continue e;for(let n of t.collisionIgnore)if(e.is(n))continue e;let s=Re(e.worldArea(),t.worldArea());if(s){let n=new Ye(e,t,s.normal,s.distance);e.trigger("collideUpdate",t,n);let i=n.reverse();i.resolved=n.resolved,t.trigger("collideUpdate",e,i)}h.add(t.id)}i.push(e)}else t[s][n]=[e];else t[s]={},t[s][n]=[e]}r.children.forEach(e),n=i.pop()}(W.root)}function We(e){console.error(e),X.ctx.suspend();let t=e.message??String(e)??"Unknown error, check console for more info";U.run(()=>{},()=>{z(),Mn(()=>{let s=ms(),n=ws(),i={size:36,width:s-64,letterSpacing:4,lineSpacing:4,font:Ue,fixed:!0};En({width:s,height:n,color:o(0,0,255),fixed:!0});let r=vn({...i,text:"Error",pos:g(32),color:o(255,128,0),fixed:!0});bn(r),Tn({...i,text:t,pos:g(32,32+r.height+16),fixed:!0}),ps(),W.events.trigger("error",e)}),Z()})}let _e=!0;U.run(()=>{try{Q.loaded&&(_.paused||W.root.fixedUpdate(),Xe())}catch(e){We(e)}},(t,s)=>{try{t(),Q.loaded||1===Is()&&!_e&&(Q.loaded=!0,Ps().forEach(e=>W.events.trigger("loadError",...e)),W.events.trigger("load")),!Q.loaded&&!1!==e.loadingScreen||_e?(z(),function(){let e=Is();Zr.game.events.numListeners("loading")>0?Zr.game.events.trigger("loading",e):Mn(()=>{let t=ms()/2,s=g(ms()/2,ws()/2).sub(g(t/2,12));En({pos:g(0),width:ms(),height:ws(),color:o(0,0,0)}),En({pos:s,width:t,height:24,fill:!1,outline:{width:4}}),En({pos:s,width:t*e,height:24})})}(),Z()):(_.paused||Ge(),Xe(),z(),function(){let e=Zr.game.cam,t=p.fromAngle(S(0,360)).scale(e.shake);e.shake=d(e.shake,0,5*Dt()),e.transform=(new v).translate(As()).scale(e.scale).rotate(e.angle).translate((e.pos??As()).scale(-1).add(t)),Zr.game.root.draw(),gs()}(),!1!==e.debug&&Bn(),Z()),_e&&(_e=!1),W.events.trigger("frameEnd"),s()}catch(n){We(n)}}),St(),zi();let $e={_k:Zr,VERSION:"3001.0.19",loadRoot:Ss,loadProgress:Is,loadSprite:Os,loadSpriteAtlas:nn,loadSound:tn,loadMusic:sn,loadBitmapFont:Xs,loadFont:Ks,loadShader:Js,loadShaderURL:_s,loadAseprite:Hs,loadPedit:Qs,loadBean:Ns,loadJSON:Bs,load:ks,getSound:en,getFont:Vs,getBitmapFont:Ys,getSprite:Ds,getShader:Zs,getAsset:Cs,Asset:bs,SpriteData:Fs,SoundData:$s,width:ms,height:ws,center:As,dt:Dt,fixedDt:Ot,restDt:Ut,time:U.time,screenshot:U.screenshot,record:function(e){let t=U.canvas.captureStream(e),s=X.ctx.createMediaStreamDestination();X.masterNode.connect(s);let n=new MediaRecorder(t),i=[];return n.ondataavailable=e=>{e.data.size>0&&i.push(e.data)},n.onerror=()=>{X.masterNode.disconnect(s),t.getTracks().forEach(e=>e.stop())},n.start(),{resume(){n.resume()},pause(){n.pause()},stop:()=>(n.stop(),X.masterNode.disconnect(s),t.getTracks().forEach(e=>e.stop()),new Promise(e=>{n.onstop=()=>{e(new Blob(i,{type:"video/mp4"}))}})),download(e="kaboom.mp4"){this.stop().then(t=>at(e,t))}}},isFocused:function(){return document.activeElement===U.canvas},setCursor:U.setCursor,getCursor:U.getCursor,setCursorLocked:U.setCursorLocked,isCursorLocked:U.isCursorLocked,setFullscreen:U.setFullscreen,isFullscreen:U.isFullscreen,isTouchscreen:U.isTouchscreen,onLoad:Ai,onLoadError:vi,onLoading:mi,onResize:wi,onGamepadConnect:U.onGamepadConnect,onGamepadDisconnect:U.onGamepadDisconnect,onError:yi,onCleanup:function(e){H.push(e)},flash:Ri,setCamPos:xi,getCamPos:bi,setCamRot:qi,getCamRot:Si,setCamScale:Ei,getCamScale:Mi,getCamTransform:Bi,camPos:Fi,camScale:Ti,camFlash:Oi,camRot:Di,camTransform:Ii,shake:Pi,toScreen:Ci,toWorld:ki,setGravity:Li,getGravity:Ni,setGravityDirection:Hi,getGravityDirection:ji,setBackground:os,getBackground:ls,getGamepads:U.getGamepads,getTreeRoot:sr,add:be,make:Ui,destroy:tr,destroyAll:Me,get:Ie,query:ke,readd:Ee,pos:Xr,scale:Wr,rotate:Qr,color:Ln,opacity:Gn,anchor:Hr,area:Cr,sprite:or,text:lr,polygon:Xn,rect:Wn,circle:Un,uvquad:hr,outline:Vn,particles:Yn,body:kr,platformEffector:Lr,surfaceEffector:Tr,areaEffector:Dr,pointEffector:Or,buoyancyEffector:Nr,constantForce:Ur,doubleJump:Fr,shader:zn,textInput:Rr,timer:Ir,fixed:jr,stay:Br,health:Er,lifespan:Mr,named:qr,state:Sr,z:zr,layer:Vr,move:Kr,offscreen:Yr,follow:Gr,fadeIn:Hn,mask:jn,drawon:Nn,raycast:Qn,tile:pr,animate:vr,serializeAnimation:xr,agent:ur,sentry:fr,patrol:cr,pathfinder:dr,trigger:_n,on:Jn,onFixedUpdate:$n,onUpdate:ei,onDraw:ti,onAdd:si,onDestroy:ni,onTag:ai,onUntag:oi,onUse:ii,onUnuse:ri,onClick:ci,onCollide:li,onCollideUpdate:hi,onCollideEnd:ui,onHover:fi,onHoverUpdate:pi,onHoverEnd:gi,onKeyDown:U.onKeyDown,onKeyPress:U.onKeyPress,onKeyPressRepeat:U.onKeyPressRepeat,onKeyRelease:U.onKeyRelease,onMouseDown:U.onMouseDown,onMousePress:U.onMousePress,onMouseRelease:U.onMouseRelease,onMouseMove:U.onMouseMove,onCharInput:U.onCharInput,onTouchStart:U.onTouchStart,onTouchMove:U.onTouchMove,onTouchEnd:U.onTouchEnd,onScroll:U.onScroll,onHide:U.onHide,onShow:U.onShow,onGamepadButtonDown:U.onGamepadButtonDown,onGamepadButtonPress:U.onGamepadButtonPress,onGamepadButtonRelease:U.onGamepadButtonRelease,onGamepadStick:U.onGamepadStick,onButtonPress:U.onButtonPress,onButtonDown:U.onButtonDown,onButtonRelease:U.onButtonRelease,mousePos:U.mousePos,mouseDeltaPos:U.mouseDeltaPos,isKeyDown:U.isKeyDown,isKeyPressed:U.isKeyPressed,isKeyPressedRepeat:U.isKeyPressedRepeat,isKeyReleased:U.isKeyReleased,isMouseDown:U.isMouseDown,isMousePressed:U.isMousePressed,isMouseReleased:U.isMouseReleased,isMouseMoved:U.isMouseMoved,isGamepadButtonPressed:U.isGamepadButtonPressed,isGamepadButtonDown:U.isGamepadButtonDown,isGamepadButtonReleased:U.isGamepadButtonReleased,getGamepadStick:U.getGamepadStick,isButtonPressed:U.isButtonPressed,isButtonDown:U.isButtonDown,isButtonReleased:U.isButtonReleased,setButton:U.setButton,getButton:U.getButton,pressButton:U.pressButton,releaseButton:U.releaseButton,getLastInputDeviceType:U.getLastInputDeviceType,charInputted:U.charInputted,loop:Ce,wait:Pe,play:Ki,setVolume:Xi,getVolume:Qi,volume:Wi,burp:Yi,audioCtx:X.ctx,Line:ee,Rect:te,Circle:se,Ellipse:ne,Point:$,Polygon:ie,Vec2:p,Color:a,Mat4:v,Quad:m,RNG:E,rand:S,randi:B,randSeed:q,vec2:g,rgb:o,hsl2rgb:l,quad:w,choose:C,chooseMultiple:P,shuffle:I,chance:R,lerp:d,tween:Oe,easings:es,map:c,mapc:f,wave:x,deg2rad:h,rad2deg:u,clamp:r,evaluateQuadratic:re,evaluateQuadraticFirstDerivative:ae,evaluateQuadraticSecondDerivative:oe,evaluateBezier:le,evaluateBezierFirstDerivative:he,evaluateBezierSecondDerivative:ue,evaluateCatmullRom:de,evaluateCatmullRomFirstDerivative:ce,curveLengthApproximation:pe,normalizedCurve:fe,hermite:ge,cardinal:me,catmullRom:we,bezier:ye,kochanekBartels:Ae,easingSteps:Be,easingLinear:qe,easingCubicBezier:Se,testLineLine:F,testRectRect:k,testRectLine:T,testRectPoint:D,testCirclePolygon:G,testLinePoint:L,testLineCircle:N,isConvex:Te,triangulate:Fe,NavMesh:ns,drawSprite:kn,drawText:Tn,formatText:vn,drawRect:En,drawLine:hn,drawLines:un,drawTriangle:Sn,drawCircle:ln,drawEllipse:on,drawUVQuad:xn,drawPolygon:an,drawCurve:dn,drawBezier:cn,drawFormattedText:bn,drawMasked:Pn,drawSubtracted:Fn,pushTransform:us,popTransform:ps,pushTranslate:hs,pushScale:cs,pushRotate:fs,pushMatrix:ds,usePostEffect:function(e,t){Y.postShader=e,Y.postShaderUniform=t??null},makeCanvas:function(e,t){let s=new pn(K,e,t);return{clear:()=>s.clear(),free:()=>s.free(),toDataURL:()=>s.toDataURL(),toImageData:()=>s.toImageData(),width:s.width,height:s.height,draw:e=>{gs(),s.bind(),e(),gs(),s.unbind()},get fb(){return s}}},debug:_,scene:nr,getSceneName:ar,go:ir,onSceneLeave:rr,layers:er,getLayers:_i,setLayers:Ji,getDefaultLayer:$i,addLevel:Zn,getData:function(e,t){try{return JSON.parse(window.localStorage[e])}catch{return t?(ve(e,t),t):null}},setData:ve,download:nt,downloadJSON:rt,downloadText:it,downloadBlob:at,plug:xe,ASCII_CHARS:De,canvas:U.canvas,addKaboom:Zi,LEFT:p.LEFT,RIGHT:p.RIGHT,UP:p.UP,DOWN:p.DOWN,RED:a.RED,GREEN:a.GREEN,BLUE:a.BLUE,YELLOW:a.YELLOW,MAGENTA:a.MAGENTA,CYAN:a.CYAN,WHITE:a.WHITE,BLACK:a.BLACK,quit:function(){W.events.onOnce("frameEnd",()=>{U.quit(),V.clear(V.COLOR_BUFFER_BIT|V.DEPTH_BUFFER_BIT|V.STENCIL_BUFFER_BIT);let e=V.getParameter(V.MAX_TEXTURE_IMAGE_UNITS);for(let t=0;t<e;t++)V.activeTexture(V.TEXTURE0+t),V.bindTexture(V.TEXTURE_2D,null),V.bindTexture(V.TEXTURE_CUBE_MAP,null);V.bindBuffer(V.ARRAY_BUFFER,null),V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,null),V.bindRenderbuffer(V.RENDERBUFFER,null),V.bindFramebuffer(V.FRAMEBUFFER,null),K.destroy(),H.forEach(e=>e())})},KEvent:Ze,KEventHandler:Je,KEventController:ze,cancel:()=>Qe};Zr.k=$e;let et=e.plugins;if(et&&et.forEach(xe),!1!==e.global)for(let n in $e)window[n]=$e[n];return!1!==e.focus&&U.canvas.focus(),$e},_r=Jr;export{Zr as _k,_r as default,Jr as kaplay};
