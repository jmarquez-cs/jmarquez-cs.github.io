var e,t,n,r,s,o=Object.defineProperty,a=e=>{throw TypeError(e)},i=(e,t,n)=>((e,t,n)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n),l=(e,t,n)=>t.has(e)||a("Cannot "+n),u=(e,t,n)=>(l(e,t,"read from private field"),n?n.call(e):t.get(e)),c=(e,t,n)=>t.has(e)?a("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),d=(e,t,n,r)=>(l(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);import{b as h,r as p,p as m,q as f}from"./scalable-cuckoo-filter.BKNYiDuL.js";import{A as v,a as y,t as g,d as b,p as w}from"./index.BofkdKOa.js";import{d as E,b as L,r as T,f as I,j as A,l as S,C as P,t as x,u as z,v as C,w as N,e as k,m as M,h as $,i as B,k as q,x as D,U as V}from"./message.Ve-2rN-7.js";const U="keep-alive",_=Symbol.for("@libp2p/transport");var R,j;function O(){}(j=R||(R={}))[j.FATAL_ALL=0]="FATAL_ALL",j[j.NO_FATAL=1]="NO_FATAL";class F extends EventTarget{constructor(){super(),c(this,e,new Map)}listenerCount(t){const n=u(this,e).get(t);return null==n?0:n.length}addEventListener(t,n,r){super.addEventListener(t,n,r);let s=u(this,e).get(t);null==s&&(s=[],u(this,e).set(t,s)),s.push({callback:n,once:(!0!==r&&!1!==r&&(null==r?void 0:r.once))??!1})}removeEventListener(t,n,r){super.removeEventListener(t.toString(),n??null,r);let s=u(this,e).get(t);null!=s&&(s=s.filter(({callback:e})=>e!==n),u(this,e).set(t,s))}dispatchEvent(t){const n=super.dispatchEvent(t);let r=u(this,e).get(t.type);return null==r||(r=r.filter(({once:e})=>!e),u(this,e).set(t.type,r)),n}safeDispatchEvent(e,t={}){return this.dispatchEvent(new CustomEvent(e,t))}}function K(e){return null!=e&&"function"==typeof e.start&&"function"==typeof e.stop}async function G(...e){const t=[];for(const n of e)K(n)&&t.push(n);await Promise.all(t.map(async e=>{null!=e.beforeStart&&await e.beforeStart()})),await Promise.all(t.map(async e=>{await e.start()})),await Promise.all(t.map(async e=>{null!=e.afterStart&&await e.afterStart()}))}async function W(...e){const t=[];for(const n of e)K(n)&&t.push(n);await Promise.all(t.map(async e=>{null!=e.beforeStop&&await e.beforeStop()})),await Promise.all(t.map(async e=>{await e.stop()})),await Promise.all(t.map(async e=>{null!=e.afterStop&&await e.afterStop()}))}e=new WeakMap;const Q=Symbol.for("@libp2p/service-capabilities"),H=Symbol.for("@libp2p/service-dependencies");class X extends Error{constructor(e="The operation was aborted",...t){super(e,...t),i(this,"name","AbortError")}}async function Y(e,t,n,r){const s=new X(null==r?void 0:r.errorMessage);null!=(null==r?void 0:r.errorCode)&&(s.code=r.errorCode);const o=(null==r?void 0:r.errorEvent)??"error";return!0===(null==n?void 0:n.aborted)?Promise.reject(s):new Promise((a,i)=>{function l(){Z(n,"abort",d),Z(e,t,u),Z(e,o,c)}const u=e=>{var t;try{if(!1===(null==(t=null==r?void 0:r.filter)?void 0:t.call(r,e)))return}catch(n){return l(),void i(n)}l(),a(e)},c=e=>{l(),e instanceof Error?i(e):i(e.detail??(null==r?void 0:r.error)??new Error(`The "${null==r?void 0:r.errorEvent}" event was emitted but the event had no '.detail' field. Pass an 'error' option to race-event to change this message.`))},d=()=>{l(),i(s)};J(n,"abort",d),J(e,t,u),J(e,o,c)})}function J(e,t,n){null!=e&&(ee(e)?e.addEventListener(t,n):e.addListener(t,n))}function Z(e,t,n){null!=e&&(ee(e)?e.removeEventListener(t,n):e.removeListener(t,n))}function ee(e){return"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}function te(e,t){let n;const r=function(){clearTimeout(n),n=setTimeout(function(){n=void 0,e()},t)};return r.start=()=>{},r.stop=()=>{clearTimeout(n)},r}i(X,"name","AbortError");class ne extends Error{constructor(e="Rate limit exceeded",t){super(e),i(this,"remainingPoints"),i(this,"msBeforeNext"),i(this,"consumedPoints"),i(this,"isFirstInDuration"),this.name="RateLimitError",this.remainingPoints=t.remainingPoints,this.msBeforeNext=t.msBeforeNext,this.consumedPoints=t.consumedPoints,this.isFirstInDuration=t.isFirstInDuration}}class re extends Error{constructor(e="The queue was full"){super(e),this.name="QueueFullError"}}i(re,"name","QueueFullError");class se{constructor(e){var t;i(this,"deferred"),i(this,"signal"),this.signal=e,this.deferred=h(),this.onAbort=this.onAbort.bind(this),null==(t=this.signal)||t.addEventListener("abort",this.onAbort)}onAbort(){var e;this.deferred.reject((null==(e=this.signal)?void 0:e.reason)??new v)}cleanup(){var e;null==(e=this.signal)||e.removeEventListener("abort",this.onAbort)}}class oe{constructor(e,t){i(this,"id"),i(this,"fn"),i(this,"options"),i(this,"recipients"),i(this,"status"),i(this,"timeline"),i(this,"controller"),this.id=`${parseInt(String(1e9*Math.random()),10).toString()}${Date.now()}`,this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((e,t)=>{var n;return e&&!0===(null==(n=t.signal)?void 0:n.aborted)},!0)&&(this.controller.abort(new v),this.cleanup())}async join(e={}){var t;const n=new se(e.signal);return this.recipients.push(n),null==(t=e.signal)||t.addEventListener("abort",this.onAbort),n.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await p(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{var t;e.cleanup(),null==(t=e.signal)||t.removeEventListener("abort",this.onAbort)})}}class ae extends F{constructor(e={}){var t;super(),i(this,"concurrency"),i(this,"maxSize"),i(this,"queue"),i(this,"pending"),i(this,"sort"),this.concurrency=e.concurrency??Number.POSITIVE_INFINITY,this.maxSize=e.maxSize??Number.POSITIVE_INFINITY,this.pending=0,null!=e.metricName&&(null==(t=e.metrics)||t.registerMetricGroup(e.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})})),this.sort=e.sort,this.queue=[],this.emitEmpty=te(this.emitEmpty.bind(this),1),this.emitIdle=te(this.emitIdle.bind(this),1)}emitEmpty(){0===this.size&&this.safeDispatchEvent("empty")}emitIdle(){0===this.running&&this.safeDispatchEvent("idle")}tryToStartAnother(){if(0===this.size)return this.emitEmpty(),0===this.running&&this.emitIdle(),!1;if(this.pending<this.concurrency){let e;for(const t of this.queue)if("queued"===t.status){e=t;break}return null!=e&&(this.safeDispatchEvent("active"),this.pending++,e.run().finally(()=>{for(let t=0;t<this.queue.length;t++)if(this.queue[t]===e){this.queue.splice(t,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(e){this.queue.push(e),null!=this.sort&&this.queue.sort(this.sort)}async add(e,t){var n;if(null==(n=null==t?void 0:t.signal)||n.throwIfAborted(),this.size===this.maxSize)throw new re;const r=new oe(e,t);return this.enqueue(r),this.safeDispatchEvent("add"),this.tryToStartAnother(),r.join(t).then(e=>(this.safeDispatchEvent("completed",{detail:e}),this.safeDispatchEvent("success",{detail:{job:r,result:e}}),e)).catch(e=>{if("queued"===r.status)for(let t=0;t<this.queue.length;t++)if(this.queue[t]===r){this.queue.splice(t,1);break}throw this.safeDispatchEvent("error",{detail:e}),this.safeDispatchEvent("failure",{detail:{job:r,error:e}}),e})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(e=>{e.abort(new v)}),this.clear()}async onEmpty(e){0!==this.size&&await Y(this,"empty",null==e?void 0:e.signal)}async onSizeLessThan(e,t){this.size<e||await Y(this,"next",null==t?void 0:t.signal,{filter:()=>this.size<e})}async onIdle(e){0===this.pending&&0===this.size||await Y(this,"idle",null==e?void 0:e.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(e){var t,n,r;null==(t=null==e?void 0:e.signal)||t.throwIfAborted();const s=m({objectMode:!0}),o=e=>{null!=e?this.abort():this.clear(),s.end(e)},a=e=>{null!=e.detail&&s.push(e.detail)},i=e=>{o(e.detail)},l=()=>{o()},u=()=>{o(new v("Queue aborted"))};this.addEventListener("completed",a),this.addEventListener("error",i),this.addEventListener("idle",l),null==(n=null==e?void 0:e.signal)||n.addEventListener("abort",u);try{yield*s}finally{this.removeEventListener("completed",a),this.removeEventListener("error",i),this.removeEventListener("idle",l),null==(r=null==e?void 0:e.signal)||r.removeEventListener("abort",u),o()}}}class ie extends ae{has(e){return null!=this.find(e)}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}}function le(e){const t=new globalThis.AbortController;function n(){t.abort();for(const t of e)null!=(null==t?void 0:t.removeEventListener)&&t.removeEventListener("abort",n)}for(const s of e){if(!0===(null==s?void 0:s.aborted)){n();break}null!=(null==s?void 0:s.addEventListener)&&s.addEventListener("abort",n)}const r=t.signal;return r.clear=function(){for(const t of e)null!=(null==t?void 0:t.removeEventListener)&&t.removeEventListener("abort",n)},r}class ue extends Error{constructor(){super(...arguments),i(this,"code","ERR_MAX_LENGTH"),i(this,"name","MaxLengthError")}}class ce extends Error{constructor(){super(...arguments),i(this,"code","ERR_MAX_SIZE"),i(this,"name","MaxSizeError")}}function de(e,t){const n={[Symbol.iterator]:()=>n,next:()=>{const n=e.next(),r=n.value;if(!0===n.done||null==r){return{done:!0,value:void 0}}return{done:!1,value:t(r)}}};return n}function he(e){const t=E(L.decode(`z${e}`));return y(t)}class pe{constructor(e){if(i(this,"map"),this.map=new Map,null!=e)for(const[t,n]of e.entries())this.map.set(t.toString(),{key:t,value:n})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return de(this.map.entries(),e=>[e[1].key,e[1].value])}forEach(e){this.map.forEach((t,n)=>{e(t.value,t.key,this)})}get(e){var t;return null==(t=this.map.get(e.toString()))?void 0:t.value}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),{key:e,value:t})}keys(){return de(this.map.values(),e=>e.key)}values(){return de(this.map.values(),e=>e.value)}get size(){return this.map.size}}class me extends pe{constructor(e){super(),i(this,"metric");const{name:t,metrics:n}=e;this.metric=n.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){const t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function fe(e){const{name:t,metrics:n}=e;let r;return r=null!=n?new me({name:t,metrics:n}):new pe,r}class ve extends Error{constructor(){super(...arguments),i(this,"name","InvalidMultiaddrError")}}i(ve,"name","InvalidMultiaddrError");class ye extends Error{constructor(){super(...arguments),i(this,"name","ValidationError")}}i(ye,"name","ValidationError");class ge extends Error{constructor(){super(...arguments),i(this,"name","InvalidParametersError")}}i(ge,"name","InvalidParametersError");class be extends Error{constructor(){super(...arguments),i(this,"name","UnknownProtocolError")}}i(be,"name","UnknownProtocolError");const we=new class{constructor(){i(this,"index",0),i(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,n=e();return void 0===n&&(this.index=t),n}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{const t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&void 0===this.readGivenChar(e)))return n()})}readNumber(e,t,n,r){return this.readAtomically(()=>{let s=0,o=0;const a=this.peekChar();if(void 0===a)return;const i="0"===a,l=2**(8*r)-1;for(;;){const n=this.readAtomically(()=>{const t=this.readChar();if(void 0===t)return;const n=Number.parseInt(t,e);return Number.isNaN(n)?void 0:n});if(void 0===n)break;if(s*=e,s+=n,s>l)return;if(o+=1,void 0!==t&&o>t)return}return 0===o||!n&&i&&o>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(void 0===n)return;e[t]=n}return e})}readIPv6Addr(){const e=e=>{for(let t=0;t<e.length/2;t++){const n=2*t;if(t<e.length-3){const r=this.readSeparator(":",t,()=>this.readIPv4Addr());if(void 0!==r)return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],[n+4,!0]}const r=this.readSeparator(":",t,()=>this.readNumber(16,4,!0,2));if(void 0===r)return[n,!1];e[n]=r>>8,e[n+1]=255&r}return[e.length,!1]};return this.readAtomically(()=>{const t=new Uint8Array(16),[n,r]=e(t);if(16===n)return t;if(r)return;if(void 0===this.readGivenChar(":"))return;if(void 0===this.readGivenChar(":"))return;const s=new Uint8Array(14),o=16-(n+2),[a]=e(s.subarray(0,o));return t.set(s.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};function Ee(e){if(!(e.length>15))return we.new(e).parseWith(()=>we.readIPv4Addr())}function Le(e){if(e.includes("%")&&(e=e.split("%")[0]),!(e.length>45))return we.new(e).parseWith(()=>we.readIPv6Addr())}function Te(e,t=!1){if(e.includes("%")&&(e=e.split("%")[0]),e.length>45)return;const n=we.new(e).parseWith(()=>we.readIPAddr());return n?t&&4===n.length?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,n[0],n[1],n[2],n[3]]):n:void 0}function Ie(e){return Boolean(Ee(e))}function Ae(e){return Boolean(Le(e))}const Se=4,Pe=6,xe=273,ze=41,Ce=42,Ne=53,ke=54,Me=55,$e=56,Be=421,qe=448,De=466,Ve=480,Ue=281,_e=290;function Re(e){return t=>g(t,e)}function je(e){return t=>I(t,e)}function Oe(e){return new DataView(e.buffer).getUint16(e.byteOffset).toString()}function Fe(e){const t=new ArrayBuffer(2);return new DataView(t).setUint16(0,"string"==typeof e?parseInt(e):e),new Uint8Array(t)}function Ke(e){const t=e.subarray(0,e.length-2),n=e.subarray(e.length-2);return`${g(t,"base32")}:${Oe(n)}`}const Ge=function(e){e=e.toString().trim();const t=new Uint8Array(4);return e.split(/\./g).forEach((e,n)=>{const r=parseInt(e,10);if(isNaN(r)||r<0||r>255)throw new ve("Invalid byte value in IP address");t[n]=r}),t};const We=Object.values(T).map(e=>e.decoder),Qe=function(){let e=We[0].or(We[1]);return We.slice(2).forEach(t=>e=e.or(t)),e}();const He=function(...e){return t=>{for(const n of e)n(t)}}(function(e){if(parseInt(e).toString()!==e)throw new ye("Value must be an integer")},function(e){if(e<0)throw new ye("Value must be a positive integer, or zero")},(Xe=65535,e=>{if(e>Xe)throw new ye(`Value must be smaller than or equal to ${Xe}`)}));var Xe;const Ye=-1;const Je=new class{constructor(){i(this,"protocolsByCode",new Map),i(this,"protocolsByName",new Map)}getProtocol(e){let t;if(t="string"==typeof e?this.protocolsByName.get(e):this.protocolsByCode.get(e),null==t)throw new be(`Protocol ${e} was unknown`);return t}addProtocol(e){var t;this.protocolsByCode.set(e.code,e),this.protocolsByName.set(e.name,e),null==(t=e.aliases)||t.forEach(t=>{this.protocolsByName.set(t,e)})}removeProtocol(e){var t;const n=this.protocolsByCode.get(e);null!=n&&(this.protocolsByCode.delete(n.code),this.protocolsByName.delete(n.name),null==(t=n.aliases)||t.forEach(e=>{this.protocolsByName.delete(e)}))}};var Ze;function et(e,t,n){return null==e.size||0===e.size?0:e.size>0?e.size/8:N(t,n)}[{code:4,name:"ip4",size:32,valueToBytes:Ge,bytesToValue:function(e){if(4!==e.byteLength)throw new ve("IPv4 address was incorrect length");const t=[];for(let n=0;n<e.byteLength;n++)t.push(e[n]);return t.join(".")},validate:e=>{if(!Ie(e))throw new ye(`Invalid IPv4 address "${e}"`)}},{code:6,name:"tcp",size:16,valueToBytes:Fe,bytesToValue:Oe,validate:He},{code:xe,name:"udp",size:16,valueToBytes:Fe,bytesToValue:Oe,validate:He},{code:33,name:"dccp",size:16,valueToBytes:Fe,bytesToValue:Oe,validate:He},{code:ze,name:"ip6",size:128,valueToBytes:function(e){let t=0;const n=(e=e.toString().trim()).split(":",8);let r;for(r=0;r<n.length;r++){let e;Ie(n[r])&&(e=Ge(n[r]),n[r]=g(e.subarray(0,2),"base16")),null!=e&&++r<8&&n.splice(r,0,g(e.subarray(2,4),"base16"))}if(""===n[0])for(;n.length<8;)n.unshift("0");else if(""===n[n.length-1])for(;n.length<8;)n.push("0");else if(n.length<8){for(r=0;r<n.length&&""!==n[r];r++);const e=[r,1];for(r=9-n.length;r>0;r--)e.push("0");n.splice.apply(n,e)}const s=new Uint8Array(t+16);for(r=0;r<n.length;r++){""===n[r]&&(n[r]="0");const e=parseInt(n[r],16);if(isNaN(e)||e<0||e>65535)throw new ve("Invalid byte value in IP address");s[t++]=e>>8&255,s[t++]=255&e}return s},bytesToValue:function(e){if(16!==e.byteLength)throw new ve("IPv6 address was incorrect length");const t=[];for(let r=0;r<e.byteLength;r+=2){const n=e[r],s=e[r+1],o=`${n.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`;t.push(o)}const n=t.join(":");try{const e=new URL(`http://[${n}]`);return e.hostname.substring(1,e.hostname.length-1)}catch{throw new ve(`Invalid IPv6 address "${n}"`)}},stringToValue:function(e){try{const t=new URL(`http://[${e}]`);return t.hostname.substring(1,t.hostname.length-1)}catch{throw new ve(`Invalid IPv6 address "${e}"`)}},validate:e=>{if(!Ae(e))throw new ye(`Invalid IPv6 address "${e}"`)}},{code:42,name:"ip6zone",size:Ye},{code:43,name:"ipcidr",size:8,bytesToValue:Re("base10"),valueToBytes:je("base10")},{code:53,name:"dns",size:Ye,resolvable:!0},{code:54,name:"dns4",size:Ye,resolvable:!0},{code:55,name:"dns6",size:Ye,resolvable:!0},{code:56,name:"dnsaddr",size:Ye,resolvable:!0},{code:132,name:"sctp",size:16,valueToBytes:Fe,bytesToValue:Oe,validate:He},{code:301,name:"udt"},{code:302,name:"utp"},{code:400,name:"unix",size:Ye,path:!0,stringToValue:e=>decodeURIComponent(e),valueToString:e=>encodeURIComponent(e)},{code:Be,name:"p2p",aliases:["ipfs"],size:Ye,bytesToValue:Re("base58btc"),valueToBytes:e=>e.startsWith("Q")||e.startsWith("1")?je("base58btc")(e):P.parse(e).multihash.bytes},{code:444,name:"onion",size:96,bytesToValue:Ke,valueToBytes:function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(16!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);const n=I(t[0],"base32"),r=parseInt(t[1],10);if(r<1||r>65536)throw new Error("Port number is not in range(1, 65536)");const s=Fe(r);return A([n,s],n.length+s.length)}},{code:445,name:"onion3",size:296,bytesToValue:Ke,valueToBytes:function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(56!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);const n=S.decode(`b${t[0]}`),r=parseInt(t[1],10);if(r<1||r>65536)throw new Error("Port number is not in range(1, 65536)");const s=Fe(r);return A([n,s],n.length+s.length)}},{code:446,name:"garlic64",size:Ye},{code:447,name:"garlic32",size:Ye},{code:qe,name:"tls"},{code:449,name:"sni",size:Ye},{code:454,name:"noise"},{code:460,name:"quic"},{code:461,name:"quic-v1"},{code:465,name:"webtransport"},{code:De,name:"certhash",size:Ye,bytesToValue:(Ze=x,e=>Ze.encoder.encode(e)),valueToBytes:function(e){return Qe.decode(e)}},{code:Ve,name:"http"},{code:481,name:"http-path",size:Ye,stringToValue:e=>`/${decodeURIComponent(e)}`,valueToString:e=>encodeURIComponent(e.substring(1))},{code:443,name:"https"},{code:477,name:"ws"},{code:478,name:"wss"},{code:479,name:"p2p-websocket-star"},{code:277,name:"p2p-stardust"},{code:275,name:"p2p-webrtc-star"},{code:276,name:"p2p-webrtc-direct"},{code:280,name:"webrtc-direct"},{code:Ue,name:"webrtc"},{code:_e,name:"p2p-circuit"},{code:777,name:"memory",size:Ye}].forEach(e=>{Je.addProtocol(e)});const tt=Symbol.for("nodejs.util.inspect.custom"),nt=Symbol.for("@multiformats/multiaddr"),rt=[53,54,55,56];class st extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}}function ot(e){if(null==e&&(e="/"),ut(e))return e.getComponents();if(e instanceof Uint8Array)return function(e){var t;const n=[];let r=0;for(;r<e.length;){const s=N(e,r),o=Je.getProtocol(s),a=z(s),i=et(o,e,r+a);let l=0;i>0&&o.size===Ye&&(l=z(i));const u=a+l+i,c={code:s,name:o.name,bytes:e.subarray(r,r+u)};if(i>0){const n=r+a+l,s=e.subarray(n,n+i);c.value=(null==(t=o.bytesToValue)?void 0:t.call(o,s))??g(s)}n.push(c),r+=u}return n}(e);if("string"==typeof e)return""===(e=e.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""))&&(e="/"),function(e){var t;if("/"!==e.charAt(0))throw new ve('String multiaddr must start with "/"');const n=[];let r="protocol",s="",o="";for(let a=1;a<e.length;a++){const i=e.charAt(a);"/"!==i&&("protocol"===r?o+=e.charAt(a):s+=e.charAt(a));const l=a===e.length-1;if("/"===i||l){const e=Je.getProtocol(o);if("protocol"===r){if(null==e.size||0===e.size){n.push({code:e.code,name:e.name}),s="",o="",r="protocol";continue}if(l)throw new ve(`Component ${o} was missing value`);r="value"}else if("value"===r){const a={code:e.code,name:e.name};if(null!=e.size&&0!==e.size){if(""===s)throw new ve(`Component ${o} was missing value`);a.value=(null==(t=e.stringToValue)?void 0:t.call(e,s))??s}n.push(a),s="",o="",r="protocol"}}}if(""!==o&&""!==s)throw new ve("Incomplete multiaddr");return n}(e);if(Array.isArray(e))return e;throw new ve("Must be a string, Uint8Array, Component[], or another Multiaddr")}const at=class e{constructor(e="/",o={}){i(this,t,!0),c(this,n),c(this,r),c(this,s),d(this,n,ot(e)),!1!==o.validate&&function(e){e.getComponents().forEach(e=>{var t;const n=Je.getProtocol(e.code);null!=e.value&&(null==(t=n.validate)||t.call(n,e.value))})}(this)}get bytes(){return null==u(this,s)&&d(this,s,function(e){var t;let n=0;const r=[];for(const s of e){if(null==s.bytes){const e=Je.getProtocol(s.code),n=z(s.code);let r,o=0,a=0;null!=s.value&&(r=(null==(t=e.valueToBytes)?void 0:t.call(e,s.value))??I(s.value),o=r.byteLength,e.size===Ye&&(a=z(o)));const i=new Uint8Array(n+a+o);let l=0;C(s.code,i,l),l+=n,null!=r&&(e.size===Ye&&(C(o,i,l),l+=a),i.set(r,l)),s.bytes=i}r.push(s.bytes),n+=s.bytes.byteLength}return A(r,n)}(u(this,n))),u(this,s)}toString(){return null==u(this,r)&&d(this,r,`/${u(this,n).flatMap(e=>{var t;if(null==e.value)return e.name;const n=Je.getProtocol(e.code);if(null==n)throw new ve(`Unknown protocol code ${e.code}`);return[e.name,(null==(t=n.valueToString)?void 0:t.call(n,e.value))??e.value]}).join("/")}`),u(this,r)}toJSON(){return this.toString()}toOptions(){let e,t,r,s,o="";for(const{code:a,name:i,value:l}of u(this,n))42===a&&(o=`%${l??""}`),rt.includes(a)&&(t="tcp",s=443,r=`${l??""}${o}`,e=55===a?6:4),6!==a&&a!==xe||(t="tcp"===i?"tcp":"udp",s=parseInt(l??"")),4!==a&&a!==ze||(t="tcp",r=`${l??""}${o}`,e=a===ze?6:4);if(null==e||null==t||null==r||null==s)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:r,transport:t,port:s}}getComponents(){return[...u(this,n)]}protos(){return u(this,n).map(({code:e,value:t})=>{const n=Je.getProtocol(e);return{code:e,size:n.size??0,name:n.name,resolvable:Boolean(n.resolvable),path:Boolean(n.path)}})}protoCodes(){return u(this,n).map(({code:e})=>e)}protoNames(){return u(this,n).map(({name:e})=>e)}tuples(){return u(this,n).map(({code:e,value:t})=>{var n;if(null==t)return[e];const r=Je.getProtocol(e),s=[e];return null!=t&&s.push((null==(n=r.valueToBytes)?void 0:n.call(r,t))??I(t)),s})}stringTuples(){return u(this,n).map(({code:e,value:t})=>null==t?[e]:[e,t])}encapsulate(t){const r=new e(t);return new e([...u(this,n),...r.getComponents()],{validate:!1})}decapsulate(t){const n=t.toString(),r=this.toString(),s=r.lastIndexOf(n);if(s<0)throw new ge(`Address ${this.toString()} does not contain subaddress: ${t.toString()}`);return new e(r.slice(0,s),{validate:!1})}decapsulateCode(t){let r;for(let e=u(this,n).length-1;e>-1;e--)if(u(this,n)[e].code===t){r=e;break}return new e(u(this,n).slice(0,r),{validate:!1})}getPeerId(){try{let e=[];u(this,n).forEach(({code:t,value:n})=>{t===Be&&e.push([t,n]),t===_e&&(e=[])});const t=e.pop();if(null!=(null==t?void 0:t[1])){const e=t[1];return"Q"===e[0]||"1"===e[0]?g(L.decode(`z${e}`),"base58btc"):g(P.parse(e).multihash.bytes,"base58btc")}return null}catch(e){return null}}getPath(){for(const e of u(this,n)){if(Je.getProtocol(e.code).path)return e.value??null}return null}equals(e){return k(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(e=>e.resolvable);if(null==t)return[this];const n=lt.get(t.name);if(null==n)throw new st(`no available resolver for ${t.name}`);return(await n(this,e)).map(e=>ct(e))}nodeAddress(){const e=this.toOptions();if("tcp"!==e.transport&&"udp"!==e.transport)throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(){return 2===u(this,n).length&&((4===u(this,n)[0].code||u(this,n)[0].code===ze)&&(6===u(this,n)[1].code||u(this,n)[1].code===xe))}[(t=nt,tt)](){return`Multiaddr(${this.toString()})`}};n=new WeakMap,r=new WeakMap,s=new WeakMap;let it=at;const lt=new Map;function ut(e){return Boolean(null==e?void 0:e[nt])}function ct(e){return new it(e)}function dt(e){const t=Je.getProtocol(e);return{code:t.code,size:t.size??0,name:t.name,resolvable:Boolean(t.resolvable),path:Boolean(t.path)}}const ht=e=>({match:t=>{const n=t[0];return null!=n&&(n.code===e&&(null==n.value&&t.slice(1)))}}),pt=(e,t)=>({match:n=>{const r=n[0];return(null==r?void 0:r.code)===e&&(null!=r.value&&((null==t||r.value===t)&&n.slice(1)))}}),mt=e=>({match:t=>{const n=e.match(t);return!1===n?t:n}}),ft=(...e)=>({match:t=>{let n;for(const r of e){const e=r.match(t);!1!==e&&((null==n||e.length<n.length)&&(n=e))}return null!=n&&n}}),vt=(...e)=>({match:t=>{for(const n of e){const e=n.match(t);if(!1===e)return!1;t=e}return t}});function yt(...e){function t(t){if(null==t)return!1;let n=t.getComponents();for(const r of e){const e=r.match(n);if(!1===e)return!1;n=e}return n}return{matchers:e,matches:function(e){return!1!==t(e)},exactMatch:function(e){const n=t(e);return!1!==n&&0===n.length}}}const gt=yt(pt(Be)),bt=pt(54),wt=pt(55),Et=pt(56),Lt=pt(53);yt(bt,mt(pt(Be))),yt(wt,mt(pt(Be))),yt(Et,mt(pt(Be)));const Tt=yt(ft(Lt,Et,bt,wt),mt(pt(Be))),It=vt(pt(4),mt(pt(43))),At=vt(mt(pt(42)),pt(ze),mt(pt(43))),St=ft(It,At),Pt=ft(St,Lt,bt,wt,Et);yt(ft(St,vt(ft(Lt,Et,bt,wt),mt(pt(Be)))));const xt=yt(It),zt=yt(At),Ct=yt(St),Nt=vt(Pt,pt(6)),kt=vt(Pt,pt(xe)),Mt=yt(vt(Nt,mt(pt(Be))));yt(kt);const $t=vt(kt,ht(460),mt(pt(Be))),Bt=vt(kt,ht(461),mt(pt(Be))),qt=ft($t,Bt);yt($t);const Dt=yt(Bt),Vt=ft(Pt,Nt,kt,$t,Bt),Ut=ft(vt(Vt,ht(477),mt(pt(Be)))),_t=yt(Ut),Rt=ft(vt(Vt,ht(478),mt(pt(Be))),vt(Vt,ht(qe),mt(pt(449)),ht(477),mt(pt(Be)))),jt=yt(Rt),Ot=vt(kt,ht(280),mt(pt(De)),mt(pt(De)),mt(pt(Be))),Ft=yt(Ot),Kt=vt(Bt,ht(465),mt(pt(De)),mt(pt(De)),mt(pt(Be))),Gt=yt(Kt),Wt=ft(Ut,Rt,vt(Nt,mt(pt(Be))),vt(qt,mt(pt(Be))),vt(Pt,mt(pt(Be))),Ot,Kt,pt(Be)),Qt=yt(Wt),Ht=yt(vt(Wt,ht(_e),pt(Be))),Xt=yt(ft(vt(Wt,ht(_e),ht(Ue),mt(pt(Be))),vt(Wt,ht(Ue),mt(pt(Be))),vt(ht(Ue),mt(pt(Be))))),Yt=yt(ft(vt(Pt,pt(6),ht(Ve),mt(pt(Be))),vt(Pt,ht(Ve),mt(pt(Be))))),Jt=yt(vt(Pt,ft(vt(pt(6,"443"),ht(Ve)),vt(pt(6),ht(443)),vt(pt(6),ht(qe),ht(Ve)),vt(ht(qe),ht(Ve)),ht(qe),ht(443)),mt(pt(Be))));yt(ft(vt(pt(777),mt(pt(Be)))));var Zt;yt(ft(vt(pt(400),mt(pt(Be))))),function(e){let t;e.codec=()=>(null==t&&(t=M((e,t,n={})=>{!1!==n.lengthDelimited&&t.fork(),null!=e.publicKey&&e.publicKey.byteLength>0&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.payloadType&&e.payloadType.byteLength>0&&(t.uint32(18),t.bytes(e.payloadType)),null!=e.payload&&e.payload.byteLength>0&&(t.uint32(26),t.bytes(e.payload)),null!=e.signature&&e.signature.byteLength>0&&(t.uint32(42),t.bytes(e.signature)),!1!==n.lengthDelimited&&t.ldelim()},(e,t,n={})=>{const r={publicKey:q(0),payloadType:q(0),payload:q(0),signature:q(0)},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:r.publicKey=e.bytes();break;case 2:r.payloadType=e.bytes();break;case 3:r.payload=e.bytes();break;case 5:r.signature=e.bytes();break;default:e.skipType(7&t)}}return r})),t),e.encode=t=>$(t,e.codec()),e.decode=(t,n)=>B(t,e.codec(),n)}(Zt||(Zt={}));class en extends Error{constructor(e="Invalid signature"){super(e),this.name="InvalidSignatureError"}}const tn=class{constructor(e){i(this,"publicKey"),i(this,"payloadType"),i(this,"payload"),i(this,"signature"),i(this,"marshaled");const{publicKey:t,payloadType:n,payload:r,signature:s}=e;this.publicKey=t,this.payloadType=n,this.payload=r,this.signature=s}marshal(){return null==this.marshaled&&(this.marshaled=Zt.encode({publicKey:w(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return null!=e&&k(this.marshal(),e.marshal())}async validate(e,t){const n=rn(e,this.payloadType,this.payload);return this.publicKey.verify(n.subarray(),this.signature,t)}};i(tn,"createFromProtobuf",e=>{const t=Zt.decode(e),n=b(t.publicKey);return new tn({publicKey:n,payloadType:t.payloadType,payload:t.payload,signature:t.signature})}),i(tn,"seal",async(e,t,n)=>{if(null==t)throw new Error("Missing private key");const r=e.domain,s=e.codec,o=e.marshal(),a=rn(r,s,o),i=await t.sign(a.subarray(),n);return new tn({publicKey:t.publicKey,payloadType:s,payload:o,signature:i})}),i(tn,"openAndCertify",async(e,t,n)=>{const r=tn.createFromProtobuf(e);if(!(await r.validate(t,n)))throw new en("Envelope signature is not valid for the given domain");return r});let nn=tn;const rn=(e,t,n)=>{const r=I(e),s=D(r.byteLength),o=D(t.length),a=D(n.length);return new V(s,r,o,t,a,n)};class sn extends Error{constructor(){super(...arguments),i(this,"name","UnexpectedEOFError"),i(this,"code","ERR_UNEXPECTED_EOF")}}function on(e,t){const n=f();e.sink(n).catch(async e=>{await n.end(e)}),e.sink=async e=>{for await(const t of e)await n.push(t);await n.end()};let r=e.source;null!=e.source[Symbol.iterator]?r=e.source[Symbol.iterator]():null!=e.source[Symbol.asyncIterator]&&(r=e.source[Symbol.asyncIterator]());const s=new V;return{read:async e=>{var t;if(null==(t=null==e?void 0:e.signal)||t.throwIfAborted(),null==(null==e?void 0:e.bytes)){const{done:t,value:n}=await p(r.next(),null==e?void 0:e.signal);return!0===t?null:n}for(;s.byteLength<e.bytes;){const{value:t,done:n}=await p(r.next(),null==e?void 0:e.signal);if(!0===n)throw new sn("unexpected end of input");s.append(t)}const n=s.sublist(0,e.bytes);return s.consume(e.bytes),n},write:async(e,t)=>{var r;null==(r=null==t?void 0:t.signal)||r.throwIfAborted(),e instanceof Uint8Array?await n.push(e,t):await n.push(e.subarray(),t)},unwrap:()=>{if(s.byteLength>0){const n=e.source;e.source=async function*(){!1===(null==t?void 0:t.yieldBytes)?yield s:yield*s,yield*n}()}return e}}}class an extends Error{constructor(){super(...arguments),i(this,"name","InvalidMessageLengthError"),i(this,"code","ERR_INVALID_MSG_LENGTH")}}class ln extends Error{constructor(){super(...arguments),i(this,"name","InvalidDataLengthError"),i(this,"code","ERR_MSG_DATA_TOO_LONG")}}class un extends Error{constructor(){super(...arguments),i(this,"name","InvalidDataLengthLengthError"),i(this,"code","ERR_MSG_LENGTH_TOO_LONG")}}function cn(e,t={}){const n=on(e,t);null!=t.maxDataLength&&null==t.maxLengthLength&&(t.maxLengthLength=z(t.maxDataLength));const r=(null==t?void 0:t.lengthDecoder)??N,s=(null==t?void 0:t.lengthEncoder)??D;return{read:async e=>{let s=-1;const o=new V;for(;;){o.append(await n.read({...e,bytes:1}));try{s=r(o)}catch(a){if(a instanceof RangeError)continue;throw a}if(s<0)throw new an("Invalid message length");if(null!=(null==t?void 0:t.maxLengthLength)&&o.byteLength>t.maxLengthLength)throw new un("message length length too long");if(s>-1)break}if(null!=(null==t?void 0:t.maxDataLength)&&s>t.maxDataLength)throw new ln("message length too long");return n.read({...e,bytes:s})},write:async(e,t)=>{await n.write(new V(s(e.byteLength),e),t)},writeV:async(e,t)=>{const r=new V(...e.flatMap(e=>[s(e.byteLength),e]));await n.write(r,t)},unwrap:()=>n.unwrap()}}export{Gt as $,X as A,dt as B,_e as C,Ce as D,Se as E,R as F,ze as G,Ne as H,ke as I,Me as J,U as K,$e as L,ue as M,te as N,jt as O,Qt as P,Mt as Q,nn as R,Dt as S,F as T,K as U,ne as V,_t as W,gt as X,ae as Y,Xt as Z,Ft as _,le as a,on as a0,xt as a1,zt as a2,Pe as a3,qe as a4,Jt as a5,Yt as a6,Tt as a7,Ct as a8,vt as b,ht as c,ie as d,pe as e,yt as f,Ht as g,Q as h,H as i,_ as j,G as k,cn as l,ct as m,W as n,de as o,he as p,Te as q,Y as r,O as s,fe as t,Ee as u,Le as v,Ie as w,Ae as x,ce as y,ut as z};
