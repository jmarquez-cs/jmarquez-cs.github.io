const e=["string","number","bigint","symbol"],n=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function t(t){if(null===t)return"null";if(void 0===t)return"undefined";if(!0===t||!1===t)return"boolean";const r=typeof t;if(e.includes(r))return r;if("function"===r)return"Function";if(Array.isArray(t))return"Array";if(function(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}(t))return"Buffer";const o=function(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(n.includes(t))return t;return}(t);return o||"Object"}class r{constructor(e,n,t){this.major=e,this.majorEncoded=e<<5,this.name=n,this.terminal=t}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}r.uint=new r(0,"uint",!0),r.negint=new r(1,"negint",!0),r.bytes=new r(2,"bytes",!0),r.string=new r(3,"string",!0),r.array=new r(4,"array",!1),r.map=new r(5,"map",!1),r.tag=new r(6,"tag",!1),r.float=new r(7,"float",!0),r.false=new r(7,"false",!0),r.true=new r(7,"true",!0),r.null=new r(7,"null",!0),r.undefined=new r(7,"undefined",!0),r.break=new r(7,"break",!0);class o{constructor(e,n,t){this.type=e,this.value=n,this.encodedLength=t,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const i=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,u=new TextDecoder,s=new TextEncoder;function a(e){return i&&globalThis.Buffer.isBuffer(e)}function c(e){return e instanceof Uint8Array?a(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}const f=i?(e,n,t)=>t-n>64?globalThis.Buffer.from(e.subarray(n,t)).toString("utf8"):y(e,n,t):(e,n,t)=>t-n>64?u.decode(e.subarray(n,t)):y(e,n,t),l=i?e=>e.length>64?globalThis.Buffer.from(e):p(e):e=>e.length>64?s.encode(e):p(e),h=e=>Uint8Array.from(e),d=i?(e,n,t)=>a(e)?new Uint8Array(e.subarray(n,t)):e.slice(n,t):(e,n,t)=>e.slice(n,t),g=i?(e,n)=>(e=e.map(e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e)),c(globalThis.Buffer.concat(e,n))):(e,n)=>{const t=new Uint8Array(n);let r=0;for(let o of e)r+o.length>t.length&&(o=o.subarray(0,t.length-r)),t.set(o,r),r+=o.length;return t},w=i?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function p(e){const n=[];let t=0;for(let r=0;r<e.length;r++){let o=e.charCodeAt(r);o<128?n[t++]=o:o<2048?(n[t++]=o>>6|192,n[t++]=63&o|128):55296==(64512&o)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(o=65536+((1023&o)<<10)+(1023&e.charCodeAt(++r)),n[t++]=o>>18|240,n[t++]=o>>12&63|128,n[t++]=o>>6&63|128,n[t++]=63&o|128):(n[t++]=o>>12|224,n[t++]=o>>6&63|128,n[t++]=63&o|128)}return n}function y(e,n,t){const r=[];for(;n<t;){const o=e[n];let i=null,u=o>239?4:o>223?3:o>191?2:1;if(n+u<=t){let t,r,s,a;switch(u){case 1:o<128&&(i=o);break;case 2:t=e[n+1],128==(192&t)&&(a=(31&o)<<6|63&t,a>127&&(i=a));break;case 3:t=e[n+1],r=e[n+2],128==(192&t)&&128==(192&r)&&(a=(15&o)<<12|(63&t)<<6|63&r,a>2047&&(a<55296||a>57343)&&(i=a));break;case 4:t=e[n+1],r=e[n+2],s=e[n+3],128==(192&t)&&128==(192&r)&&128==(192&s)&&(a=(15&o)<<18|(63&t)<<12|(63&r)<<6|63&s,a>65535&&a<1114112&&(i=a))}}null===i?(i=65533,u=1):i>65535&&(i-=65536,r.push(i>>>10&1023|55296),i=56320|1023&i),r.push(i),n+=u}return b(r)}const m=4096;function b(e){const n=e.length;if(n<=m)return String.fromCharCode.apply(String,e);let t="",r=0;for(;r<n;)t+=String.fromCharCode.apply(String,e.slice(r,r+=m));return t}class k{constructor(e=256){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let n=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const t=n.length-(this.maxCursor-this.cursor)-1;n.set(e,t)}else{if(n){const e=n.length-(this.maxCursor-this.cursor)-1;e<n.length&&(this.chunks[this.chunks.length-1]=n.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(n=w(this.chunkSize),this.chunks.push(n),this.maxCursor+=n.length,null===this._initReuseChunk&&(this._initReuseChunk=n),n.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let n;if(1===this.chunks.length){const t=this.chunks[0];e&&this.cursor>t.length/2?(n=this.cursor===t.length?t:t.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):n=d(t,0,this.cursor)}else n=g(this.chunks,this.cursor);return e&&this.reset(),n}}const v="CBOR decode error:",E="CBOR encode error:";function A(e,n,t){if(e.length-n<t)throw new Error(`${v} not enough data for type`)}const $=[24,256,65536,4294967296,BigInt("18446744073709551616")];function B(e,n,t){A(e,n,1);const r=e[n];if(!0===t.strict&&r<$[0])throw new Error(`${v} integer encoded in more bytes than necessary (strict decode)`);return r}function j(e,n,t){A(e,n,2);const r=e[n]<<8|e[n+1];if(!0===t.strict&&r<$[1])throw new Error(`${v} integer encoded in more bytes than necessary (strict decode)`);return r}function N(e,n,t){A(e,n,4);const r=16777216*e[n]+(e[n+1]<<16)+(e[n+2]<<8)+e[n+3];if(!0===t.strict&&r<$[2])throw new Error(`${v} integer encoded in more bytes than necessary (strict decode)`);return r}function S(e,n,t){A(e,n,8);const r=16777216*e[n]+(e[n+1]<<16)+(e[n+2]<<8)+e[n+3],o=16777216*e[n+4]+(e[n+5]<<16)+(e[n+6]<<8)+e[n+7],i=(BigInt(r)<<BigInt(32))+BigInt(o);if(!0===t.strict&&i<$[3])throw new Error(`${v} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(!0===t.allowBigInt)return i;throw new Error(`${v} integers outside of the safe integer range are not supported`)}function U(e,n){return T(e,0,n.value)}function T(e,n,t){if(t<$[0]){const r=Number(t);e.push([n|r])}else if(t<$[1]){const r=Number(t);e.push([24|n,r])}else if(t<$[2]){const r=Number(t);e.push([25|n,r>>>8,255&r])}else if(t<$[3]){const r=Number(t);e.push([26|n,r>>>24&255,r>>>16&255,r>>>8&255,255&r])}else{const r=BigInt(t);if(!(r<$[4]))throw new Error(`${v} encountered BigInt larger than allowable range`);{const t=[27|n,0,0,0,0,0,0,0];let o=Number(r&BigInt(4294967295)),i=Number(r>>BigInt(32)&BigInt(4294967295));t[8]=255&o,o>>=8,t[7]=255&o,o>>=8,t[6]=255&o,o>>=8,t[5]=255&o,t[4]=255&i,i>>=8,t[3]=255&i,i>>=8,t[2]=255&i,i>>=8,t[1]=255&i,e.push(t)}}}U.encodedSize=function(e){return T.encodedSize(e.value)},T.encodedSize=function(e){return e<$[0]?1:e<$[1]?2:e<$[2]?3:e<$[3]?5:9},U.compareTokens=function(e,n){return e.value<n.value?-1:e.value>n.value?1:0};const I=BigInt(-1),C=BigInt(1);function x(e,n){const t=n.value,r="bigint"==typeof t?t*I-C:-1*t-1;T(e,n.type.majorEncoded,r)}function z(e,n,t,i){A(e,n,t+i);const u=d(e,n+t,n+t+i);return new o(r.bytes,u,t+i)}function O(e,n,t,r){return z(e,n,1,t)}function _(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===r.string?l(e.value):e.value),e.encodedBytes}function F(e,n){const t=_(n);T(e,n.type.majorEncoded,t.length),e.push(t)}function R(e,n,t,i,u){const s=t+i;A(e,n,s);const a=new o(r.string,f(e,n+t,n+s),s);return!0===u.retainStringBytes&&(a.byteValue=d(e,n+t,n+s)),a}function M(e,n,t,r){return R(e,n,1,t,r)}x.encodedSize=function(e){const n=e.value,t="bigint"==typeof n?n*I-C:-1*n-1;return t<$[0]?1:t<$[1]?2:t<$[2]?3:t<$[3]?5:9},x.compareTokens=function(e,n){return e.value<n.value?1:e.value>n.value?-1:0},F.encodedSize=function(e){const n=_(e);return T.encodedSize(n.length)+n.length},F.compareTokens=function(e,n){return t=_(e),r=_(n),t.length<r.length?-1:t.length>r.length?1:function(e,n){if(a(e)&&a(n))return e.compare(n);for(let t=0;t<e.length;t++)if(e[t]!==n[t])return e[t]<n[t]?-1:1;return 0}(t,r);var t,r};const D=F;function V(e,n,t,i){return new o(r.array,i,t)}function G(e,n,t,r){return V(0,0,1,t)}function L(e,n){T(e,r.array.majorEncoded,n.value)}function q(e,n,t,i){return new o(r.map,i,t)}function W(e,n,t,r){return q(0,0,1,t)}function K(e,n){T(e,r.map.majorEncoded,n.value)}function H(e,n,t,i){return new o(r.tag,t,1)}function P(e,n){T(e,r.tag.majorEncoded,n.value)}L.compareTokens=U.compareTokens,L.encodedSize=function(e){return T.encodedSize(e.value)},K.compareTokens=U.compareTokens,K.encodedSize=function(e){return T.encodedSize(e.value)},P.compareTokens=U.compareTokens,P.encodedSize=function(e){return T.encodedSize(e.value)};function X(e,n,t){if(t){if(!1===t.allowNaN&&Number.isNaN(e))throw new Error(`${v} NaN values are not supported`);if(!1===t.allowInfinity&&(e===1/0||e===-1/0))throw new Error(`${v} Infinity values are not supported`)}return new o(r.float,e,n)}function J(e,n,t){const o=n.value;if(!1===o)e.push([20|r.float.majorEncoded]);else if(!0===o)e.push([21|r.float.majorEncoded]);else if(null===o)e.push([22|r.float.majorEncoded]);else if(void 0===o)e.push([23|r.float.majorEncoded]);else{let n,r=!1;t&&!0===t.float64||(ee(o),n=ne(Z,1),o===n||Number.isNaN(o)?(Z[0]=249,e.push(Z.slice(0,3)),r=!0):(te(o),n=re(Z,1),o===n&&(Z[0]=250,e.push(Z.slice(0,5)),r=!0))),r||(i=o,Y.setFloat64(0,i,!1),n=oe(Z,1),Z[0]=251,e.push(Z.slice(0,9)))}var i}J.encodedSize=function(e,n){const t=e.value;if(!1===t||!0===t||null==t)return 1;if(!n||!0!==n.float64){ee(t);let e=ne(Z,1);if(t===e||Number.isNaN(t))return 3;if(te(t),e=re(Z,1),t===e)return 5}return 9};const Q=new ArrayBuffer(9),Y=new DataView(Q,1),Z=new Uint8Array(Q,0);function ee(e){if(e===1/0)Y.setUint16(0,31744,!1);else if(e===-1/0)Y.setUint16(0,64512,!1);else if(Number.isNaN(e))Y.setUint16(0,32256,!1);else{Y.setFloat32(0,e);const n=Y.getUint32(0),t=(2139095040&n)>>23,r=8388607&n;if(255===t)Y.setUint16(0,31744,!1);else if(0===t)Y.setUint16(0,(2147483648&e)>>16|r>>13,!1);else{const e=t-127;e<-24?Y.setUint16(0,0):e<-14?Y.setUint16(0,(2147483648&n)>>16|1<<24+e,!1):Y.setUint16(0,(2147483648&n)>>16|e+15<<10|r>>13,!1)}}}function ne(e,n){if(e.length-n<2)throw new Error(`${v} not enough data for float16`);const t=(e[n]<<8)+e[n+1];if(31744===t)return 1/0;if(64512===t)return-1/0;if(32256===t)return NaN;const r=t>>10&31,o=1023&t;let i;return i=0===r?o*2**-24:31!==r?(o+1024)*2**(r-25):0===o?1/0:NaN,32768&t?-i:i}function te(e){Y.setFloat32(0,e,!1)}function re(e,n){if(e.length-n<4)throw new Error(`${v} not enough data for float32`);const t=(e.byteOffset||0)+n;return new DataView(e.buffer,t,4).getFloat32(0,!1)}function oe(e,n){if(e.length-n<8)throw new Error(`${v} not enough data for float64`);const t=(e.byteOffset||0)+n;return new DataView(e.buffer,t,8).getFloat64(0,!1)}function ie(e,n,t){throw new Error(`${v} encountered invalid minor (${t}) for major ${e[n]>>>5}`)}function ue(e){return()=>{throw new Error(`${v} ${e}`)}}J.compareTokens=U.compareTokens;const se=[];for(let Be=0;Be<=23;Be++)se[Be]=ie;se[24]=function(e,n,t,i){return new o(r.uint,B(e,n+1,i),2)},se[25]=function(e,n,t,i){return new o(r.uint,j(e,n+1,i),3)},se[26]=function(e,n,t,i){return new o(r.uint,N(e,n+1,i),5)},se[27]=function(e,n,t,i){return new o(r.uint,S(e,n+1,i),9)},se[28]=ie,se[29]=ie,se[30]=ie,se[31]=ie;for(let Be=32;Be<=55;Be++)se[Be]=ie;se[56]=function(e,n,t,i){return new o(r.negint,-1-B(e,n+1,i),2)},se[57]=function(e,n,t,i){return new o(r.negint,-1-j(e,n+1,i),3)},se[58]=function(e,n,t,i){return new o(r.negint,-1-N(e,n+1,i),5)},se[59]=function(e,n,t,i){const u=S(e,n+1,i);if("bigint"!=typeof u){const e=-1-u;if(e>=Number.MIN_SAFE_INTEGER)return new o(r.negint,e,9)}if(!0!==i.allowBigInt)throw new Error(`${v} integers outside of the safe integer range are not supported`);return new o(r.negint,I-BigInt(u),9)},se[60]=ie,se[61]=ie,se[62]=ie,se[63]=ie;for(let Be=64;Be<=87;Be++)se[Be]=O;se[88]=function(e,n,t,r){return z(e,n,2,B(e,n+1,r))},se[89]=function(e,n,t,r){return z(e,n,3,j(e,n+1,r))},se[90]=function(e,n,t,r){return z(e,n,5,N(e,n+1,r))},se[91]=function(e,n,t,r){const o=S(e,n+1,r);if("bigint"==typeof o)throw new Error(`${v} 64-bit integer bytes lengths not supported`);return z(e,n,9,o)},se[92]=ie,se[93]=ie,se[94]=ie,se[95]=ue("indefinite length bytes/strings are not supported");for(let Be=96;Be<=119;Be++)se[Be]=M;se[120]=function(e,n,t,r){return R(e,n,2,B(e,n+1,r),r)},se[121]=function(e,n,t,r){return R(e,n,3,j(e,n+1,r),r)},se[122]=function(e,n,t,r){return R(e,n,5,N(e,n+1,r),r)},se[123]=function(e,n,t,r){const o=S(e,n+1,r);if("bigint"==typeof o)throw new Error(`${v} 64-bit integer string lengths not supported`);return R(e,n,9,o,r)},se[124]=ie,se[125]=ie,se[126]=ie,se[127]=ue("indefinite length bytes/strings are not supported");for(let Be=128;Be<=151;Be++)se[Be]=G;se[152]=function(e,n,t,r){return V(0,0,2,B(e,n+1,r))},se[153]=function(e,n,t,r){return V(0,0,3,j(e,n+1,r))},se[154]=function(e,n,t,r){return V(0,0,5,N(e,n+1,r))},se[155]=function(e,n,t,r){const o=S(e,n+1,r);if("bigint"==typeof o)throw new Error(`${v} 64-bit integer array lengths not supported`);return V(0,0,9,o)},se[156]=ie,se[157]=ie,se[158]=ie,se[159]=function(e,n,t,r){if(!1===r.allowIndefinite)throw new Error(`${v} indefinite length items not allowed`);return V(0,0,1,1/0)};for(let Be=160;Be<=183;Be++)se[Be]=W;se[184]=function(e,n,t,r){return q(0,0,2,B(e,n+1,r))},se[185]=function(e,n,t,r){return q(0,0,3,j(e,n+1,r))},se[186]=function(e,n,t,r){return q(0,0,5,N(e,n+1,r))},se[187]=function(e,n,t,r){const o=S(e,n+1,r);if("bigint"==typeof o)throw new Error(`${v} 64-bit integer map lengths not supported`);return q(0,0,9,o)},se[188]=ie,se[189]=ie,se[190]=ie,se[191]=function(e,n,t,r){if(!1===r.allowIndefinite)throw new Error(`${v} indefinite length items not allowed`);return q(0,0,1,1/0)};for(let Be=192;Be<=215;Be++)se[Be]=H;se[216]=function(e,n,t,i){return new o(r.tag,B(e,n+1,i),2)},se[217]=function(e,n,t,i){return new o(r.tag,j(e,n+1,i),3)},se[218]=function(e,n,t,i){return new o(r.tag,N(e,n+1,i),5)},se[219]=function(e,n,t,i){return new o(r.tag,S(e,n+1,i),9)},se[220]=ie,se[221]=ie,se[222]=ie,se[223]=ie;for(let Be=224;Be<=243;Be++)se[Be]=ue("simple values are not supported");se[244]=ie,se[245]=ie,se[246]=ie,se[247]=function(e,n,t,i){if(!1===i.allowUndefined)throw new Error(`${v} undefined values are not supported`);return!0===i.coerceUndefinedToNull?new o(r.null,null,1):new o(r.undefined,void 0,1)},se[248]=ue("simple values are not supported"),se[249]=function(e,n,t,r){return X(ne(e,n+1),3,r)},se[250]=function(e,n,t,r){return X(re(e,n+1),5,r)},se[251]=function(e,n,t,r){return X(oe(e,n+1),9,r)},se[252]=ie,se[253]=ie,se[254]=ie,se[255]=function(e,n,t,i){if(!1===i.allowIndefinite)throw new Error(`${v} indefinite length items not allowed`);return new o(r.break,void 0,1)};const ae=[];for(let Be=0;Be<24;Be++)ae[Be]=new o(r.uint,Be,1);for(let Be=-1;Be>=-24;Be--)ae[31-Be]=new o(r.negint,Be,1);ae[64]=new o(r.bytes,new Uint8Array(0),1),ae[96]=new o(r.string,"",1),ae[128]=new o(r.array,0,1),ae[160]=new o(r.map,0,1),ae[244]=new o(r.false,!1,1),ae[245]=new o(r.true,!0,1),ae[246]=new o(r.null,null,1);const ce={float64:!1,mapSorter:function(e,n){const t=Array.isArray(e[0])?e[0][0]:e[0],r=Array.isArray(n[0])?n[0][0]:n[0];if(t.type!==r.type)return t.type.compare(r.type);const o=t.type.major,i=fe[o].compareTokens(t,r);0===i&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone");return i},quickEncodeToken:function(e){switch(e.type){case r.false:return h([244]);case r.true:return h([245]);case r.null:return h([246]);case r.bytes:return e.value.length?void 0:h([64]);case r.string:return""===e.value?h([96]):void 0;case r.array:return 0===e.value?h([128]):void 0;case r.map:return 0===e.value?h([160]):void 0;case r.uint:return e.value<24?h([Number(e.value)]):void 0;case r.negint:if(e.value>=-24)return h([31-Number(e.value)])}}};const fe=function(){const e=[];return e[r.uint.major]=U,e[r.negint.major]=x,e[r.bytes.major]=F,e[r.string.major]=D,e[r.array.major]=L,e[r.map.major]=K,e[r.tag.major]=P,e[r.float.major]=J,e}(),le=new k;class he{constructor(e,n){this.obj=e,this.parent=n}includes(e){let n=this;do{if(n.obj===e)return!0}while(n=n.parent);return!1}static createCheck(e,n){if(e&&e.includes(n))throw new Error(`${E} object contains circular references`);return new he(n,e)}}const de={null:new o(r.null,null),undefined:new o(r.undefined,void 0),true:new o(r.true,!0),false:new o(r.false,!1),emptyArray:new o(r.array,0),emptyMap:new o(r.map,0)},ge={number:(e,n,t,i)=>Number.isInteger(e)&&Number.isSafeInteger(e)?new o(e>=0?r.uint:r.negint,e):new o(r.float,e),bigint:(e,n,t,i)=>e>=BigInt(0)?new o(r.uint,e):new o(r.negint,e),Uint8Array:(e,n,t,i)=>new o(r.bytes,e),string:(e,n,t,i)=>new o(r.string,e),boolean:(e,n,t,r)=>e?de.true:de.false,null:(e,n,t,r)=>de.null,undefined:(e,n,t,r)=>de.undefined,ArrayBuffer:(e,n,t,i)=>new o(r.bytes,new Uint8Array(e)),DataView:(e,n,t,i)=>new o(r.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,n,t,i){if(!e.length)return!0===t.addBreakTokens?[de.emptyArray,new o(r.break)]:de.emptyArray;i=he.createCheck(i,e);const u=[];let s=0;for(const r of e)u[s++]=we(r,t,i);return t.addBreakTokens?[new o(r.array,e.length),u,new o(r.break)]:[new o(r.array,e.length),u]},Object(e,n,t,i){const u="Object"!==n,s=u?e.keys():Object.keys(e),a=u?e.size:s.length;if(!a)return!0===t.addBreakTokens?[de.emptyMap,new o(r.break)]:de.emptyMap;i=he.createCheck(i,e);const c=[];let f=0;for(const r of s)c[f++]=[we(r,t,i),we(u?e.get(r):e[r],t,i)];return function(e,n){n.mapSorter&&e.sort(n.mapSorter)}(c,t),t.addBreakTokens?[new o(r.map,a),c,new o(r.break)]:[new o(r.map,a),c]}};ge.Map=ge.Object,ge.Buffer=ge.Uint8Array;for(const Be of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))ge[`${Be}Array`]=ge.DataView;function we(e,n={},r){const o=t(e),i=n&&n.typeEncoders&&n.typeEncoders[o]||ge[o];if("function"==typeof i){const t=i(e,o,n,r);if(null!=t)return t}const u=ge[o];if(!u)throw new Error(`${E} unsupported type: ${o}`);return u(e,o,n,r)}function pe(e,n,t,r){if(Array.isArray(n))for(const o of n)pe(e,o,t,r);else t[n.type.major](e,n,r)}function ye(e,n,t){const r=we(e,t);if(!Array.isArray(r)&&t.quickEncodeToken){const e=t.quickEncodeToken(r);if(e)return e;const o=n[r.type.major];if(o.encodedSize){const e=o.encodedSize(r,t),n=new k(e);if(o(n,r,t),1!==n.chunks.length)throw new Error(`Unexpected error: pre-calculated length for ${r} was wrong`);return c(n.chunks[0])}}return le.reset(),pe(le,r,n,t),le.toBytes(!0)}function me(e,n){return n=Object.assign({},ce,n),ye(e,fe,n)}const be={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class ke{constructor(e,n={}){this._pos=0,this.data=e,this.options=n}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const e=this.data[this._pos];let n=ae[e];if(void 0===n){const t=se[e];if(!t)throw new Error(`${v} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const r=31&e;n=t(this.data,this._pos,r,this.options)}return this._pos+=n.encodedLength,n}}const ve=Symbol.for("DONE"),Ee=Symbol.for("BREAK");function Ae(e,n){if(e.done())return ve;const t=e.next();if(t.type===r.break)return Ee;if(t.type.terminal)return t.value;if(t.type===r.array)return function(e,n,t){const r=[];for(let o=0;o<e.value;o++){const i=Ae(n,t);if(i===Ee){if(e.value===1/0)break;throw new Error(`${v} got unexpected break to lengthed array`)}if(i===ve)throw new Error(`${v} found array but not enough entries (got ${o}, expected ${e.value})`);r[o]=i}return r}(t,e,n);if(t.type===r.map)return function(e,n,t){const r=!0===t.useMaps,o=r?void 0:{},i=r?new Map:void 0;for(let u=0;u<e.value;u++){const s=Ae(n,t);if(s===Ee){if(e.value===1/0)break;throw new Error(`${v} got unexpected break to lengthed map`)}if(s===ve)throw new Error(`${v} found map but not enough entries (got ${u} [no key], expected ${e.value})`);if(!0!==r&&"string"!=typeof s)throw new Error(`${v} non-string keys not supported (got ${typeof s})`);if(!0===t.rejectDuplicateMapKeys&&(r&&i.has(s)||!r&&s in o))throw new Error(`${v} found repeat map key "${s}"`);const a=Ae(n,t);if(a===ve)throw new Error(`${v} found map but not enough entries (got ${u} [no value], expected ${e.value})`);r?i.set(s,a):o[s]=a}return r?i:o}(t,e,n);if(t.type===r.tag){if(n.tags&&"function"==typeof n.tags[t.value]){const r=Ae(e,n);return n.tags[t.value](r)}throw new Error(`${v} tag not supported (${t.value})`)}throw new Error("unsupported")}function $e(e,n){const[t,r]=function(e,n){if(!(e instanceof Uint8Array))throw new Error(`${v} data to decode must be a Uint8Array`);const t=(n=Object.assign({},be,n)).tokenizer||new ke(e,n),r=Ae(t,n);if(r===ve)throw new Error(`${v} did not find any content to decode`);if(r===Ee)throw new Error(`${v} got unexpected break`);return[r,e.subarray(t.pos())]}(e,n);if(r.length>0)throw new Error(`${v} too many terminals, data makes no sense`);return t}export{o as T,r as a,ye as b,E as c,$e as d,me as e,l as f,c as g,v as h,b as i};
